(this["webpackJsonpcareful-reader-app"]=this["webpackJsonpcareful-reader-app"]||[]).push([[0],{154:function(e,t,n){},162:function(e,t,n){},183:function(e,t,n){},185:function(e,t,n){"use strict";n.r(t);var r=n(2),a=n(0),o=n.n(a),s=n(15),i=n.n(s),c=n(6),l=n.n(c),u=n(10),x=(n(154),n(21)),f=n(23);var p=n(17),d=n(239),b=n(272),h=n(240),m=n(243),j=n(189),v=n(241),g=n(242),O=n(118),w=n.n(O),k=n(244),y=n(245),S=n(64),C=n(246),B=n(121),A=n.n(B),I=n(22),L=n(38),T=n(120),F=n.n(T),P=n(119),N=n.n(P);n.p,n.p,n.p;var D=n(235),M=n(47),E=n(110),H=n(9),q=n(25),U=n(265),R=n(96),W=n(97);function z(e,t){var n=new DOMParser,r=new XSLTProcessor,a=n.parseFromString(e,"text/xml"),o=(new window.DOMParser).parseFromString(t,"text/xml");return r.importStylesheet(o),r.transformToFragment(a,document)}function J(e){var t=z(e,'<?xml version="1.0"?>\n<xsl:stylesheet\n    version="3.0"\n    xmlns:xsl="http://www.w3.org/1999/XSL/Transform"\n    xmlns:xlink="http://www.w3.org/1999/xlink"\n    xmlns:fb="http://www.gribuser.ru/xml/fictionbook/2.0">\n    <xsl:output method="text" omit-xml-declaration="yes" indent="no" encoding="UTF-8"/>\n<xsl:template match="/*">{<xsl:for-each select="fb:description/fb:title-info">\t\n    "title": "<xsl:value-of select="fb:book-title" />",\n    "genre": "<xsl:value-of select="fb:genre" />",\n    "author": {\n        "firstName": "<xsl:value-of select="fb:author/fb:first-name" />",\n        "lastName": "<xsl:value-of select="fb:author/fb:last-name" />"\n    },\n    "date": "<xsl:value-of select="fb:date" />",\n    "keywords": "<xsl:value-of select="fb:keywords" />",\n    "lang": "<xsl:value-of select="fb:lang" />"\n</xsl:for-each>}</xsl:template>\n</xsl:stylesheet>');return{meta:t.textContent?JSON.parse(t.textContent):{},cover:z(e,'<?xml version="1.0"?>\n<xsl:stylesheet\n    version="1.0"\n    xmlns:xsl="http://www.w3.org/1999/XSL/Transform"\n    xmlns:xlink="http://www.w3.org/1999/xlink"\n    xmlns:fb="http://www.gribuser.ru/xml/fictionbook/2.0">\n    <xsl:output method="text" omit-xml-declaration="yes" indent="no" encoding="UTF-8"/>\n    <xsl:template match="/*">\n    <xsl:for-each select="fb:description/fb:title-info/fb:coverpage/fb:image">\n        <xsl:call-template name="image"/>\n    </xsl:for-each>\n    </xsl:template>\n    <xsl:template match="fb:image" name="image">\n        <xsl:choose>\n            <xsl:when test="starts-with(@xlink:href,\'#\')">\n                <xsl:text>data:</xsl:text>\n                <xsl:variable name="href" select="substring-after(@xlink:href,\'#\')"/>\n                <xsl:value-of select="//fb:binary[@id=$href]/@content-type" disable-output-escaping="yes"/><xsl:text>;base64,</xsl:text>\n                <xsl:value-of select="//fb:binary[@id=$href]" disable-output-escaping="yes"/>\n            </xsl:when>\n            <xsl:otherwise>\n                <xsl:attribute name="src">\n                    <xsl:value-of select="@xlink:href"/>\n                </xsl:attribute>\n            </xsl:otherwise>\n        </xsl:choose>\n    </xsl:template>\n</xsl:stylesheet>').textContent}}var K="utf8",_=function(e){return e===K};function X(e){return((new RegExp(/<\?xml[^]+?>/gi).exec(e)||[])[0]||"").includes("windows-1251")?"windows-1251":K}function $(e){return G.apply(this,arguments)}function G(){return(G=Object(u.a)(l.a.mark((function e(t){var n,r,a=arguments;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.length>1&&void 0!==a[1]?a[1]:K,r=new FileReader,e.abrupt("return",new Promise((function(e,a){r.onload=function(t){var n,r=null===t||void 0===t||null===(n=t.target)||void 0===n?void 0:n.result;return r&&"string"===typeof r?e(r):a("")},r.onerror=function(e){return a("error reading file"+e)},r.readAsText(t,n)})));case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function V(){return(V=Object(u.a)(l.a.mark((function e(t){var n,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,$(t);case 2:if(n=e.sent,r=X(n),!_(r)){e.next=6;break}return e.abrupt("return",n);case 6:return e.next=8,$(t,r);case 8:return e.abrupt("return",e.sent);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Y(e){return new Promise((function(t,n){var r=document.createElement("script");return document.body.appendChild(r),r.onload=t,r.onerror=n,r.async=!0,r.src=e,e}))}var Z=!1;function Q(){return ee.apply(this,arguments)}function ee(){return(ee=Object(u.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Z){e.next=2;break}return e.abrupt("return",!0);case 2:return e.abrupt("return",Y("https://apis.google.com/js/client:platform.js").then((function(){return new Promise((function(e,t){return window.gapi.load("auth2",(function(){return e(window.gapi.auth2)}))}))})).then((function(){return Z=!0})).catch((function(){console.error("google api is not loaded")})));case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var te=!1,ne="https://www.googleapis.com/discovery/v1/apis/drive/v3/rest",re="https://www.googleapis.com/auth/drive.appfolder https://www.googleapis.com/auth/drive";function ae(){return oe.apply(this,arguments)}function oe(){return(oe=Object(u.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!te){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,Q();case 4:return e.abrupt("return",new Promise((function(e,t){return window.gapi.client.init({apiKey:"AIzaSyCPUP5x1qzZKw0KqVvyKt7tH8EiK_8HUxY",clientId:"200803973510-oejcrm8bu57ai7gb5tt1h3hkff4ju49r.apps.googleusercontent.com",discoveryDocs:[ne],scope:re}).then((function(){return te=!0})).then(e).catch(t)})));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function se(){return ie.apply(this,arguments)}function ie(){return(ie=Object(u.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ae();case 2:return e.prev=2,e.abrupt("return",window.gapi.auth2.getAuthInstance().signIn());case 6:e.prev=6,e.t0=e.catch(2),console.error("error in signIn",e.t0);case 9:case"end":return e.stop()}}),e,null,[[2,6]])})))).apply(this,arguments)}function ce(){return le.apply(this,arguments)}function le(){return(le=Object(u.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ae();case 2:return e.prev=2,e.abrupt("return",window.gapi.auth2.getAuthInstance().signOut());case 6:e.prev=6,e.t0=e.catch(2),console.error("error in signOut",e.t0);case 9:case"end":return e.stop()}}),e,null,[[2,6]])})))).apply(this,arguments)}function ue(){return xe.apply(this,arguments)}function xe(){return(xe=Object(u.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ae();case 2:return e.prev=2,e.abrupt("return",window.gapi.auth2.getAuthInstance()&&window.gapi.auth2.getAuthInstance().isSignedIn.get());case 6:return e.prev=6,e.t0=e.catch(2),console.error("error in isLoggedIn",e.t0),e.abrupt("return",!1);case 10:case"end":return e.stop()}}),e,null,[[2,6]])})))).apply(this,arguments)}var fe="application/vnd.google-apps.folder",pe=function(e){return function(t){return function(){var n=Object(u.a)(l.a.mark((function n(r,a){var o,s,i;return l.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return console.log(e,t,r,a),o="folder"===t?fe:"text/plain",s=a?[a]:"drive"===e?[]:[e],n.next=5,ve(gapi.client.drive.files.create,{resource:{name:r,mimeType:o,parents:s},fields:"*"});case 5:return i=n.sent,n.abrupt("return",i.result);case 7:case"end":return n.stop()}}),n)})));return function(e,t){return n.apply(this,arguments)}}()}},de=function(e){return function(t){return function(){var n=Object(u.a)(l.a.mark((function n(r){var a,o,s,i,c;return l.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:a="folder"===t?"and mimeType = '".concat(fe,"'"):"and not mimeType = '".concat(fe,"'"),o="".concat(r," ").concat(a),s=[],n.prev=3;case 4:return n.next=6,ve(window.gapi.client.drive.files.list,{spaces:e,fields:"*",pageSize:100,pageToken:i,orderBy:"createdTime",q:o});case 6:c=n.sent,s=s.concat(c.result.files),i=c.result.nextPageToken;case 9:if(i){n.next=4;break}case 10:return n.abrupt("return",s);case 13:n.prev=13,n.t0=n.catch(3),console.error("can`t list items in drive with query: ",r,n.t0);case 16:case"end":return n.stop()}}),n,null,[[3,13]])})));return function(e){return n.apply(this,arguments)}}()}},be=function(){var e=Object(u.a)(l.a.mark((function e(t){var n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ve(gapi.client.drive.files.get,{fileId:t,alt:"media"});case 2:return n=e.sent,e.abrupt("return",n.body);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),he=function(){var e=Object(u.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,ve(gapi.client.drive.files.delete,{fileId:t});case 3:return e.abrupt("return",!0);case 6:if(e.prev=6,e.t0=e.catch(0),404!==e.t0.status){e.next=10;break}return e.abrupt("return",!1);case 10:throw e.t0;case 11:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(t){return e.apply(this,arguments)}}(),me=function(e){return function(t){return function(){var n=Object(u.a)(l.a.mark((function n(r,a,o){var s;return l.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,de(e)(t)(r);case 2:if(!(s=n.sent).length){n.next=7;break}n.t0=s,n.next=11;break;case 7:return n.next=9,pe(e)(t)(a,o);case 9:n.t1=n.sent,n.t0=[n.t1];case 11:return n.abrupt("return",n.t0);case 12:case"end":return n.stop()}}),n)})));return function(e,t,r){return n.apply(this,arguments)}}()}},je=function(e){return function(){var t=Object(u.a)(l.a.mark((function t(n,r){var a;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,ve(gapi.client.request,{spaces:"drive"===e?[]:[e],path:"/upload/drive/v3/files/".concat(n),method:"PATCH",params:{uploadType:"media"},body:"string"===typeof r?r:JSON.stringify(r)});case 3:return a=t.sent,t.abrupt("return",a.result);case 7:t.prev=7,t.t0=t.catch(0),console.error("can`t upload file with: ",n,r,t.t0);case 10:case"end":return t.stop()}}),t,null,[[0,7]])})));return function(e,n){return t.apply(this,arguments)}}()};function ve(e,t){return new Promise((function(n,r){return e(t).then((function(e){e&&(e.status<200||e.status>299)?(console.error("GAPI call returned bad status",e),r(e)):n(e)}),(function(e){return r(e)}))}))}var ge=pe("drive"),Oe=de("drive"),we=me("drive"),ke=je("drive"),ye={getOrCreate:{folder:we("folder"),file:we("file")},create:{folder:ge("folder"),file:ge("file")},find:{folder:Oe("folder"),file:Oe("file")},upload:ke,download:be,remove:he},Se=pe("appDataFolder"),Ce=de("appDataFolder"),Be=me("appDataFolder"),Ae=je("appDataFolder"),Ie={getOrCreate:{foder:Be("folder"),file:Be("file")},create:{folder:Se("folder"),file:Se("file")},find:{folder:de("folder"),file:Ce("file")},upload:Ae,download:be,remove:he},Le=function e(t){var n=this;Object(M.a)(this,e),this.rootStore=void 0,this.messages=void 0,this.defaultLocale="en",this.locale="en",this.wordsHighlight=!0,this.dynamicTextOrientation=!1,this.pageColor="white",this.pageBackgroundColor="#0000",this.isLoggedIn=!1,this.isClientLoaded=!1,this.isUseImageCover=!0,this.imageCover="1",this.setLocale=Object(H.f)((function(e){if(!Object.keys(n.messages).includes(e))throw Error("Unsupported locale");n.locale=e})),this.setImageCoverAction=Object(H.f)((function(e){return n.imageCover=e})),this.getLocaleMessages=Object(H.f)((function(){var e=n.locale;return n.messages[e]})),this.toggleHightligting=Object(H.f)((function(e){n.wordsHighlight=e})),this.toggleDynamicTextOrientation=Object(H.f)((function(e){n.dynamicTextOrientation=e})),this.setPageColor=Object(H.f)((function(e){n.pageColor=e})),this.toggleUseImageCover=Object(H.f)((function(e){n.isUseImageCover=e})),this.setPageBackgroundColorAction=Object(H.f)((function(e){n.pageBackgroundColor=e})),this.signInAction=Object(H.f)(Object(u.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,se();case 2:return e.next=4,ue();case 4:n.isLoggedIn=e.sent;case 5:case"end":return e.stop()}}),e)})))),this.signOutAction=Object(H.f)(Object(u.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ce();case 2:return e.next=4,ue();case 4:n.isLoggedIn=e.sent;case 5:case"end":return e.stop()}}),e)})))),Object(H.l)(this),this.rootStore=t;var r=Object(q.c)();Object(U.a)({locale:"ru",messages:W},r),Object(U.a)({locale:"en",messages:R},r),this.defaultLocale="en",this.messages={en:R,ru:W},ae().then((function(e){n.isClientLoaded=!0,ue().then((function(e){return n.isLoggedIn=e}))}))},Te=n(87),Fe=n(39),Pe=n(125),Ne="index",De="books",Me=Object(Pe.a)("library",1,{upgrade:function(e,t){t<1&&(e.createObjectStore(Ne,{keyPath:"id"}),e.createObjectStore(De,{autoIncrement:!0}))}}),Ee=function(){var e=Object(u.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Me;case 2:return e.abrupt("return",e.sent.transaction([Ne,De],"readwrite"));case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),He={getBookMeta:function(e){return Object(u.a)(l.a.mark((function t(){return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Me;case 2:return t.abrupt("return",t.sent.get(Ne,e));case 3:case"end":return t.stop()}}),t)})))()},getAllMeta:function(){return Object(u.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Me;case 2:return e.abrupt("return",e.sent.getAll(Ne));case 3:case"end":return e.stop()}}),e)})))()},getBookText:function(e){return Object(u.a)(l.a.mark((function t(){var n;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Me;case 2:return t.next=4,t.sent.get(De,e);case 4:if(n=t.sent){t.next=9;break}throw Error("can not find book ".concat(e," in the locale db"));case 9:return t.abrupt("return",n);case 10:case"end":return t.stop()}}),t)})))()},addBook:function(e){var t=arguments;return Object(u.a)(l.a.mark((function n(){var r,a,o,s,i;return l.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=t.length>1&&void 0!==t[1]?t[1]:"",a=Date.now(),n.next=4,Ee();case 4:return o=n.sent,n.next=7,o.objectStore(De).add(r);case 7:return s=n.sent,i=Object(Fe.a)(Object(Fe.a)({},e),{},{id:s,timestamp:a}),n.next=11,o.objectStore(Ne).add(i);case 11:return n.next=13,o.done;case 13:return n.abrupt("return",i);case 14:case"end":return n.stop()}}),n)})))()},updateBookMeta:function(e,t){return Object(u.a)(l.a.mark((function n(){var r,a,o,s;return l.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,Ee();case 2:return r=n.sent,a=r.objectStore(Ne),n.next=6,a.get(e);case 6:return o=n.sent,s=Object(Fe.a)(Object(Fe.a)({},o),t),n.next=10,a.put(s);case 10:return n.next=12,r.done;case 12:return n.abrupt("return",s);case 13:case"end":return n.stop()}}),n)})))()},delete:function(e){return Object(u.a)(l.a.mark((function t(){var n;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Ee();case 2:return n=t.sent,t.next=5,n.objectStore(Ne).delete(e);case 5:return t.next=7,n.objectStore(De).delete(e);case 7:return t.next=9,n.done;case 9:case"end":return t.stop()}}),t)})))()},clear:function(){return Object(u.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ee();case 2:return t=e.sent,e.next=5,t.objectStore(Ne).clear();case 5:return e.next=7,t.objectStore(De).clear();case 7:return e.next=9,t.done;case 9:case"end":return e.stop()}}),e)})))()}},qe=function e(t){var n=this;Object(M.a)(this,e),this.isAddingBookInProcess=!1,this.isFetchingBooksInProcess=!1,this.books=[],this.lastBook=void 0,this.rootStore=void 0,this.fetchBooksListAction=Object(H.f)(Object(u.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.isFetchingBooksInProcess=!0,e.next=3,He.getAllMeta();case 3:n.books=e.sent,n.isFetchingBooksInProcess=!1;case 5:case"end":return e.stop()}}),e)})))),this.isBookExist=function(e){return n.books.find((function(t){return t.name===e}))},this.addBookAction=Object(H.f)(function(){var e=Object(u.a)(l.a.mark((function e(t,r){var a,o,s,i,c;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=J(t),o=a.cover,s=a.meta,i={name:r,meta:s,cover:o},n.isAddingBookInProcess=!0,e.next=5,He.addBook(i,t);case 5:c=e.sent,n.books.push(c),n.isAddingBookInProcess=!1,n.rootStore.notification.info("book has been added");case 9:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),this.syncBookAction=Object(H.f)(function(){var e=Object(u.a)(l.a.mark((function e(t,r){var a,o,s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.id,a=Object(Te.a)(t,["id"]),(o=Object(H.n)(a)).meta=Object(H.n)(o.meta),e.next=5,He.addBook(o,r);case 5:s=e.sent,n.books.push(s);case 7:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),this.removeBookAction=Object(H.f)(function(){var e=Object(u.a)(l.a.mark((function e(t){var r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,He.delete(t.id);case 4:r=n.books.indexOf(t),n.books.splice(r,1),n.rootStore.notification.info("book has been removed");case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),this.updateBookPositionAction=Object(H.f)(function(){var e=Object(u.a)(l.a.mark((function e(t,r){var a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.id,e.next=3,He.updateBookMeta(a,{positionElement:r});case 3:return t.positionElement=r,e.next=6,n.rootStore.syncMetaAction(t);case 6:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),this.updateBookAction=Object(H.f)(function(){var e=Object(u.a)(l.a.mark((function e(t,r){var a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(a=n.books.find((function(e){return e.id===t})))&&Object.assign(a,r),e.next=4,He.updateBookMeta(t,r);case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),this.openBookAction=Object(H.f)(function(){var e=Object(u.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n.lastBook||n.lastBook.info.id!==t){e.next=10;break}return e.next=3,He.getBookMeta(t);case 3:if(e.t0=e.sent,e.t0){e.next=6;break}e.t0=n.lastBook.info;case 6:return n.lastBook.info=e.t0,e.abrupt("return",Promise.resolve(n.lastBook));case 10:return e.abrupt("return",Promise.all([He.getBookMeta(t),He.getBookText(t)]).then((function(e){var t=e[0],r=e[1]||"",a=z(r,'<?xml version="1.0"?>\n<xsl:stylesheet\n        version="3.0"\n        xmlns:xsl="http://www.w3.org/1999/XSL/Transform"\n        xmlns:xlink="http://www.w3.org/1999/xlink"\n        xmlns:fb="http://www.gribuser.ru/xml/fictionbook/2.0"\n        >\n    <xsl:output\n            media-type="text/html"\n            method="html"\n            encoding="utf-8"\n            omit-xml-declaration="yes"\n            doctype-public="HTML5"\n            />\n\n    <xsl:key name="note-link" match="fb:section" use="@id"/>\n    <xsl:template match="/*">\n        <div class="text">\n            <xsl:for-each select="fb:description/fb:title-info/fb:coverpage/fb:image">\n                <xsl:call-template name="image"/>\n            </xsl:for-each>\n\n            <xsl:for-each select="fb:description/fb:title-info/fb:annotation">\n                <section class="text-annotation">\n                    <xsl:call-template name="annotation"/>\n                </section>\n            </xsl:for-each>\n\n            \x3c!--<navMap style="display: none;">--\x3e\n                \x3c!--<xsl:apply-templates select="fb:body" mode="toc"/>--\x3e\n            \x3c!--</navMap>--\x3e\n\n\n            <xsl:for-each select="fb:body">\n                <xsl:if test="position() != 1">\n                    <div class="separator"></div>\n                </xsl:if>\n\n                \x3c!--<xsl:if test="not(fb:title) and @name">--\x3e\n                    \x3c!--<h4 align="center">--\x3e\n                        \x3c!--<xsl:value-of select="@name"/>--\x3e\n                    \x3c!--</h4>--\x3e\n                \x3c!--</xsl:if>--\x3e\n\n                <div class="text-wrapper">\n                    <xsl:apply-templates/>\n                </div>\n\n            </xsl:for-each>\n        </div>\n    </xsl:template>\n    \x3c!-- author template --\x3e\n    <xsl:template name="author">\n        <xsl:value-of select="fb:first-name"/>\n        <xsl:text disable-output-escaping="no">&#032;</xsl:text>\n        <xsl:value-of select="fb:middle-name"/>&#032;\n        <xsl:text disable-output-escaping="no">&#032;</xsl:text>\n        <xsl:value-of select="fb:last-name"/>\n        <br/>\n    </xsl:template>\n    \x3c!-- secuence template --\x3e\n    <xsl:template name="sequence">\n        <xsl:value-of select="@name"/>\n        <xsl:if test="@number">\n            <xsl:text disable-output-escaping="no">,&#032;#</xsl:text>\n            <xsl:value-of select="@number"/>\n        </xsl:if>\n        <xsl:if test="fb:sequence">\n            <ul>\n                <xsl:for-each select="fb:sequence">\n                    <xsl:call-template name="sequence"/>\n                </xsl:for-each>\n            </ul>\n        </xsl:if>\n    </xsl:template>\n    \x3c!-- toc template --\x3e\n    <xsl:template match="fb:section|fb:body" mode="toc">\n        <xsl:choose>\n            <xsl:when test="name()=\'body\' and position()=1 and not(fb:title)">\n                <xsl:apply-templates select="fb:section" mode="toc"/>\n            </xsl:when>\n            <xsl:otherwise>\n                <navPoint>\n                    <navLabel>\n                        <text>\n                            <xsl:value-of select="normalize-space(fb:title | @name)"/>\n                        </text>\n                    </navLabel>\n                    <content src="#TOC_{generate-id()}"></content>\n                    \x3c!--<xsl:value-of select="normalize-space(fb:title | //fb:body/@name)"/>--\x3e\n                    \x3c!--<xsl:value-of select="normalize-space(fb:body[@name == \'notes\']/@name | fb:body/title)"/>--\x3e\n\n                    \x3c!-- fb:body[@name = \'notes\'] --\x3e\n                    <xsl:if test="fb:section">\n                        <navPoint>\n                            <xsl:apply-templates select="fb:section" mode="toc"/>\n                        </navPoint>\n                    </xsl:if>\n                </navPoint>\n            </xsl:otherwise>\n        </xsl:choose>\n    </xsl:template>\n    \x3c!-- description --\x3e\n    <xsl:template match="fb:description">\n        <xsl:apply-templates/>\n    </xsl:template>\n    \x3c!-- body --\x3e\n    <xsl:template match="fb:body">\n        <div>\n            <xsl:apply-templates/>\n        </div>\n    </xsl:template>\n\n    <xsl:template match="fb:section">\n        <section>\n            <xsl:attribute name="class">\n                <xsl:text>default-section</xsl:text>\n                <xsl:if test="starts-with(translate(fb:title, \'\u0413\u041b\u0410\u0412\u0410\', \'\u0433\u043b\u0430\u0432\u0430\'), \'\u0433\u043b\u0430\u0432\u0430\')">\n                    <xsl:text> chapter</xsl:text>\n                </xsl:if>\n            </xsl:attribute>\n            <a name="TOC_{generate-id()}"></a>\n            <xsl:if test="@id">\n                <xsl:element name="a">\n                    <xsl:attribute name="name">\n                        <xsl:value-of select="@id"/>\n                    </xsl:attribute>\n                </xsl:element>\n            </xsl:if>\n            <xsl:apply-templates/>\n        </section>\n    </xsl:template>\n    <xsl:template match="fb:body[@name=\'notes\']//fb:section">\n        <div>\n            <xsl:if test="@id">\n                <xsl:attribute name="class">\n                    <xsl:value-of select="\'annotation\'"/>\n                </xsl:attribute>\n            </xsl:if>\n            <a name="TOC_{generate-id()}"></a>\n            <xsl:if test="@id">\n                <xsl:element name="a">\n                    <xsl:attribute name="name">\n                        <xsl:value-of select="@id"/>\n                    </xsl:attribute>\n                </xsl:element>\n            </xsl:if>\n            <xsl:apply-templates/>\n        </div>\n    </xsl:template>\n\n\n    \x3c!-- section/title --\x3e\n    <xsl:template match="fb:section/fb:title|fb:poem/fb:title">\n        <xsl:choose>\n            <xsl:when test="count(ancestor::node()) &lt; 9">\n                <xsl:element name="{concat(\'h\',count(ancestor::node())-3)}">\n                    <a name="TOC_{generate-id()}"></a>\n                    <xsl:if test="@id">\n                        <xsl:element name="a">\n                            <xsl:attribute name="name">\n                                <xsl:value-of select="@id"/>\n                            </xsl:attribute>\n                        </xsl:element>\n                    </xsl:if>\n                    <xsl:apply-templates/>\n                </xsl:element>\n            </xsl:when>\n            <xsl:otherwise>\n                <xsl:element name="h6">\n                    <xsl:if test="@id">\n                        <xsl:element name="a">\n                            <xsl:attribute name="name">\n                                <xsl:value-of select="@id"/>\n                            </xsl:attribute>\n                        </xsl:element>\n                    </xsl:if>\n                    <xsl:apply-templates/>\n                </xsl:element>\n            </xsl:otherwise>\n        </xsl:choose>\n    </xsl:template>\n    \x3c!-- section/title --\x3e\n    <xsl:template match="fb:body/fb:title">\n        \x3c!--<h1 style="display: none;">--\x3e\n            \x3c!--<xsl:apply-templates mode="title"/>--\x3e\n        \x3c!--</h1>--\x3e\n    </xsl:template>\n    <xsl:template match="fb:body[@name=\'notes\']/fb:title">\n        <h1>\n            <xsl:apply-templates mode="title"/>\n        </h1>\n    </xsl:template>\n\n    <xsl:template match="fb:title/fb:p">\n        <xsl:apply-templates/>\n        <xsl:text disable-output-escaping="no">&#032;</xsl:text>\n        <br/>\n    </xsl:template>\n    \x3c!-- subtitle --\x3e\n    <xsl:template match="fb:subtitle">\n        <xsl:if test="@id">\n            <xsl:element name="a">\n                <xsl:attribute name="name">\n                    <xsl:value-of select="@id"/>\n                </xsl:attribute>\n            </xsl:element>\n        </xsl:if>\n        <h5>\n            <xsl:apply-templates/>\n        </h5>\n    </xsl:template>\n    \x3c!-- p --\x3e\n    <xsl:template match="fb:p">\n        \x3c!--<xsl:if test"preceding-sibling::*[1][name()] != \'fb:image\'">--\x3e\n            <p data-id="{position()}-{last()}}">\n                <xsl:if test="@id">\n                    <xsl:element name="a">\n                        <xsl:attribute name="name">\n                            <xsl:value-of select="@id"/>\n                        </xsl:attribute>\n                    </xsl:element>\n                </xsl:if>\n                <xsl:apply-templates/>\n            </p>\n        \x3c!--</xsl:if>--\x3e\n    </xsl:template>\n    \x3c!-- strong --\x3e\n    <xsl:template match="fb:strong">\n        <b>\n            <xsl:apply-templates/>\n        </b>\n    </xsl:template>\n    \x3c!-- emphasis --\x3e\n    <xsl:template match="fb:emphasis">\n        <i>\n            <xsl:apply-templates/>\n        </i>\n    </xsl:template>\n    \x3c!-- style --\x3e\n    <xsl:template match="fb:style">\n        <span class="{@name}">\n            <xsl:apply-templates/>\n        </span>\n    </xsl:template>\n    \x3c!-- empty-line --\x3e\n    <xsl:template match="fb:empty-line">\n        <xsl:if test="following-sibling::*[1] != fb:image">\n            <br/>\n        </xsl:if>\n    </xsl:template>\n    \x3c!-- link --\x3e\n    <xsl:template match="fb:a">\n        <xsl:choose>\n            <xsl:when test="starts-with(@xlink:href,\'#\')">\n                <xsl:element name="a">\n                    <xsl:attribute name="class">\n                        <xsl:value-of select="\'footnote\'"/>\n                    </xsl:attribute>\n                    <xsl:attribute name="href">\n                        <xsl:value-of select="@xlink:href"/>\n                    </xsl:attribute>\n                    <xsl:attribute name="title">\n                        <xsl:value-of select="key(\'note-link\',substring-after(@xlink:href,\'#\'))/fb:p"/>\n                    </xsl:attribute>\n                    <xsl:choose>\n                        <xsl:when test="(@type) = \'note\'">\n                            <sup>\n                                <xsl:apply-templates/>\n                            </sup>\n                        </xsl:when>\n                        <xsl:otherwise>\n                            <xsl:apply-templates/>\n                        </xsl:otherwise>\n                    </xsl:choose>\n                </xsl:element>\n            </xsl:when>\n            <xsl:otherwise>\n                <xsl:element name="span">\n                    <xsl:choose>\n                        <xsl:when test="(@type) = \'note\'">\n                            <sup>\n                                <xsl:apply-templates/>\n                            </sup>\n                        </xsl:when>\n                        <xsl:otherwise>\n                            <xsl:apply-templates/>\n                        </xsl:otherwise>\n                    </xsl:choose>\n                </xsl:element>\n            </xsl:otherwise>\n        </xsl:choose>\n    </xsl:template>\n    \x3c!-- annotation --\x3e\n    <xsl:template name="annotation">\n        <xsl:if test="@id">\n            <xsl:element name="a">\n                <xsl:attribute name="name">\n                    <xsl:value-of select="@id"/>\n                </xsl:attribute>\n            </xsl:element>\n        </xsl:if>\n        <xsl:apply-templates/>\n    </xsl:template>\n    \x3c!-- epigraph --\x3e\n    <xsl:template match="fb:epigraph">\n        <blockquote class="epigraph">\n            <xsl:if test="@id">\n                <xsl:element name="a">\n                    <xsl:attribute name="name">\n                        <xsl:value-of select="@id"/>\n                    </xsl:attribute>\n                </xsl:element>\n            </xsl:if>\n            <xsl:apply-templates/>\n        </blockquote>\n    </xsl:template>\n    \x3c!-- epigraph/text-author --\x3e\n    <xsl:template match="fb:epigraph/fb:text-author">\n        <blockquote class="author">\n            <i>\n                <xsl:apply-templates/>\n            </i>\n        </blockquote>\n    </xsl:template>\n    \x3c!-- cite --\x3e\n    <xsl:template match="fb:cite">\n        <blockquote>\n            <xsl:if test="@id">\n                <xsl:element name="a">\n                    <xsl:attribute name="name">\n                        <xsl:value-of select="@id"/>\n                    </xsl:attribute>\n                </xsl:element>\n            </xsl:if>\n            <xsl:apply-templates/>\n        </blockquote>\n    </xsl:template>\n    \x3c!-- cite/text-author --\x3e\n    <xsl:template match="fb:text-author">\n        <blockquote>\n            <i>\n                <xsl:apply-templates/>\n            </i>\n        </blockquote>\n    </xsl:template>\n    \x3c!-- date --\x3e\n    <xsl:template match="fb:date">\n        <xsl:choose>\n            <xsl:when test="not(@value)">\n                &#160;&#160;&#160;\n                <xsl:apply-templates/>\n                <br/>\n            </xsl:when>\n            <xsl:otherwise>\n                &#160;&#160;&#160;<xsl:value-of select="@value"/>\n                <br/>\n            </xsl:otherwise>\n        </xsl:choose>\n    </xsl:template>\n    \x3c!-- poem --\x3e\n    <xsl:template match="fb:poem">\n        <blockquote>\n            <xsl:if test="@id">\n                <xsl:element name="a">\n                    <xsl:attribute name="name">\n                        <xsl:value-of select="@id"/>\n                    </xsl:attribute>\n                </xsl:element>\n            </xsl:if>\n            <xsl:apply-templates/>\n        </blockquote>\n    </xsl:template>\n\n    \x3c!-- stanza --\x3e\n    <xsl:template match="fb:stanza">\n        <xsl:apply-templates/>\n        <br/>\n    </xsl:template>\n    \x3c!-- v --\x3e\n    <xsl:template match="fb:v">\n        <xsl:if test="@id">\n            <xsl:element name="a">\n                <xsl:attribute name="name">\n                    <xsl:value-of select="@id"/>\n                </xsl:attribute>\n            </xsl:element>\n        </xsl:if>\n        <xsl:apply-templates/>\n        <br/>\n    </xsl:template>\n    \x3c!-- image --\x3e\n    <xsl:template match="fb:image" name="image">\n        <div>\n            <xsl:choose>\n                <xsl:when test="ancestor::fb:coverpage">\n                    <xsl:attribute name="class">\n                        <xsl:value-of select="\'text-cover\'"/>\n                    </xsl:attribute>\n                </xsl:when>\n                <xsl:otherwise>\n                    <xsl:attribute name="class">\n                        <xsl:text>default image</xsl:text>\n                    </xsl:attribute>\n                </xsl:otherwise>\n            </xsl:choose>\n            <div class="image-wrapper">\n                <img>\n                    <xsl:choose>\n                        <xsl:when test="starts-with(@xlink:href,\'#\')">\n                            <xsl:attribute name="src">\n                                <xsl:text>data:</xsl:text>\n                                <xsl:variable name="href" select="substring-after(@xlink:href,\'#\')"/>\n                                <set variable="href" expression="substring-after(@xlink:href,\'#\')"/>\n                                <xsl:value-of select="//fb:binary[@id=$href]/@content-type" disable-output-escaping="yes"/><xsl:text>;base64,</xsl:text>\n                                \x3c!--<xsl:value-of select="substring-after(@xlink:href,\'#\')"/>--\x3e\n                                <xsl:value-of select="//fb:binary[@id=$href]" disable-output-escaping="yes"/>\n                            </xsl:attribute>\n\n                        </xsl:when>\n                        <xsl:otherwise>\n                            <xsl:attribute name="src">\n                                <xsl:value-of select="@xlink:href"/>\n                            </xsl:attribute>\n                        </xsl:otherwise>\n                    </xsl:choose>\n                </img>\n            </div>\n            <xsl:if test="following-sibling::node()[1]/fb:emphasis">\n                <div class="image-annotation">\n                    <xsl:apply-templates select="following-sibling::fb:p[1]"/>\n                </div>\n            </xsl:if>\n        </div>\n    </xsl:template>\n</xsl:stylesheet>').children[0].innerHTML||"";return n.lastBook={info:t,text:a},n.lastBook})));case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),this.fetchBookTextAction=Object(H.f)(function(){var e=Object(u.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,He.getBookText(t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),Object(H.l)(this),this.rootStore=t},Ue=function e(t){var n=this;Object(M.a)(this,e),this.books=[],this.isClientLoaded=!1,this.isLoggedIn=!1,this.isBooksLoading=!1,this.isUploading=!1,this.isDownloading=!1,this.isBookRemoving=!1,this.remoteFolderName="careful-reader",this.cloudAppFolder=Ie,this.cloudDrive=ye,this.rootStore=void 0,this.initLibrary=Object(H.f)(Object(u.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:ye.create.folder("books-folder");case 1:case"end":return e.stop()}}),e)})))),this.fetchBooksListAction=Object(H.f)(Object(u.a)(l.a.mark((function e(){var t,r,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n.isBooksLoading=!0,e.next=4,n.cloudDrive.find.file("name contains '.fb2'");case 4:return t=e.sent,console.log("list",t),t.map((function(e){return e.name})),e.next=9,n.cloudAppFolder.find.file("name contains '-meta.json'");case 9:return r=e.sent,a=r.map((function(e){return n.cloudAppFolder.download(e.id).then((function(e){var t=JSON.parse(e);n.books.push(t)}))})),n.books=[],e.next=14,Promise.all(a);case 14:console.log("remote books",n.books),e.next=20;break;case 17:e.prev=17,e.t0=e.catch(0),n.rootStore.notification.error("Fetching remote books error");case 20:return e.prev=20,n.isBooksLoading=!1,e.finish(20);case 23:case"end":return e.stop()}}),e,null,[[0,17,20,23]])})))),this.uploadBookAction=Object(H.f)(function(){var e=Object(u.a)(l.a.mark((function e(t){var r,a,o,s,i,c,u,f,p,d;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,n.isUploading=!0,e.next=6,n.cloudDrive.getOrCreate.folder("name = '".concat(n.remoteFolderName,"'"),n.remoteFolderName);case 6:return r=e.sent,a=Object(x.a)(r,1),o=a[0],e.next=11,n.cloudDrive.getOrCreate.file("name = '".concat(t.name,"' and '").concat(o.id,"' in parents"),t.name,o.id);case 11:return s=e.sent,i=Object(x.a)(s,1),c=i[0],e.next=16,He.getBookText(t.id);case 16:return u=e.sent,e.next=19,n.cloudDrive.upload(c.id,u);case 19:return f=e.sent,p=f.id,e.next=23,He.updateBookMeta(t.id,{textFileId:p});case 23:return d=e.sent,t.textFileId=p,console.log("book",t),n.books.push(t),n.rootStore.notification.info("Upload success"),e.abrupt("return",d);case 31:e.prev=31,e.t0=e.catch(2),n.rootStore.notification.error("Upload error");case 34:return e.prev=34,n.isUploading=!1,e.finish(34);case 37:case"end":return e.stop()}}),e,null,[[2,31,34,37]])})));return function(t){return e.apply(this,arguments)}}()),this.syncMetaAction=Object(H.f)(function(){var e=Object(u.a)(l.a.mark((function e(t){var r,a,o,s,i,c,u,f;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return");case 2:return console.log("book for upload:",t),e.prev=3,r=t.name+"-meta.json",e.next=7,n.cloudAppFolder.getOrCreate.file("name = '".concat(r,"'"),r);case 7:return a=e.sent,o=Object(x.a)(a,1),s=o[0],e.next=12,n.cloudAppFolder.upload(s.id,JSON.stringify(t));case 12:return i=e.sent,c=i.id,e.next=16,He.updateBookMeta(t.id,{metaFileId:c});case 16:return u=e.sent,(f=n.books.find((function(e){return e.name===t.name})))?Object.assign(f,t):n.books.push(t),e.abrupt("return",u);case 22:e.prev=22,e.t0=e.catch(3),n.rootStore.notification.error("sync error");case 25:return e.prev=25,e.finish(25);case 27:case"end":return e.stop()}}),e,null,[[3,22,25,27]])})));return function(t){return e.apply(this,arguments)}}()),this.downloadBookAction=Object(H.f)(function(){var e=Object(u.a)(l.a.mark((function e(t){var r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return");case 2:if(r="",e.prev=3,n.isDownloading=!0,!t.textFileId){e.next=10;break}return n.rootStore.notification.info("download sucess"),e.next=9,n.cloudDrive.download(t.textFileId);case 9:r=e.sent;case 10:return e.next=12,n.rootStore.syncBookAction(t,r);case 12:return e.abrupt("return",r);case 15:return e.prev=15,e.t0=e.catch(3),console.error(e.t0),n.rootStore.notification.error("download error"),e.abrupt("return",r);case 20:return e.prev=20,n.isDownloading=!1,e.finish(20);case 23:case"end":return e.stop()}}),e,null,[[3,15,20,23]])})));return function(t){return e.apply(this,arguments)}}()),this.forceBookRemove=function(){var e=Object(u.a)(l.a.mark((function e(t){var r,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.cloudAppFolder.find.file("name = '".concat(t.name,"-meta.json'")).then((function(e){var t=Object(x.a)(e,1)[0];return(null===t||void 0===t?void 0:t.id)&&n.cloudAppFolder.remove(t.id)}));case 2:return r=e.sent,e.next=5,n.cloudDrive.find.file("name = '".concat(t.name,"'")).then((function(e){var t=e.file;return(null===t||void 0===t?void 0:t.id)&&n.cloudDrive.remove(t.id)}));case 5:return a=e.sent,e.abrupt("return",Promise.allSettled([a,r]));case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.removeBookAction=Object(H.f)(function(){var e=Object(u.a)(l.a.mark((function e(t){var r,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return");case 2:if(e.prev=2,n.isBookRemoving=!0,(r=n.books.indexOf(t))>-1&&n.books.splice(r,1),t.metaFileId&&t.textFileId){e.next=11;break}return e.next=9,n.forceBookRemove(t);case 9:e.next=16;break;case 11:return a=[],t.textFileId&&a.push(n.cloudDrive.remove(t.textFileId)),t.metaFileId&&a.push(n.cloudAppFolder.remove(t.metaFileId)),e.next=16,Promise.allSettled(a);case 16:n.rootStore.notification.info("book remove sucess"),e.next=22;break;case 19:e.prev=19,e.t0=e.catch(2),n.rootStore.notification.error("book remove error");case 22:return e.prev=22,n.isBookRemoving=!1,e.finish(22);case 25:case"end":return e.stop()}}),e,null,[[2,19,22,25]])})));return function(t){return e.apply(this,arguments)}}()),Object(H.l)(this),this.rootStore=t,ae().then((function(){n.isClientLoaded=!0,ue().then((function(e){return n.isLoggedIn=e}))}))},Re=function(){function e(){var t=this;Object(M.a)(this,e),this.appStore=void 0,this.libraryStore=void 0,this.remoteLibraryStore=void 0,this.notifications=[],this.notification={info:Object(H.f)((function(e){t.notifications.push({message:e,type:"info"})})),error:Object(H.f)((function(e){t.notifications.push({message:e,type:"error"})}))},this.syncMetaAction=Object(H.f)(function(){var e=Object(u.a)(l.a.mark((function e(n){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.remoteLibraryStore.syncMetaAction(n);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),this.syncBookAction=Object(H.f)(function(){var e=Object(u.a)(l.a.mark((function e(n,r){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.libraryStore.syncBookAction(n,r);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),Object(H.l)(this),this.appStore=new Le(this),this.remoteLibraryStore=new Ue(this),this.libraryStore=new qe(this)}return Object(E.a)(e,[{key:"removeNotification",value:function(e){this.notifications.splice(e,1)}}]),e}(),We=Object(a.createContext)({}),ze=Object(p.a)((function(){var e=Object(a.useContext)(We).appStore,t=e.isClientLoaded,n=e.isLoggedIn,o=e.signInAction,s=e.signOutAction;return Object(r.jsx)(r.Fragment,{children:t&&Object(r.jsx)(r.Fragment,{children:n?Object(r.jsx)(D.a,{onClick:s,color:"inherit",children:"LogOut"}):Object(r.jsx)(D.a,{onClick:o,color:"inherit",children:"Login"})})})})),Je=n(24),Ke=(n(162),n(238));function _e(){var e=Object(f.a)(["\n  display: ",";\n"]);return _e=function(){return e},e}var Xe=Je.a.div(_e(),(function(e){return e.switch?"block":"none"})),$e=Object(p.a)((function(e){var t=e.loading,n=e.children;return Object(r.jsxs)(r.Fragment,{children:[Object(r.jsx)(Xe,{switch:t,children:Object(r.jsx)("div",{children:"Loading"})}),n]})})),Ge=Object(p.a)((function(){var e=Object(a.useContext)(We),t=e.libraryStore,n=e.remoteLibraryStore,o=n.isBooksLoading||n.isUploading||n.isDownloading||n.isBookRemoving||t.isAddingBookInProcess||t.isFetchingBooksInProcess;return Object(r.jsx)(r.Fragment,{children:o&&Object(r.jsx)(Ke.a,{})})}));function Ve(){var e=Object(f.a)(["\n    overflow: hidden;\n    text-overflow: ellipsis;\n    white-space: nowrap;\n    flex-grow: 1;\n"]);return Ve=function(){return e},e}function Ye(){var e=Object(f.a)([""]);return Ye=function(){return e},e}var Ze=Je.a.div(Ye()),Qe=Object(Je.a)(S.a)(Ve()),et=Object(d.a)({list:{width:250},menuButton:{marginRight:""},title:{flexGrow:1}}),tt=Object(p.a)((function(e){var t=e.children,n=(e.className,e.title),s=et(),i=Object(a.useState)(!1),c=Object(x.a)(i,2),l=c[0],u=c[1],f=Object(I.g)().pathname||"",p=n||{"/":"Library","/settings":"Settings"}[f],d=Object(a.useContext)(We).libraryStore.lastBook,O=function(e){return function(t){("keydown"!==t.type||"Tab"!==t.key&&"Shift"!==t.key)&&u(e)}};return Object(r.jsxs)(r.Fragment,{children:[Object(r.jsxs)(Ze,{children:[Object(r.jsx)(k.a,{}),Object(r.jsx)(y.a,{})]}),Object(r.jsxs)(k.a,{position:"fixed",children:[Object(r.jsxs)(y.a,{children:[Object(r.jsx)(C.a,{edge:"start",className:s.menuButton,color:"inherit","aria-label":"menu",children:Object(r.jsxs)(o.a.Fragment,{children:[Object(r.jsx)(A.a,{onClick:O(!0)}),Object(r.jsx)(b.a,{anchor:"left",open:l,onClose:O(!1),children:function(){var e;return Object(r.jsxs)("div",{className:s.list,role:"presentation",onClick:O(!1),onKeyDown:O(!1),children:[Object(r.jsxs)(h.a,{children:[(null===d||void 0===d||null===(e=d.info)||void 0===e?void 0:e.meta)&&Object(r.jsx)(L.b,{to:"/read/".concat(d.info.id),children:Object(r.jsxs)(j.a,{button:!0,children:[Object(r.jsx)(v.a,{children:Object(r.jsx)(w.a,{})}),Object(r.jsx)(g.a,{primary:d.info.meta.title})]})}),Object(r.jsx)(L.b,{to:"/",children:Object(r.jsxs)(j.a,{button:!0,children:[Object(r.jsx)(v.a,{children:Object(r.jsx)(N.a,{})}),Object(r.jsx)(g.a,{primary:"Home"})]})}),Object(r.jsx)(L.b,{to:"/settings",children:Object(r.jsxs)(j.a,{button:!0,children:[Object(r.jsx)(v.a,{children:Object(r.jsx)(F.a,{})}),Object(r.jsx)(g.a,{primary:"Settings"})]})})]}),Object(r.jsx)(m.a,{})]})}()})]})}),Object(r.jsx)(Qe,{variant:"h6",children:p}),t,Object(r.jsx)(ze,{})]}),Object(r.jsx)(Ge,{})]})]})})),nt=n(127),rt=function(e){var t=e.ref,n=e.latency,r=void 0===n?300:n,o=e.onSingleClick,s=e.onDoubleClick;Object(a.useEffect)((function(){var e=t.current,n=0,a=function(e){n+=1,setTimeout((function(){1===n?o&&o(e):2===n&&s&&s(e),n=0}),r)};return null===e||void 0===e||e.addEventListener("click",a),function(){null===e||void 0===e||e.removeEventListener("click",a)}}))};function at(){var e=Object(f.a)(["\n  display: block;\n  width: 100%;\n  height: 100%;\n"]);return at=function(){return e},e}function ot(){var e=Object(f.a)(["\n  width: 115px;\n  height: 185px;\n  position: relative;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  word-break: break-all;\n  padding: 5px;\n  margin: 5px;\n  cursor: pointer;\n"]);return ot=function(){return e},e}var st=Object(Je.a)(nt.a)(ot()),it=Je.a.img(at()),ct=Object(p.a)((function(e){var t=e.book,n=e.children,o=e.onSingleClick,s=e.onDoubleClick,i=(Object(Te.a)(e,["book","children","onSingleClick","onDoubleClick"]),Object(a.useRef)());return rt({onSingleClick:o,onDoubleClick:s,ref:i,latency:200}),Object(r.jsxs)(st,{elevation:3,ref:i,children:[n,t.cover?Object(r.jsx)(r.Fragment,{children:Object(r.jsx)(it,{src:t.cover,alt:""})}):Object(r.jsx)("div",{children:t.name})]})})),lt=n(250),ut=n(249),xt=n(248),ft=n(247),pt=n(251),dt=n(264);function bt(){var e=Object(f.a)(["\n  height: 56px;\n  width: 100%;\n"]);return bt=function(){return e},e}var ht=Je.a.div(bt()),mt=Object(p.a)((function(e){var t=e.books,n=e.actions,o=e.dialogBookClickHandler,s=Object(a.useState)(!1),i=Object(x.a)(s,2),c=i[0],l=i[1],u=Object(a.useState)(null),f=Object(x.a)(u,2),p=f[0],d=f[1],b=function(){l(!1),d(null)},h=function(e){return o&&o(e)};return Object(r.jsxs)(r.Fragment,{children:[Object(r.jsxs)(dt.a,{display:"flex",justifyContent:"center",flexWrap:"wrap",children:[t.map((function(e,t){return Object(r.jsx)(ct,{book:e,onSingleClick:function(){return function(e){l(!0),d(e)}(e)},onDoubleClick:function(){return h(e)}},t)})),Object(r.jsx)(ht,{})]}),Object(r.jsxs)(ft.a,{onClose:b,open:c,fullWidth:!0,children:[Object(r.jsx)(xt.a,{}),Object(r.jsx)(ut.a,{children:Object(r.jsxs)(lt.a,{container:!0,justify:"center",spacing:2,children:[Object(r.jsx)(lt.a,{item:!0,children:p&&Object(r.jsx)(ct,{book:p,onSingleClick:function(){return h(p)}})}),Object(r.jsx)(lt.a,{item:!0,xs:8,children:Object(r.jsx)(S.a,{display:"block",noWrap:!0,children:null===p||void 0===p?void 0:p.name})})]})}),Object(r.jsx)(pt.a,{children:n.map((function(e,t){return Object(r.jsx)(D.a,{onClick:function(){return function(e){e.handler(p),b()}(e)},color:"primary",children:e.text},t)}))})]})]})})),jt=Object(p.a)((function(){var e=Object(a.useContext)(We),t=e.libraryStore,n=e.remoteLibraryStore,o=n.books,s=n.isBooksLoading,i=n.isLoggedIn,c=n.downloadBookAction,x=n.removeBookAction,f=t.isBookExist,p=function(){var e=Object(u.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!f(null===t||void 0===t?void 0:t.name)){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,c(t);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),d=[{text:"remove",handler:x},{text:"collect",handler:p}];return Object(r.jsx)(r.Fragment,{children:Object(r.jsx)("div",{className:"collection ".concat(i?"":"hidden"),children:Object(r.jsx)($e,{loading:s,children:Object(r.jsx)(mt,{books:o,dialogBookClickHandler:p,actions:d})})})})})),vt=n(29),gt=n(252),Ot=n(86),wt=n.n(Ot),kt=Object(d.a)((function(e){return{container:{position:"absolute",right:0,bottom:e.spacing(8)},fab:{right:e.spacing(2)},input:{display:"none"}}})),yt=Object(p.a)((function(e){var t=Object.assign({},e),n=Object(a.useContext)(We).libraryStore.addBookAction,o=Object(vt.a)(),s=kt(o);return Object(r.jsxs)("label",Object(Fe.a)(Object(Fe.a)({className:s.container},t),{},{htmlFor:"btn-add-book",children:[Object(r.jsx)("input",{type:"file",name:"",id:"btn-add-book",onChange:function(e){var t;if(null===(t=e.target.files)||void 0===t?void 0:t.length){var r=e.target.files[0];(function(e){return V.apply(this,arguments)})(r).then((function(e){n(e,r.name)}))}},accept:".fb2",className:s.input}),Object(r.jsx)(gt.a,{color:"primary",component:"span",className:s.fab,children:Object(r.jsx)(wt.a,{})})]}))})),St=(Object(p.a)((function(){return Object(r.jsx)("div",{className:"book-list-placeholder",children:Object(r.jsxs)("div",{className:"centered",children:[Object(r.jsxs)("div",{children:["Welcome! You haven't uploaded any books yet. Careful Reader supports",Object(r.jsx)("strong",{children:"\xa0fb2\xa0"}),"ones."]}),Object(r.jsx)(yt,{className:"add-btn-placeholder"})]})})})),Object(p.a)((function(){var e=Object(I.f)(),t=Object(a.useContext)(We),n=t.libraryStore,o=t.remoteLibraryStore,s=n.books,i=function(t){t&&e.push("/read/".concat(t.id))},c=[{text:"remove",handler:n.removeBookAction},{text:"read",handler:i},{text:"upload",handler:o.uploadBookAction},{text:"sync",handler:o.syncMetaAction}];return Object(r.jsx)(mt,{books:s,dialogBookClickHandler:i,actions:c})}))),Ct=n(122),Bt=n.n(Ct),At=n(254),It=n(255),Lt=n(253);function Tt(){var e=Object(f.a)([""]);return Tt=function(){return e},e}function Ft(){var e=Object(f.a)(["\n  position: fixed;\n  bottom: 0;\n  right: 0;\n  left: 0;\n"]);return Ft=function(){return e},e}function Pt(){var e=Object(f.a)(["\n  position: fixed;\n  right: 0;\n  bottom: 0;\n"]);return Pt=function(){return e},e}function Nt(){var e=Object(f.a)(["\n  overflow: auto;\n"]);return Nt=function(){return e},e}function Dt(){var e=Object(f.a)(["\n  position: relative;\n"]);return Dt=function(){return e},e}var Mt=Je.a.div(Dt()),Et=Je.a.div(Nt()),Ht=Je.a.div(Pt()),qt=Je.a.div(Ft()),Ut=Je.a.div(Tt()),Rt=Object(p.a)((function(){var e=Object(vt.a)(),t=o.a.useState(0),n=Object(x.a)(t,2),a=n[0],s=n[1],i={enter:e.transitions.duration.enteringScreen,exit:e.transitions.duration.leavingScreen},c=function(e){return s(e)},l=[{color:"primary",icon:Object(r.jsx)(wt.a,{}),label:"Add",clickHandler:function(){console.log("hey you")}}];return Object(r.jsxs)(Mt,{children:[Object(r.jsx)(tt,{}),Object(r.jsx)(Et,{children:Object(r.jsxs)(Bt.a,{index:a,onChangeIndex:c,children:[Object(r.jsx)(St,{}),Object(r.jsx)(jt,{}),Object(r.jsx)("div",{children:"favorite"})]})}),Object(r.jsx)(Ht,{children:l.map((function(e,t){return Object(r.jsx)(Lt.a,{in:a===t,timeout:i,style:{transitionDelay:"".concat(a===t?i.exit:0,"ms")},unmountOnExit:!0,children:Object(r.jsx)(yt,{})},e.color)}))}),Object(r.jsxs)(qt,{children:[Object(r.jsx)(Ut,{}),Object(r.jsxs)(At.a,{value:a,onChange:function(e,t){return c(t)},showLabels:!0,children:[Object(r.jsx)(It.a,{label:"local"}),Object(r.jsx)(It.a,{label:"remote"}),Object(r.jsx)(It.a,{label:"fav"})]})]})]})})),Wt=(n(183),n(124));function zt(e){var t=Object(Wt.a)(Array(100).keys()).sort((function(){return Math.random()-.5})),n=0,r=e.split(" ").map((function(e){return'<span class="w'.concat(t[n=n>=100?0:n+1],'">').concat(e,"</span>")})).join(" "),a=document.createElement("hlw");return a.innerHTML=r,a}function Jt(e){e.className.includes("hg")||function(e){for(var t,n=[],r=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,null,!1);t=r.nextNode();)n.push(t);return n}(e).forEach((function(t){if(t){var n=zt(t.textContent);t.replaceWith(n),e.className+=" hg"}}))}function Kt(e,t){var n=t.scrollTop,r=t.clientHeight,a=n+r,o=e.offsetTop,s=e.clientHeight,i=o+s;return o>=n&&o<a||i>n&&i<=a||s>r&&o<=n&&i>=a}var _t=n(123),Xt=n(269);function $t(){var e=Object(f.a)(["\n  white-space: nowrap;\n  padding: 6px 8px;\n"]);return $t=function(){return e},e}var Gt=Je.a.span($t()),Vt=function(e,t){var n=null;return function(){for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];null!==n&&(clearTimeout(n),n=null),n=setTimeout((function(){return e.apply(void 0,a)}),t)}}((function(e){return e&&e()}),100),Yt=Object(p.a)((function(){var e=Object(a.useContext)(We),t=e.appStore,n=e.libraryStore,o=t.wordsHighlight,s=t.dynamicTextOrientation,i=n.updateBookPositionAction,c=n.openBookAction,f=n.lastBook,p=Object(a.useRef)(f),d=Object(a.useState)(0),b=Object(x.a)(d,2),h=b[0],m=b[1],j=Object(a.useState)("0.0"),v=Object(x.a)(j,2),g=v[0],O=v[1],w=Object(a.useState)(0),k=Object(x.a)(w,2),y=k[0],S=k[1],C=Object(a.useState)(!1),B=Object(x.a)(C,2),A=B[0],L=B[1],T=Object(a.useRef)(null),F=Object(a.useRef)([]),P=Object(a.useState)(!1),N=Object(x.a)(P,2),D=N[0],M=N[1],E=Object(I.h)(),H=parseInt(E.bookId),q=Object(a.useState)({}),U=Object(x.a)(q,2),R=U[0],W=U[1];Object(a.useEffect)((function(){var e=T.current;return function(){var t=Object(u.a)(l.a.mark((function t(){var n,r;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return M(!0),t.next=3,c(H);case 3:n=t.sent,p.current=n,n&&(e.innerHTML=n.text),F.current=K(),S($()),r=[],null===e||void 0===e||e.querySelectorAll("p").forEach((function(e){return r.push(e.getAttribute("data-id"))})),n&&X(n.info.positionElement),M(!1);case 12:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()(),e.addEventListener("scroll",_),function(){return e.removeEventListener("scroll",_)}}),[]);var z=Object(Xt.a)(R,5),J=Object(x.a)(z,1)[0];return Object(_t.a)("deviceorientation",(function(e){var t=e.gamma;if(s){if(t){var n={transform:"rotateZ(".concat(-t,"deg)")};W(n)}}else W({transform:""})})),Object(r.jsxs)("div",{className:"reader",children:[Object(r.jsxs)(tt,{className:"".concat(A?"":" hidden"," "),title:function(){var e,t,n,r,a;return(null===(e=p.current)||void 0===e||null===(t=e.info)||void 0===t||null===(n=t.meta)||void 0===n?void 0:n.title)||(null===(r=p.current)||void 0===r||null===(a=r.info)||void 0===a?void 0:a.name)}(),children:[Object(r.jsxs)("div",{className:"",children:[g,"%"]}),Object(r.jsx)(Gt,{children:"".concat(h,"/").concat(y)})]}),Object(r.jsx)($e,{loading:D,children:Object(r.jsx)("div",{className:"list-view ".concat(o?"highlight":""),children:Object(r.jsx)("div",{className:"text-container",onClick:function(){L(!A)},style:J,ref:T})})})]});function K(){var e=[];return document.querySelectorAll("p").forEach((function(t){e.push(t)})),e.sort((function(e,t){return e.offsetTop>t.offsetTop}))}function _(e){var t=T.current,n=F.current;if(t){var r=function(){var e=T.current;return e?100*e.scrollTop/e.scrollHeight:0}();O(r.toFixed(2)),m(function(){var e=T.current;return Math.round(e.scrollTop/e.clientHeight)}()),Vt((function(){!function(e){if(e){var t,n=e.getAttribute("data-id"),r=null===(t=p.current)||void 0===t?void 0:t.info;r&&n&&i(r,n)}}((function(e,t){var n=[];if(!e)return n;for(var r=e.scrollTop+e.clientHeight,a=0;a<t.length;a++){var o=t[a];if(Kt(o,e)&&(Jt(o),n.push(o)),o.offsetTop>r)break}return n}(t,n)||[])[0])}))}}function X(e){if(e){var t=document.querySelector('[data-id="'.concat(e,'"]'));null===t||void 0===t||t.scrollIntoView()}}function $(){var e=T.current;return Math.round(e.scrollHeight/e.clientHeight)}})),Zt=n(257),Qt=n(263),en=n(256),tn=n(191),nn=n(270),rn=n(258),an=n(271),on=n(262),sn=n(266),cn=n.p+"static/media/page1.7720a4ef.jpg",ln=n.p+"static/media/page2.c690ddc0.jpg",un=n.p+"static/media/page3.ce566b3c.jpg";function xn(){var e=Object(f.a)(["\n  height: 56px;\n"]);return xn=function(){return e},e}function fn(){var e=Object(f.a)(["\n  margin: 10px;\n  min-width: 200px;\n"]);return fn=function(){return e},e}var pn=Object(Je.a)(en.a)(fn()),dn=Je.a.img(xn()),bn=Object(p.a)((function(){var e=Object(a.useContext)(We).appStore,t=e.locale,n=e.imageCover,o=e.wordsHighlight,s=e.isUseImageCover,i=e.pageBackgroundColor,c=e.dynamicTextOrientation,l=Object(Zt.a)(),u=function(t){var n=t.target.name,r="checkbox"===t.target.type?t.target.checked:t.target.value,a=e[n];"function"===typeof a&&a(r)};return Object(r.jsxs)(r.Fragment,{children:[Object(r.jsx)(tt,{}),Object(r.jsxs)(lt.a,{container:!0,children:[Object(r.jsx)(lt.a,{item:!0,xs:12,children:Object(r.jsxs)(pn,{children:[Object(r.jsx)(rn.a,{id:"language-select-label",children:l.formatMessage({id:"settings.language"})}),Object(r.jsxs)(sn.a,{labelId:"language-select-label",value:t,name:"setLocale",onChange:u,children:[Object(r.jsx)(on.a,{value:"ru",children:"\u0420\u0443\u0441\u0441\u043a\u0438\u0439"}),Object(r.jsx)(on.a,{value:"en",children:"English"})]})]})}),Object(r.jsx)(lt.a,{item:!0,xs:12,children:Object(r.jsxs)(pn,{children:[Object(r.jsx)(tn.a,{component:"legend",children:"\u041f\u043e\u0434\u0441\u0432\u0435\u0442\u043a\u0430 \u0441\u043b\u043e\u0432 \u0432 \u0442\u0435\u043a\u0441\u0442\u0435 \u0434\u043b\u044f \u0443\u043f\u0440\u043e\u0449\u0435\u043d\u0438\u044f \u043f\u043e\u0438\u0441\u043a\u0430 \u0441\u0442\u0440\u043e\u043a \u0433\u043b\u0430\u0437\u0430\u043c\u0438"}),Object(r.jsx)(Qt.a,{control:Object(r.jsx)(nn.a,{checked:o,onChange:u,name:"toggleHightligting"}),label:"\u041f\u043e\u0434\u0441\u0432\u0435\u0442\u043a\u0430 \u0441\u043b\u043e\u0432"})]})}),Object(r.jsx)(lt.a,{item:!0,xs:12,children:Object(r.jsxs)(pn,{children:[Object(r.jsx)(tn.a,{component:"legend",children:"\u041f\u043e\u0434\u0441\u0442\u0440\u0430\u0438\u0432\u0430\u0442\u044c \u043f\u043e\u043b\u043e\u0436\u0435\u043d\u0438\u0435 \u0442\u0435\u043a\u0441\u0442\u0430 \u0432 \u0437\u0430\u0432\u0438\u0441\u0438\u043c\u043e\u0441\u0442\u0438 \u043e\u0442 \u043e\u0440\u0438\u0435\u043d\u0442\u0430\u0446\u0438\u0438 \u0443\u0441\u0442\u0440\u043e\u0439\u0441\u0442\u0432\u0430"}),Object(r.jsx)(Qt.a,{control:Object(r.jsx)(nn.a,{checked:c,onChange:u,name:"toggleDynamicTextOrientation"}),label:"\u0414\u0438\u043d\u0430\u043c\u0438\u0447\u0435\u0441\u043a\u0430\u044f \u043e\u0440\u0438\u0435\u043d\u0442\u0430\u0446\u0438\u044f \u0442\u0435\u043a\u0441\u0442\u0430"})]})}),Object(r.jsxs)(lt.a,{item:!0,xs:12,children:[Object(r.jsxs)(pn,{children:[Object(r.jsx)(tn.a,{component:"legend",children:"\u041f\u043e\u0434\u043b\u043e\u0436\u043a\u0430 \u043a\u043d\u0438\u0433\u0438"}),Object(r.jsx)(Qt.a,{control:Object(r.jsx)(nn.a,{checked:s,onChange:u,name:"toggleUseImageCover"}),label:s?"\u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435":"\u0441\u043f\u043b\u043e\u0448\u043d\u043e\u0439 \u0442\u0435\u043a\u0441\u0442"})]}),s&&Object(r.jsxs)(pn,{children:[Object(r.jsx)(rn.a,{id:"cover-image-select-label",children:l.formatMessage({id:"settings.coverImage"})}),Object(r.jsxs)(sn.a,{labelId:"cover-image-select-label",value:n,name:"setImageCoverAction",onChange:u,children:[Object(r.jsx)(on.a,{value:"1",children:Object(r.jsx)(dn,{src:cn})}),Object(r.jsx)(on.a,{value:"2",children:Object(r.jsx)(dn,{src:ln})}),Object(r.jsx)(on.a,{value:"3",children:Object(r.jsx)(dn,{src:un})})]})]}),!s&&Object(r.jsx)(pn,{children:Object(r.jsx)(an.a,{id:"cover-bg-color-input-label",label:l.formatMessage({id:"settings.coverBgColor"}),type:"text",value:i,name:"setPageBackgroundColorAction",onChange:u,margin:"normal"})})]})]})]})})),hn=n(268),mn=n(267),jn=Object(p.a)((function(e){e.rootStore;var t=Object(a.useContext)(We).notifications;return Object(r.jsx)(r.Fragment,{children:t.map((function(e,t){var n=e.message,a=e.type;return Object(r.jsx)(vn,{message:n,index:t,type:a},"notification-".concat(t))}))})})),vn=function(e){var t=e.message,n=e.index,s=e.type,i=o.a.useState(!0),c=Object(x.a)(i,2),l=c[0],u=c[1],f=Object(a.useContext)(We),p=function(e,t){u(!1),f.removeNotification(n)};return Object(r.jsx)(hn.a,{anchorOrigin:{vertical:"top",horizontal:"left"},open:l,autoHideDuration:3e3,onClose:p,children:Object(r.jsx)(mn.a,{onClose:p,severity:"string"===typeof s?{info:"success",error:"error"}[s]:"success",children:t})})},gn=jn,On=new Re,wn=Object(p.a)((function(){var e=On.appStore,t=On.libraryStore,n=On.remoteLibraryStore,o=n.isLoggedIn,s=e.getLocaleMessages();Object(a.useEffect)((function(){t.fetchBooksListAction()}),[]);var i=function(){var e=Object(u.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!o){e.next=3;break}return e.next=3,n.fetchBooksListAction();case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(a.useEffect)((function(){i()}),[o]),Object(r.jsx)(We.Provider,{value:On,children:Object(r.jsxs)(U.b,{locale:e.locale,defaultLocale:e.defaultLocale,messages:s,children:[Object(r.jsx)(L.a,{basename:"/careful-reader",children:Object(r.jsxs)(I.c,{children:[Object(r.jsx)(I.a,{exact:!0,path:"/",children:Object(r.jsx)(Rt,{})}),Object(r.jsx)(I.a,{exact:!0,path:"/read/:bookId",children:Object(r.jsx)(Yt,{})}),Object(r.jsx)(I.a,{exact:!0,path:"/settings",children:Object(r.jsx)(bn,{})})]})}),Object(r.jsx)(gn,{})]})})})),kn=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function yn(e,t){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var n=e.installing;null!=n&&(n.onstatechange=function(){"installed"===n.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://bit.ly/CRA-PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}n(184);var Sn=Object(r.jsx)(wn,{});i.a.render(Sn,document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL("/careful-reader",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",(function(){var t="".concat("/careful-reader","/service-worker.js");kn?(!function(e,t){fetch(e).then((function(n){var r=n.headers.get("content-type");404===n.status||null!=r&&-1===r.indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):yn(e,t)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(t,e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://bit.ly/CRA-PWA")}))):yn(t,e)}))}}()},96:function(e){e.exports=JSON.parse('{"feed.close":"close...","feed.library":"library","feed.to-read":"to read...","settings.coverBgColor":"cover background color","settings.coverImage":"cover image","settings.language":"language"}')},97:function(e){e.exports=JSON.parse('{"feed.close":"close...","feed.library":"library","feed.to-read":"to read...","settings.coverBgColor":"cover background color","settings.coverImage":"cover image","settings.language":"language"}')}},[[185,1,2]]]);
//# sourceMappingURL=main.7d61d26f.chunk.js.map