(this["webpackJsonpcareful-reader-app"]=this["webpackJsonpcareful-reader-app"]||[]).push([[0],{150:function(e,t,n){},157:function(e,t,n){},176:function(e,t,n){},178:function(e,t,n){"use strict";n.r(t);var a=n(2),r=n(0),s=n.n(r),c=n(16),o=n.n(c),i=n(6),l=n.n(i),u=n(10),x=(n(150),n(25)),f=n(19);var p=n(17),d=n(228),b=n(259),m=n(229),h=n(232),j=n(183),v=n(230),g=n(231),O=n(111),w=n.n(O),k=n(233),y=n(234),C=n(60),B=n(235),A=n(114),I=n.n(A),T=n(18),L=n(38),S=n(113),P=n.n(S),F=n(112),M=n.n(F);n.p,n.p,n.p;var N=n(9),H=n(22),q=n(254),E=n(94),U=n(95);function W(e,t){var n=new DOMParser,a=new XSLTProcessor,r=n.parseFromString(e,"text/xml"),s=(new window.DOMParser).parseFromString(t,"text/xml");return a.importStylesheet(s),a.transformToFragment(r,document)}function D(e){var t=W(e,'<?xml version="1.0"?>\n<xsl:stylesheet\n    version="3.0"\n    xmlns:xsl="http://www.w3.org/1999/XSL/Transform"\n    xmlns:xlink="http://www.w3.org/1999/xlink"\n    xmlns:fb="http://www.gribuser.ru/xml/fictionbook/2.0">\n    <xsl:output method="text" omit-xml-declaration="yes" indent="no" encoding="UTF-8"/>\n<xsl:template match="/*">{<xsl:for-each select="fb:description/fb:title-info">\t\n    "title": "<xsl:value-of select="fb:book-title" />",\n    "genre": "<xsl:value-of select="fb:genre" />",\n    "author": {\n        "firstName": "<xsl:value-of select="fb:author/fb:first-name" />",\n        "lastName": "<xsl:value-of select="fb:author/fb:last-name" />"\n    },\n    "date": "<xsl:value-of select="fb:date" />",\n    "keywords": "<xsl:value-of select="fb:keywords" />",\n    "lang": "<xsl:value-of select="fb:lang" />"\n</xsl:for-each>}</xsl:template>\n</xsl:stylesheet>');return{meta:t.textContent?JSON.parse(t.textContent):{},cover:W(e,'<?xml version="1.0"?>\n<xsl:stylesheet\n    version="1.0"\n    xmlns:xsl="http://www.w3.org/1999/XSL/Transform"\n    xmlns:xlink="http://www.w3.org/1999/xlink"\n    xmlns:fb="http://www.gribuser.ru/xml/fictionbook/2.0">\n    <xsl:output method="text" omit-xml-declaration="yes" indent="no" encoding="UTF-8"/>\n    <xsl:template match="/*">\n    <xsl:for-each select="fb:description/fb:title-info/fb:coverpage/fb:image">\n        <xsl:call-template name="image"/>\n    </xsl:for-each>\n    </xsl:template>\n    <xsl:template match="fb:image" name="image">\n        <xsl:choose>\n            <xsl:when test="starts-with(@xlink:href,\'#\')">\n                <xsl:text>data:</xsl:text>\n                <xsl:variable name="href" select="substring-after(@xlink:href,\'#\')"/>\n                <xsl:value-of select="//fb:binary[@id=$href]/@content-type" disable-output-escaping="yes"/><xsl:text>;base64,</xsl:text>\n                <xsl:value-of select="//fb:binary[@id=$href]" disable-output-escaping="yes"/>\n            </xsl:when>\n            <xsl:otherwise>\n                <xsl:attribute name="src">\n                    <xsl:value-of select="@xlink:href"/>\n                </xsl:attribute>\n            </xsl:otherwise>\n        </xsl:choose>\n    </xsl:template>\n</xsl:stylesheet>').textContent}}var R="utf8",z=function(e){return e===R};function J(e){return((new RegExp(/<\?xml[^]+?>/gi).exec(e)||[])[0]||"").includes("windows-1251")?"windows-1251":R}function K(e){return _.apply(this,arguments)}function _(){return(_=Object(u.a)(l.a.mark((function e(t){var n,a,r=arguments;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:R,a=new FileReader,e.abrupt("return",new Promise((function(e,r){a.onload=function(t){var n,a=null===t||void 0===t||null===(n=t.target)||void 0===n?void 0:n.result;return a&&"string"===typeof a?e(a):r("")},a.onerror=function(e){return r("error reading file"+e)},a.readAsText(t,n)})));case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function X(){return(X=Object(u.a)(l.a.mark((function e(t){var n,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,K(t);case 2:if(n=e.sent,a=J(n),!z(a)){e.next=6;break}return e.abrupt("return",n);case 6:return e.next=8,K(t,a);case 8:return e.abrupt("return",e.sent);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function $(e){return new Promise((function(t,n){var a=document.createElement("script");return document.body.appendChild(a),a.onload=t,a.onerror=n,a.async=!0,a.src=e,e}))}var G=!1;function V(){return Y.apply(this,arguments)}function Y(){return(Y=Object(u.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!G){e.next=2;break}return e.abrupt("return",!0);case 2:return e.abrupt("return",$("https://apis.google.com/js/client:platform.js").then((function(){return new Promise((function(e,t){return window.gapi.load("auth2",(function(){return e(window.gapi.auth2)}))}))})).then((function(){return G=!0})).catch((function(){console.error("google api is not loaded")})));case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Z=!1,Q="https://www.googleapis.com/discovery/v1/apis/drive/v3/rest",ee="https://www.googleapis.com/auth/drive.appfolder https://www.googleapis.com/auth/drive";function te(){return ne.apply(this,arguments)}function ne(){return(ne=Object(u.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Z){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,V();case 4:return e.abrupt("return",new Promise((function(e,t){return window.gapi.client.init({apiKey:"AIzaSyCPUP5x1qzZKw0KqVvyKt7tH8EiK_8HUxY",clientId:"200803973510-oejcrm8bu57ai7gb5tt1h3hkff4ju49r.apps.googleusercontent.com",discoveryDocs:[Q],scope:ee}).then((function(){return Z=!0})).then(e).catch(t)})));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ae(){return re.apply(this,arguments)}function re(){return(re=Object(u.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,te();case 2:return e.prev=2,e.abrupt("return",window.gapi.auth2.getAuthInstance().signIn());case 6:e.prev=6,e.t0=e.catch(2),console.error("error in signIn",e.t0);case 9:case"end":return e.stop()}}),e,null,[[2,6]])})))).apply(this,arguments)}function se(){return ce.apply(this,arguments)}function ce(){return(ce=Object(u.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,te();case 2:return e.prev=2,e.abrupt("return",window.gapi.auth2.getAuthInstance().signOut());case 6:e.prev=6,e.t0=e.catch(2),console.error("error in signOut",e.t0);case 9:case"end":return e.stop()}}),e,null,[[2,6]])})))).apply(this,arguments)}function oe(){return ie.apply(this,arguments)}function ie(){return(ie=Object(u.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,te();case 2:return e.prev=2,e.abrupt("return",window.gapi.auth2.getAuthInstance()&&window.gapi.auth2.getAuthInstance().isSignedIn.get());case 6:return e.prev=6,e.t0=e.catch(2),console.error("error in isLoggedIn",e.t0),e.abrupt("return",!1);case 10:case"end":return e.stop()}}),e,null,[[2,6]])})))).apply(this,arguments)}var le="application/vnd.google-apps.folder",ue=function(e){return function(t){return function(){var n=Object(u.a)(l.a.mark((function n(a,r){var s,c,o;return l.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return console.log(e,t,a,r),s="folder"===t?le:"text/plain",c=r?[r]:"drive"===e?[]:[e],n.next=5,me(gapi.client.drive.files.create,{resource:{name:a,mimeType:s,parents:c},fields:"*"});case 5:return o=n.sent,n.abrupt("return",o.result);case 7:case"end":return n.stop()}}),n)})));return function(e,t){return n.apply(this,arguments)}}()}},xe=function(e){return function(t){return function(){var n=Object(u.a)(l.a.mark((function n(a){var r,s,c,o,i;return l.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:r="folder"===t?"and mimeType = '".concat(le,"'"):"and not mimeType = '".concat(le,"'"),s="".concat(a," ").concat(r),c=[],n.prev=3;case 4:return n.next=6,me(window.gapi.client.drive.files.list,{spaces:e,fields:"*",pageSize:100,pageToken:o,orderBy:"createdTime",q:s});case 6:i=n.sent,c=c.concat(i.result.files),o=i.result.nextPageToken;case 9:if(o){n.next=4;break}case 10:return n.abrupt("return",c);case 13:n.prev=13,n.t0=n.catch(3),console.error("can`t list items in drive with query: ",a,n.t0);case 16:case"end":return n.stop()}}),n,null,[[3,13]])})));return function(e){return n.apply(this,arguments)}}()}},fe=function(){var e=Object(u.a)(l.a.mark((function e(t){var n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,me(gapi.client.drive.files.get,{fileId:t,alt:"media"});case 2:return n=e.sent,e.abrupt("return",n.result||n.body);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),pe=function(){var e=Object(u.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,me(gapi.client.drive.files.delete,{fileId:t});case 3:return e.abrupt("return",!0);case 6:if(e.prev=6,e.t0=e.catch(0),404!==e.t0.status){e.next=10;break}return e.abrupt("return",!1);case 10:throw e.t0;case 11:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(t){return e.apply(this,arguments)}}(),de=function(e){return function(t){return function(){var n=Object(u.a)(l.a.mark((function n(a,r,s){var c;return l.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,xe(e)(t)(a);case 2:if(!(c=n.sent).length){n.next=7;break}n.t0=c,n.next=11;break;case 7:return n.next=9,ue(e)(t)(r,s);case 9:n.t1=n.sent,n.t0=[n.t1];case 11:return n.abrupt("return",n.t0);case 12:case"end":return n.stop()}}),n)})));return function(e,t,a){return n.apply(this,arguments)}}()}},be=function(e){return function(){var t=Object(u.a)(l.a.mark((function t(n,a){var r;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,me(gapi.client.request,{spaces:"drive"===e?[]:[e],path:"/upload/drive/v3/files/".concat(n),method:"PATCH",params:{uploadType:"media"},body:"string"===typeof a?a:JSON.stringify(a)});case 3:return r=t.sent,t.abrupt("return",r.result);case 7:t.prev=7,t.t0=t.catch(0),console.error("can`t upload file with: ",n,a,t.t0);case 10:case"end":return t.stop()}}),t,null,[[0,7]])})));return function(e,n){return t.apply(this,arguments)}}()};function me(e,t){return new Promise((function(n,a){return e(t).then((function(e){e&&(e.status<200||e.status>299)?(console.error("GAPI call returned bad status",e),a(e)):n(e)}),(function(e){return a(e)}))}))}var he=ue("drive"),je=xe("drive"),ve=de("drive"),ge=be("drive"),Oe={getOrCreate:{folder:ve("folder"),file:ve("file")},create:{folder:he("folder"),file:he("file")},find:{folder:je("folder"),file:je("file")},upload:ge,download:fe,remove:pe},we=ue("appDataFolder"),ke=xe("appDataFolder"),ye=de("appDataFolder"),Ce=be("appDataFolder"),Be={getOrCreate:{foder:ye("folder"),file:ye("file")},create:{folder:we("folder"),file:we("file")},find:{folder:xe("folder"),file:ke("file")},upload:Ce,download:fe,remove:pe},Ae=function(){var e=Object(H.c)();Object(q.a)({locale:"ru",messages:U},e),Object(q.a)({locale:"en",messages:E},e);var t={en:E,ru:U},n=Object(N.f)((function(e){if(!Object.keys(t).includes(e))throw Error("Unsupported locale");d.locale=e})),a=Object(N.f)((function(e){return d.imageCover=e})),r=Object(N.f)((function(){var e=d.locale;return t[e]})),s=Object(N.f)((function(e){d.wordsHighlight=e})),c=Object(N.f)((function(e){d.dynamicTextOrientation=e})),o=Object(N.f)((function(e){d.pageColor=e})),i=Object(N.f)((function(e){d.isUseImageCover=e})),x=Object(N.f)((function(e){d.pageBackgroundColor=e}));te().then((function(e){d.isClientLoaded=!0,oe().then((function(e){return d.isLoggedIn=e}))}));var f=Object(N.f)(Object(u.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ae();case 2:return e.next=4,oe();case 4:d.isLoggedIn=e.sent;case 5:case"end":return e.stop()}}),e)})))),p=Object(N.f)(Object(u.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,se();case 2:return e.next=4,oe();case 4:d.isLoggedIn=e.sent;case 5:case"end":return e.stop()}}),e)})))),d=Object(N.l)({defaultLocale:"en",locale:"en",wordsHighlight:!0,dynamicTextOrientation:!1,pageColor:"white",pageBackgroundColor:"#0000",messages:t,isLoggedIn:!1,isClientLoaded:!1,isUseImageCover:!0,imageCover:"1",setImageCoverAction:a,toggleUseImageCover:i,signInAction:f,signOutAction:p,toggleHightligting:s,toggleDynamicTextOrientation:c,setLocale:n,setPageColor:o,setPageBackgroundColorAction:x,getLocaleMessages:r});return d},Ie=s.a.createContext({}),Te=n(225),Le=Object(p.a)((function(){var e=Object(r.useContext)(Ie),t=e.isClientLoaded,n=e.isLoggedIn,s=e.signInAction,c=e.signOutAction;return Object(a.jsx)(a.Fragment,{children:t&&Object(a.jsx)(a.Fragment,{children:n?Object(a.jsx)(Te.a,{onClick:c,color:"inherit",children:"LogOut"}):Object(a.jsx)(Te.a,{onClick:s,color:"inherit",children:"Login"})})})})),Se=n(39),Pe=n(119),Fe="index",Me="books",Ne=Object(Pe.a)("library",1,{upgrade:function(e,t){t<1&&(e.createObjectStore(Fe,{keyPath:"id"}),e.createObjectStore(Me,{autoIncrement:!0}))}}),He=function(){var e=Object(u.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ne;case 2:return e.abrupt("return",e.sent.transaction([Fe,Me],"readwrite"));case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),qe={getBookMeta:function(e){return Object(u.a)(l.a.mark((function t(){return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Ne;case 2:return t.abrupt("return",t.sent.get(Fe,e));case 3:case"end":return t.stop()}}),t)})))()},getAllMeta:function(){return Object(u.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ne;case 2:return e.abrupt("return",e.sent.getAll(Fe));case 3:case"end":return e.stop()}}),e)})))()},getBookText:function(e){return Object(u.a)(l.a.mark((function t(){var n;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Ne;case 2:return t.next=4,t.sent.get(Me,e);case 4:if(n=t.sent){t.next=9;break}throw Error("can not find book ".concat(e," in the locale db"));case 9:return t.abrupt("return",n);case 10:case"end":return t.stop()}}),t)})))()},addBook:function(e){var t=arguments;return Object(u.a)(l.a.mark((function n(){var a,r,s,c,o;return l.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return a=t.length>1&&void 0!==t[1]?t[1]:"",r=Date.now(),n.next=4,He();case 4:return s=n.sent,n.next=7,s.objectStore(Me).add(a);case 7:return c=n.sent,o=Object(Se.a)(Object(Se.a)({},e),{},{id:c,timestamp:r}),n.next=11,s.objectStore(Fe).add(o);case 11:return n.next=13,s.done;case 13:return n.abrupt("return",o);case 14:case"end":return n.stop()}}),n)})))()},updateBookMeta:function(e,t){return Object(u.a)(l.a.mark((function n(){var a,r,s,c;return l.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,He();case 2:return a=n.sent,r=a.objectStore(Fe),n.next=6,r.get(e);case 6:return s=n.sent,c=Object(Se.a)(Object(Se.a)({},s),t),n.next=10,r.put(c);case 10:return n.next=12,a.done;case 12:return n.abrupt("return",c);case 13:case"end":return n.stop()}}),n)})))()},delete:function(e){return Object(u.a)(l.a.mark((function t(){var n;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,He();case 2:return n=t.sent,t.next=5,n.objectStore(Fe).delete(e);case 5:return t.next=7,n.objectStore(Me).delete(e);case 7:return t.next=9,n.done;case 9:case"end":return t.stop()}}),t)})))()},clear:function(){return Object(u.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,He();case 2:return t=e.sent,e.next=5,t.objectStore(Fe).clear();case 5:return e.next=7,t.objectStore(Me).clear();case 7:return e.next=9,t.done;case 9:case"end":return e.stop()}}),e)})))()}},Ee=function(){var e=Object(N.f)(Object(u.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,qe.getAllMeta();case 2:i.books=e.sent,console.info("book store",i.books);case 4:case"end":return e.stop()}}),e)})))),t=Object(N.f)(function(){var e=Object(u.a)(l.a.mark((function e(t,n){var a,r,s,c,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=D(t),r=a.cover,s=a.meta,c={name:n.name,meta:s,cover:r},i.isAddingBookInProcess=!0,e.next=5,qe.addBook(c,t);case 5:o=e.sent,i.books.push(o),i.isAddingBookInProcess=!1;case 8:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),n=Object(N.f)(function(){var e=Object(u.a)(l.a.mark((function e(t,n){var a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,qe.addBook(t,n);case 2:a=e.sent,i.books.push(a);case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),a=Object(N.f)(function(){var e=Object(u.a)(l.a.mark((function e(t){var n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,qe.delete(t.id);case 2:n=i.books.indexOf(t),i.books.splice(n,1);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),r=Object(N.f)(function(){var e=Object(u.a)(l.a.mark((function e(t,n){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,qe.updateBookMeta(t,{positionElement:n});case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),s=Object(N.f)(function(){var e=Object(u.a)(l.a.mark((function e(t,n){var a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(a=i.books.find((function(e){return e.id===t})))&&Object.assign(a,n),e.next=4,qe.updateBookMeta(t,n);case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),c=Object(N.f)(function(){var e=Object(u.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i.currentBook.info.id!==t){e.next=5;break}return e.next=3,qe.getBookMeta(t);case 3:return i.currentBook.info=e.sent,e.abrupt("return",Promise.resolve());case 5:return e.abrupt("return",Promise.all([qe.getBookMeta(t),qe.getBookText(t)]).then((function(e){i.currentBook.info=e[0];var t=e[1]||"";i.currentBook.text=W(t,'<?xml version="1.0"?>\n<xsl:stylesheet\n        version="3.0"\n        xmlns:xsl="http://www.w3.org/1999/XSL/Transform"\n        xmlns:xlink="http://www.w3.org/1999/xlink"\n        xmlns:fb="http://www.gribuser.ru/xml/fictionbook/2.0"\n        >\n    <xsl:output\n            media-type="text/html"\n            method="html"\n            encoding="utf-8"\n            omit-xml-declaration="yes"\n            doctype-public="HTML5"\n            />\n\n    <xsl:key name="note-link" match="fb:section" use="@id"/>\n    <xsl:template match="/*">\n        <div class="text">\n            <xsl:for-each select="fb:description/fb:title-info/fb:coverpage/fb:image">\n                <xsl:call-template name="image"/>\n            </xsl:for-each>\n\n            <xsl:for-each select="fb:description/fb:title-info/fb:annotation">\n                <section class="text-annotation">\n                    <xsl:call-template name="annotation"/>\n                </section>\n            </xsl:for-each>\n\n            \x3c!--<navMap style="display: none;">--\x3e\n                \x3c!--<xsl:apply-templates select="fb:body" mode="toc"/>--\x3e\n            \x3c!--</navMap>--\x3e\n\n\n            <xsl:for-each select="fb:body">\n                <xsl:if test="position() != 1">\n                    <div class="separator"></div>\n                </xsl:if>\n\n                \x3c!--<xsl:if test="not(fb:title) and @name">--\x3e\n                    \x3c!--<h4 align="center">--\x3e\n                        \x3c!--<xsl:value-of select="@name"/>--\x3e\n                    \x3c!--</h4>--\x3e\n                \x3c!--</xsl:if>--\x3e\n\n                <div class="text-wrapper">\n                    <xsl:apply-templates/>\n                </div>\n\n            </xsl:for-each>\n        </div>\n    </xsl:template>\n    \x3c!-- author template --\x3e\n    <xsl:template name="author">\n        <xsl:value-of select="fb:first-name"/>\n        <xsl:text disable-output-escaping="no">&#032;</xsl:text>\n        <xsl:value-of select="fb:middle-name"/>&#032;\n        <xsl:text disable-output-escaping="no">&#032;</xsl:text>\n        <xsl:value-of select="fb:last-name"/>\n        <br/>\n    </xsl:template>\n    \x3c!-- secuence template --\x3e\n    <xsl:template name="sequence">\n        <xsl:value-of select="@name"/>\n        <xsl:if test="@number">\n            <xsl:text disable-output-escaping="no">,&#032;#</xsl:text>\n            <xsl:value-of select="@number"/>\n        </xsl:if>\n        <xsl:if test="fb:sequence">\n            <ul>\n                <xsl:for-each select="fb:sequence">\n                    <xsl:call-template name="sequence"/>\n                </xsl:for-each>\n            </ul>\n        </xsl:if>\n    </xsl:template>\n    \x3c!-- toc template --\x3e\n    <xsl:template match="fb:section|fb:body" mode="toc">\n        <xsl:choose>\n            <xsl:when test="name()=\'body\' and position()=1 and not(fb:title)">\n                <xsl:apply-templates select="fb:section" mode="toc"/>\n            </xsl:when>\n            <xsl:otherwise>\n                <navPoint>\n                    <navLabel>\n                        <text>\n                            <xsl:value-of select="normalize-space(fb:title | @name)"/>\n                        </text>\n                    </navLabel>\n                    <content src="#TOC_{generate-id()}"></content>\n                    \x3c!--<xsl:value-of select="normalize-space(fb:title | //fb:body/@name)"/>--\x3e\n                    \x3c!--<xsl:value-of select="normalize-space(fb:body[@name == \'notes\']/@name | fb:body/title)"/>--\x3e\n\n                    \x3c!-- fb:body[@name = \'notes\'] --\x3e\n                    <xsl:if test="fb:section">\n                        <navPoint>\n                            <xsl:apply-templates select="fb:section" mode="toc"/>\n                        </navPoint>\n                    </xsl:if>\n                </navPoint>\n            </xsl:otherwise>\n        </xsl:choose>\n    </xsl:template>\n    \x3c!-- description --\x3e\n    <xsl:template match="fb:description">\n        <xsl:apply-templates/>\n    </xsl:template>\n    \x3c!-- body --\x3e\n    <xsl:template match="fb:body">\n        <div>\n            <xsl:apply-templates/>\n        </div>\n    </xsl:template>\n\n    <xsl:template match="fb:section">\n        <section>\n            <xsl:attribute name="class">\n                <xsl:text>default-section</xsl:text>\n                <xsl:if test="starts-with(translate(fb:title, \'\u0413\u041b\u0410\u0412\u0410\', \'\u0433\u043b\u0430\u0432\u0430\'), \'\u0433\u043b\u0430\u0432\u0430\')">\n                    <xsl:text> chapter</xsl:text>\n                </xsl:if>\n            </xsl:attribute>\n            <a name="TOC_{generate-id()}"></a>\n            <xsl:if test="@id">\n                <xsl:element name="a">\n                    <xsl:attribute name="name">\n                        <xsl:value-of select="@id"/>\n                    </xsl:attribute>\n                </xsl:element>\n            </xsl:if>\n            <xsl:apply-templates/>\n        </section>\n    </xsl:template>\n    <xsl:template match="fb:body[@name=\'notes\']//fb:section">\n        <div>\n            <xsl:if test="@id">\n                <xsl:attribute name="class">\n                    <xsl:value-of select="\'annotation\'"/>\n                </xsl:attribute>\n            </xsl:if>\n            <a name="TOC_{generate-id()}"></a>\n            <xsl:if test="@id">\n                <xsl:element name="a">\n                    <xsl:attribute name="name">\n                        <xsl:value-of select="@id"/>\n                    </xsl:attribute>\n                </xsl:element>\n            </xsl:if>\n            <xsl:apply-templates/>\n        </div>\n    </xsl:template>\n\n\n    \x3c!-- section/title --\x3e\n    <xsl:template match="fb:section/fb:title|fb:poem/fb:title">\n        <xsl:choose>\n            <xsl:when test="count(ancestor::node()) &lt; 9">\n                <xsl:element name="{concat(\'h\',count(ancestor::node())-3)}">\n                    <a name="TOC_{generate-id()}"></a>\n                    <xsl:if test="@id">\n                        <xsl:element name="a">\n                            <xsl:attribute name="name">\n                                <xsl:value-of select="@id"/>\n                            </xsl:attribute>\n                        </xsl:element>\n                    </xsl:if>\n                    <xsl:apply-templates/>\n                </xsl:element>\n            </xsl:when>\n            <xsl:otherwise>\n                <xsl:element name="h6">\n                    <xsl:if test="@id">\n                        <xsl:element name="a">\n                            <xsl:attribute name="name">\n                                <xsl:value-of select="@id"/>\n                            </xsl:attribute>\n                        </xsl:element>\n                    </xsl:if>\n                    <xsl:apply-templates/>\n                </xsl:element>\n            </xsl:otherwise>\n        </xsl:choose>\n    </xsl:template>\n    \x3c!-- section/title --\x3e\n    <xsl:template match="fb:body/fb:title">\n        \x3c!--<h1 style="display: none;">--\x3e\n            \x3c!--<xsl:apply-templates mode="title"/>--\x3e\n        \x3c!--</h1>--\x3e\n    </xsl:template>\n    <xsl:template match="fb:body[@name=\'notes\']/fb:title">\n        <h1>\n            <xsl:apply-templates mode="title"/>\n        </h1>\n    </xsl:template>\n\n    <xsl:template match="fb:title/fb:p">\n        <xsl:apply-templates/>\n        <xsl:text disable-output-escaping="no">&#032;</xsl:text>\n        <br/>\n    </xsl:template>\n    \x3c!-- subtitle --\x3e\n    <xsl:template match="fb:subtitle">\n        <xsl:if test="@id">\n            <xsl:element name="a">\n                <xsl:attribute name="name">\n                    <xsl:value-of select="@id"/>\n                </xsl:attribute>\n            </xsl:element>\n        </xsl:if>\n        <h5>\n            <xsl:apply-templates/>\n        </h5>\n    </xsl:template>\n    \x3c!-- p --\x3e\n    <xsl:template match="fb:p">\n        \x3c!--<xsl:if test"preceding-sibling::*[1][name()] != \'fb:image\'">--\x3e\n            <p data-id="{position()}-{last()}}">\n                <xsl:if test="@id">\n                    <xsl:element name="a">\n                        <xsl:attribute name="name">\n                            <xsl:value-of select="@id"/>\n                        </xsl:attribute>\n                    </xsl:element>\n                </xsl:if>\n                <xsl:apply-templates/>\n            </p>\n        \x3c!--</xsl:if>--\x3e\n    </xsl:template>\n    \x3c!-- strong --\x3e\n    <xsl:template match="fb:strong">\n        <b>\n            <xsl:apply-templates/>\n        </b>\n    </xsl:template>\n    \x3c!-- emphasis --\x3e\n    <xsl:template match="fb:emphasis">\n        <i>\n            <xsl:apply-templates/>\n        </i>\n    </xsl:template>\n    \x3c!-- style --\x3e\n    <xsl:template match="fb:style">\n        <span class="{@name}">\n            <xsl:apply-templates/>\n        </span>\n    </xsl:template>\n    \x3c!-- empty-line --\x3e\n    <xsl:template match="fb:empty-line">\n        <xsl:if test="following-sibling::*[1] != fb:image">\n            <br/>\n        </xsl:if>\n    </xsl:template>\n    \x3c!-- link --\x3e\n    <xsl:template match="fb:a">\n        <xsl:choose>\n            <xsl:when test="starts-with(@xlink:href,\'#\')">\n                <xsl:element name="a">\n                    <xsl:attribute name="class">\n                        <xsl:value-of select="\'footnote\'"/>\n                    </xsl:attribute>\n                    <xsl:attribute name="href">\n                        <xsl:value-of select="@xlink:href"/>\n                    </xsl:attribute>\n                    <xsl:attribute name="title">\n                        <xsl:value-of select="key(\'note-link\',substring-after(@xlink:href,\'#\'))/fb:p"/>\n                    </xsl:attribute>\n                    <xsl:choose>\n                        <xsl:when test="(@type) = \'note\'">\n                            <sup>\n                                <xsl:apply-templates/>\n                            </sup>\n                        </xsl:when>\n                        <xsl:otherwise>\n                            <xsl:apply-templates/>\n                        </xsl:otherwise>\n                    </xsl:choose>\n                </xsl:element>\n            </xsl:when>\n            <xsl:otherwise>\n                <xsl:element name="span">\n                    <xsl:choose>\n                        <xsl:when test="(@type) = \'note\'">\n                            <sup>\n                                <xsl:apply-templates/>\n                            </sup>\n                        </xsl:when>\n                        <xsl:otherwise>\n                            <xsl:apply-templates/>\n                        </xsl:otherwise>\n                    </xsl:choose>\n                </xsl:element>\n            </xsl:otherwise>\n        </xsl:choose>\n    </xsl:template>\n    \x3c!-- annotation --\x3e\n    <xsl:template name="annotation">\n        <xsl:if test="@id">\n            <xsl:element name="a">\n                <xsl:attribute name="name">\n                    <xsl:value-of select="@id"/>\n                </xsl:attribute>\n            </xsl:element>\n        </xsl:if>\n        <xsl:apply-templates/>\n    </xsl:template>\n    \x3c!-- epigraph --\x3e\n    <xsl:template match="fb:epigraph">\n        <blockquote class="epigraph">\n            <xsl:if test="@id">\n                <xsl:element name="a">\n                    <xsl:attribute name="name">\n                        <xsl:value-of select="@id"/>\n                    </xsl:attribute>\n                </xsl:element>\n            </xsl:if>\n            <xsl:apply-templates/>\n        </blockquote>\n    </xsl:template>\n    \x3c!-- epigraph/text-author --\x3e\n    <xsl:template match="fb:epigraph/fb:text-author">\n        <blockquote class="author">\n            <i>\n                <xsl:apply-templates/>\n            </i>\n        </blockquote>\n    </xsl:template>\n    \x3c!-- cite --\x3e\n    <xsl:template match="fb:cite">\n        <blockquote>\n            <xsl:if test="@id">\n                <xsl:element name="a">\n                    <xsl:attribute name="name">\n                        <xsl:value-of select="@id"/>\n                    </xsl:attribute>\n                </xsl:element>\n            </xsl:if>\n            <xsl:apply-templates/>\n        </blockquote>\n    </xsl:template>\n    \x3c!-- cite/text-author --\x3e\n    <xsl:template match="fb:text-author">\n        <blockquote>\n            <i>\n                <xsl:apply-templates/>\n            </i>\n        </blockquote>\n    </xsl:template>\n    \x3c!-- date --\x3e\n    <xsl:template match="fb:date">\n        <xsl:choose>\n            <xsl:when test="not(@value)">\n                &#160;&#160;&#160;\n                <xsl:apply-templates/>\n                <br/>\n            </xsl:when>\n            <xsl:otherwise>\n                &#160;&#160;&#160;<xsl:value-of select="@value"/>\n                <br/>\n            </xsl:otherwise>\n        </xsl:choose>\n    </xsl:template>\n    \x3c!-- poem --\x3e\n    <xsl:template match="fb:poem">\n        <blockquote>\n            <xsl:if test="@id">\n                <xsl:element name="a">\n                    <xsl:attribute name="name">\n                        <xsl:value-of select="@id"/>\n                    </xsl:attribute>\n                </xsl:element>\n            </xsl:if>\n            <xsl:apply-templates/>\n        </blockquote>\n    </xsl:template>\n\n    \x3c!-- stanza --\x3e\n    <xsl:template match="fb:stanza">\n        <xsl:apply-templates/>\n        <br/>\n    </xsl:template>\n    \x3c!-- v --\x3e\n    <xsl:template match="fb:v">\n        <xsl:if test="@id">\n            <xsl:element name="a">\n                <xsl:attribute name="name">\n                    <xsl:value-of select="@id"/>\n                </xsl:attribute>\n            </xsl:element>\n        </xsl:if>\n        <xsl:apply-templates/>\n        <br/>\n    </xsl:template>\n    \x3c!-- image --\x3e\n    <xsl:template match="fb:image" name="image">\n        <div>\n            <xsl:choose>\n                <xsl:when test="ancestor::fb:coverpage">\n                    <xsl:attribute name="class">\n                        <xsl:value-of select="\'text-cover\'"/>\n                    </xsl:attribute>\n                </xsl:when>\n                <xsl:otherwise>\n                    <xsl:attribute name="class">\n                        <xsl:text>default image</xsl:text>\n                    </xsl:attribute>\n                </xsl:otherwise>\n            </xsl:choose>\n            <div class="image-wrapper">\n                <img>\n                    <xsl:choose>\n                        <xsl:when test="starts-with(@xlink:href,\'#\')">\n                            <xsl:attribute name="src">\n                                <xsl:text>data:</xsl:text>\n                                <xsl:variable name="href" select="substring-after(@xlink:href,\'#\')"/>\n                                <set variable="href" expression="substring-after(@xlink:href,\'#\')"/>\n                                <xsl:value-of select="//fb:binary[@id=$href]/@content-type" disable-output-escaping="yes"/><xsl:text>;base64,</xsl:text>\n                                \x3c!--<xsl:value-of select="substring-after(@xlink:href,\'#\')"/>--\x3e\n                                <xsl:value-of select="//fb:binary[@id=$href]" disable-output-escaping="yes"/>\n                            </xsl:attribute>\n\n                        </xsl:when>\n                        <xsl:otherwise>\n                            <xsl:attribute name="src">\n                                <xsl:value-of select="@xlink:href"/>\n                            </xsl:attribute>\n                        </xsl:otherwise>\n                    </xsl:choose>\n                </img>\n            </div>\n            <xsl:if test="following-sibling::node()[1]/fb:emphasis">\n                <div class="image-annotation">\n                    <xsl:apply-templates select="following-sibling::fb:p[1]"/>\n                </div>\n            </xsl:if>\n        </div>\n    </xsl:template>\n</xsl:stylesheet>').children[0].innerHTML||""})));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),o=Object(N.f)(function(){var e=Object(u.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,qe.getBookText(t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),i=Object(N.l)({books:[],remoteBooks:[],currentBook:{info:{},text:""},isAddingBookInProcess:!1,fetchBooksListAction:e,fetchBookTextAction:o,addBookAction:t,openBookAction:c,syncBookAction:n,removeBookAction:a,updateBookAction:s,updateBookPositionAction:r});return i},Ue=s.a.createContext({}),We=n(20);function De(){var e=Object(f.a)(["\n    overflow: hidden;\n    text-overflow: ellipsis;\n    white-space: nowrap;\n    flex-grow: 1;\n"]);return De=function(){return e},e}function Re(){var e=Object(f.a)([""]);return Re=function(){return e},e}var ze=We.a.div(Re()),Je=Object(We.a)(C.a)(De()),Ke=Object(d.a)({list:{width:250},menuButton:{marginRight:""},title:{flexGrow:1}}),_e=Object(p.a)((function(e){var t=e.children,n=(e.className,e.title),c=Ke(),o=Object(r.useState)(!1),i=Object(x.a)(o,2),l=i[0],u=i[1],f=Object(T.g)().pathname||"",p=n||{"/":"Library","/settings":"Settings"}[f],d=Object(r.useContext)(Ue).currentBook,O=function(e){return function(t){("keydown"!==t.type||"Tab"!==t.key&&"Shift"!==t.key)&&u(e)}};return Object(a.jsxs)(a.Fragment,{children:[Object(a.jsxs)(ze,{children:[Object(a.jsx)(k.a,{}),Object(a.jsx)(y.a,{})]}),Object(a.jsx)(k.a,{position:"fixed",children:Object(a.jsxs)(y.a,{children:[Object(a.jsx)(B.a,{edge:"start",className:c.menuButton,color:"inherit","aria-label":"menu",children:Object(a.jsxs)(s.a.Fragment,{children:[Object(a.jsx)(I.a,{onClick:O(!0)}),Object(a.jsx)(b.a,{anchor:"left",open:l,onClose:O(!1),children:function(){var e;return Object(a.jsxs)("div",{className:c.list,role:"presentation",onClick:O(!1),onKeyDown:O(!1),children:[Object(a.jsxs)(m.a,{children:[(null===d||void 0===d||null===(e=d.meta)||void 0===e?void 0:e.meta)&&Object(a.jsx)(L.b,{to:"/read/".concat(d.meta.id),children:Object(a.jsxs)(j.a,{button:!0,children:[Object(a.jsx)(v.a,{children:Object(a.jsx)(w.a,{})}),Object(a.jsx)(g.a,{primary:d.meta.meta.title})]})}),Object(a.jsx)(L.b,{to:"/",children:Object(a.jsxs)(j.a,{button:!0,children:[Object(a.jsx)(v.a,{children:Object(a.jsx)(M.a,{})}),Object(a.jsx)(g.a,{primary:"Home"})]})}),Object(a.jsx)(L.b,{to:"/settings",children:Object(a.jsxs)(j.a,{button:!0,children:[Object(a.jsx)(v.a,{children:Object(a.jsx)(P.a,{})}),Object(a.jsx)(g.a,{primary:"Settings"})]})})]}),Object(a.jsx)(h.a,{})]})}()})]})}),Object(a.jsx)(Je,{variant:"h6",children:p}),t,Object(a.jsx)(Le,{})]})})]})})),Xe=function(){var e="careful-reader",t=Object(N.f)(Object(u.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Oe.create.folder("books-folder");case 1:case"end":return e.stop()}}),e)}))));te().then((function(){f.isClientLoaded=!0,oe().then((function(e){return f.isLoggedIn=e}))}));var n=Be,a=Oe,r=Object(N.f)(Object(u.a)(l.a.mark((function e(){var t,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return f.isBooksLoading=!0,e.next=3,n.find.file("name contains '-meta.json'");case 3:return t=e.sent,a=t.map((function(e){return n.download(e.id).then((function(e){var t=e;f.books.push(t)}))})),f.books=[],e.next=8,Promise.all(a);case 8:f.isBooksLoading=!1;case 9:case"end":return e.stop()}}),e)})))),s=Object(N.f)(function(){var t=Object(u.a)(l.a.mark((function t(n){var r,s,o,i,u,p,d,b,m,h,j;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return f.isUploading=!0,t.next=3,a.getOrCreate.folder("name = '".concat(e,"'"),e);case 3:return r=t.sent,s=Object(x.a)(r,1),o=s[0],t.next=8,a.getOrCreate.file("name = '".concat(n.name,"' and '").concat(o.id,"' in parents"),n.name,o.id);case 8:return i=t.sent,u=Object(x.a)(i,1),p=u[0],t.next=13,qe.getBookText(n.id);case 13:return d=t.sent,t.next=16,a.upload(p.id,d);case 16:return b=t.sent,m=b.id,t.next=20,qe.updateBookMeta(n.id,{textFileId:m});case 20:return h=t.sent,t.next=23,c(h);case 23:return j=t.sent,f.isUploading=!1,t.abrupt("return",j);case 26:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),c=Object(N.f)(function(){var e=Object(u.a)(l.a.mark((function e(t){var a,r,s,c,o,i,u;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return f.isUploading=!0,a=t.name+"-meta.json",e.next=4,n.getOrCreate.file("name = '".concat(a,"'"),a);case 4:return r=e.sent,s=Object(x.a)(r,1),c=s[0],e.next=9,n.upload(c.id,JSON.stringify(t));case 9:return o=e.sent,i=o.id,e.next=13,qe.updateBookMeta(t.id,{metaFileId:i});case 13:return u=e.sent,f.isUploading=!1,e.abrupt("return",u);case 16:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),o=Object(N.f)(function(){var e=Object(u.a)(l.a.mark((function e(t){var n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("wtf",t),!t.textFileId){e.next=6;break}return e.next=4,a.download(t.textFileId);case 4:n=e.sent,console.log("result",n);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),i=Object(N.f)(function(){var e=Object(u.a)(l.a.mark((function e(t){var r,s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=[],t.textFileId&&r.push(a.remove(t.textFileId)),t.metaFileId&&r.push(n.remove(t.metaFileId)),e.next=5,Promise.all(r);case 5:s=e.sent,console.log("remove",s);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),f=Object(N.l)({books:[],isClientLoaded:!1,isLoggedIn:!1,isBooksLoading:!1,isUploading:!1,initLibrary:t,uploadBookAction:s,syncMetaAction:c,downloadBookAction:o,removeBookAction:i,fetchBooksListAction:r});return f},$e=s.a.createContext({});n(157);function Ge(){var e=Object(f.a)(["\n  display: ",";\n"]);return Ge=function(){return e},e}var Ve=We.a.div(Ge(),(function(e){return e.switch?"block":"none"}));function Ye(e){var t=e.loading,n=e.children;return Object(a.jsxs)(a.Fragment,{children:[Object(a.jsx)(Ve,{switch:t,children:Object(a.jsx)("div",{children:"Loading"})}),n]})}var Ze=n(120),Qe=n(122);function et(){var e=Object(f.a)(["\n  display: block;\n  width: 100%;\n  height: 100%;\n"]);return et=function(){return e},e}function tt(){var e=Object(f.a)(["\n  width: 115px;\n  height: 185px;\n  position: relative;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  word-break: break-all;\n  padding: 5px;\n  margin: 5px;\n"]);return tt=function(){return e},e}var nt=Object(We.a)(Qe.a)(tt()),at=We.a.img(et()),rt=Object(p.a)((function(e){var t=e.book,n=e.children,r=e.onClick;Object(Ze.a)(e,["book","children","onClick"]);return Object(a.jsxs)(nt,{elevation:3,onClick:function(){return r&&r(t)},children:[n,t.cover?Object(a.jsx)(a.Fragment,{children:Object(a.jsx)(at,{src:t.cover,alt:""})}):Object(a.jsx)("div",{children:t.name})]})})),st=n(239),ct=n(238),ot=n(237),it=n(236),lt=n(240),ut=n(253);function xt(){var e=Object(f.a)(["\n  height: 56px;\n  width: 100%;\n"]);return xt=function(){return e},e}var ft=We.a.div(xt()),pt=Object(p.a)((function(e){var t=e.books,n=e.actions,s=e.dialogBookClickHandler,c=Object(r.useState)(!1),o=Object(x.a)(c,2),i=o[0],l=o[1],u=Object(r.useState)(null),f=Object(x.a)(u,2),p=f[0],d=f[1],b=function(e){l(!0),d(e)},m=function(){l(!1),d(null)};return Object(a.jsxs)(a.Fragment,{children:[Object(a.jsxs)(ut.a,{display:"flex",justifyContent:"center",flexWrap:"wrap",children:[t.map((function(e,t){return Object(a.jsx)(rt,{book:e,onClick:b},t)})),Object(a.jsx)(ft,{})]}),Object(a.jsxs)(it.a,{onClose:m,open:i,fullWidth:!0,children:[Object(a.jsx)(ot.a,{}),Object(a.jsx)(ct.a,{children:Object(a.jsxs)(st.a,{container:!0,justify:"center",spacing:2,children:[Object(a.jsx)(st.a,{item:!0,children:p&&Object(a.jsx)(rt,{book:p,onClick:function(){return s&&s(p)}})}),Object(a.jsx)(st.a,{item:!0,xs:8,children:Object(a.jsx)(C.a,{display:"block",noWrap:!0,children:null===p||void 0===p?void 0:p.name})})]})}),Object(a.jsx)(lt.a,{children:n.map((function(e,t){return Object(a.jsx)(Te.a,{onClick:function(){return function(e){e.handler(p),m()}(e)},color:"primary",children:e.text},t)}))})]})]})})),dt=Object(p.a)((function(){var e=Object(r.useContext)($e),t=e.books,n=e.isBooksLoading,s=e.isLoggedIn,c=e.downloadBookAction,o=e.removeBookAction,i=Object(r.useContext)(Ue),x=(i.books,i.updateBookAction,i.syncBookAction,function(){var e=Object(u.a)(l.a.mark((function e(t){var n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c(t);case 2:n=e.sent,console.log("collect book",t,n);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),f=[{text:"remove",handler:o},{text:"collect",handler:x}];return console.log("cloud books",t),Object(a.jsx)(a.Fragment,{children:Object(a.jsx)("div",{className:"collection ".concat(s?"":"hidden"),children:Object(a.jsx)(Ye,{loading:n,children:Object(a.jsx)(pt,{books:t,dialogBookClickHandler:x,actions:f})})})})})),bt=n(30),mt=n(241),ht=n(86),jt=n.n(ht),vt=Object(d.a)((function(e){return{container:{position:"absolute",right:0,bottom:e.spacing(8)},fab:{right:e.spacing(2)},input:{display:"none"}}})),gt=Object(p.a)((function(e){var t=Object.assign({},e),n=Object(r.useContext)(Ue).addBookAction,s=Object(bt.a)(),c=vt(s);return Object(a.jsxs)("label",Object(Se.a)(Object(Se.a)({className:c.container},t),{},{htmlFor:"btn-add-book",children:[Object(a.jsx)("input",{type:"file",name:"",id:"btn-add-book",onChange:function(e){var t;if(null===(t=e.target.files)||void 0===t?void 0:t.length){var a=e.target.files[0];(function(e){return X.apply(this,arguments)})(a).then((function(e){n(e,a)}))}},accept:".fb2",className:c.input}),Object(a.jsx)(mt.a,{color:"primary",component:"span",className:c.fab,children:Object(a.jsx)(jt.a,{})})]}))})),Ot=(Object(p.a)((function(){return Object(a.jsx)("div",{className:"book-list-placeholder",children:Object(a.jsxs)("div",{className:"centered",children:[Object(a.jsxs)("div",{children:["Welcome! You haven't uploaded any books yet. Careful Reader supports",Object(a.jsx)("strong",{children:"\xa0fb2\xa0"}),"ones."]}),Object(a.jsx)(gt,{className:"add-btn-placeholder"})]})})})),Object(p.a)((function(){var e=Object(T.f)(),t=Object(r.useContext)(Ue),n=t.books,s=t.removeBookAction,c=Object(r.useContext)($e),o=function(t){t&&e.push("/read/".concat(t.id))},i=[{text:"remove",handler:s},{text:"read",handler:o},{text:"upload",handler:c.uploadBookAction},{text:"sync",handler:c.syncMetaAction}];return Object(a.jsx)(a.Fragment,{children:Object(a.jsx)(pt,{books:n,dialogBookClickHandler:o,actions:i})})}))),wt=n(115),kt=n.n(wt),yt=n(243),Ct=n(244),Bt=n(242);function At(){var e=Object(f.a)([""]);return At=function(){return e},e}function It(){var e=Object(f.a)(["\n  position: fixed;\n  bottom: 0;\n  right: 0;\n  left: 0;\n"]);return It=function(){return e},e}function Tt(){var e=Object(f.a)(["\n  position: fixed;\n  right: 0;\n  bottom: 0;\n"]);return Tt=function(){return e},e}function Lt(){var e=Object(f.a)(["\n  overflow: auto;\n"]);return Lt=function(){return e},e}function St(){var e=Object(f.a)(["\n  position: relative;\n"]);return St=function(){return e},e}var Pt=We.a.div(St()),Ft=We.a.div(Lt()),Mt=We.a.div(Tt()),Nt=We.a.div(It()),Ht=We.a.div(At()),qt=Object(p.a)((function(){var e=Object(bt.a)(),t=s.a.useState(0),n=Object(x.a)(t,2),r=n[0],c=n[1],o={enter:e.transitions.duration.enteringScreen,exit:e.transitions.duration.leavingScreen},i=function(e){return c(e)},l=[{color:"primary",icon:Object(a.jsx)(jt.a,{}),label:"Add",clickHandler:function(){console.log("hey you")}}];return Object(a.jsxs)(Pt,{children:[Object(a.jsx)(_e,{}),Object(a.jsx)(Ft,{children:Object(a.jsxs)(kt.a,{index:r,onChangeIndex:i,children:[Object(a.jsx)(Ot,{}),Object(a.jsx)(dt,{}),Object(a.jsx)("div",{children:"favorite"})]})}),Object(a.jsx)(Mt,{children:l.map((function(e,t){return Object(a.jsx)(Bt.a,{in:r===t,timeout:o,style:{transitionDelay:"".concat(r===t?o.exit:0,"ms")},unmountOnExit:!0,children:Object(a.jsx)(gt,{})},e.color)}))}),Object(a.jsxs)(Nt,{children:[Object(a.jsx)(Ht,{}),Object(a.jsxs)(yt.a,{value:r,onChange:function(e,t){return i(t)},showLabels:!0,children:[Object(a.jsx)(Ct.a,{label:"local"}),Object(a.jsx)(Ct.a,{label:"remote"}),Object(a.jsx)(Ct.a,{label:"fav"})]})]})]})})),Et=(n(176),n(118));function Ut(e){var t=Object(Et.a)(Array(100).keys()).sort((function(){return Math.random()-.5})),n=0,a=e.split(" ").map((function(e){return'<span class="w'.concat(t[n=n>=100?0:n+1],'">').concat(e,"</span>")})).join(" "),r=document.createElement("hlw");return r.innerHTML=a,r}function Wt(e){e.className.includes("hg")||function(e){for(var t,n=[],a=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,null,!1);t=a.nextNode();)n.push(t);return n}(e).forEach((function(t){if(t){var n=Ut(t.textContent);t.replaceWith(n),e.className+=" hg"}}))}function Dt(e,t){var n=t.scrollTop,a=t.clientHeight,r=n+a,s=e.offsetTop,c=e.clientHeight,o=s+c;return s>=n&&s<r||o>n&&o<=r||c>a&&s<=n&&o>=r}var Rt=n(116),zt=n(256);function Jt(){var e=Object(f.a)(["\n  white-space: nowrap;\n  padding: 6px 8px;\n"]);return Jt=function(){return e},e}var Kt=We.a.span(Jt()),_t=function(e,t){var n=null;return function(){for(var a=arguments.length,r=new Array(a),s=0;s<a;s++)r[s]=arguments[s];null!==n&&(clearTimeout(n),n=null),n=setTimeout((function(){return e.apply(void 0,r)}),t)}}((function(e){return e&&e()}),100),Xt=Object(p.a)((function(){var e=Object(r.useContext)(Ie),t=e.wordsHighlight,n=e.dynamicTextOrientation,s=Object(r.useContext)(Ue),c=s.updateBookPositionAction,o=s.openBookAction,i=s.currentBook,f=Object(r.useState)(0),p=Object(x.a)(f,2),d=p[0],b=p[1],m=Object(r.useState)("0.0"),h=Object(x.a)(m,2),j=h[0],v=h[1],g=Object(r.useState)(0),O=Object(x.a)(g,2),w=O[0],k=O[1],y=Object(r.useState)(!1),C=Object(x.a)(y,2),B=C[0],A=C[1],I=Object(r.useRef)(null),L=Object(r.useRef)([]),S=Object(r.useState)(!1),P=Object(x.a)(S,2),F=P[0],M=P[1],N=Object(T.h)(),H=parseInt(N.bookId),q=Object(r.useState)({}),E=Object(x.a)(q,2),U=E[0],W=E[1];Object(r.useEffect)((function(){var e=I.current;return function(){var t=Object(u.a)(l.a.mark((function t(){var n;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return M(!0),t.next=3,o(H);case 3:e.innerHTML=i.text,L.current=z(),k(_()),n=[],null===e||void 0===e||e.querySelectorAll("p").forEach((function(e){return n.push(e.getAttribute("data-id"))})),K(i.info.positionElement),M(!1);case 10:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()(),e.addEventListener("scroll",J),function(){return e.removeEventListener("scroll",J)}}),[]);var D=Object(zt.a)(U,5),R=Object(x.a)(D,1)[0];return Object(Rt.a)("deviceorientation",(function(e){var t=e.gamma;if(n){if(t){var a={transform:"rotateZ(".concat(-t,"deg)")};W(a)}}else W({transform:""})})),Object(a.jsxs)("div",{className:"reader",children:[Object(a.jsxs)(_e,{className:"".concat(B?"":" hidden"," "),title:function(){var e,t,n;return(null===i||void 0===i||null===(e=i.info)||void 0===e||null===(t=e.meta)||void 0===t?void 0:t.title)||(null===i||void 0===i||null===(n=i.info)||void 0===n?void 0:n.name)}(),children:[Object(a.jsxs)("div",{className:"",children:[j,"%"]}),Object(a.jsx)(Kt,{children:"".concat(d,"/").concat(w)})]}),Object(a.jsx)(Ye,{loading:F,children:Object(a.jsx)("div",{className:"list-view ".concat(t?"highlight":""),children:Object(a.jsx)("div",{className:"text-container",onClick:function(){A(!B)},style:R,ref:I})})})]});function z(){var e=[];return document.querySelectorAll("p").forEach((function(t){e.push(t)})),e.sort((function(e,t){return e.offsetTop>t.offsetTop}))}function J(e){var t=I.current,n=L.current;if(t){var a=function(){var e=I.current;return e?100*e.scrollTop/e.scrollHeight:0}();v(a.toFixed(2)),b(function(){var e=I.current;return Math.round(e.scrollTop/e.clientHeight)}()),_t((function(){!function(e){if(e){var t=e.getAttribute("data-id");c(H,t)}}((function(e,t){var n=[];if(!e)return n;for(var a=e.scrollTop+e.clientHeight,r=0;r<t.length;r++){var s=t[r];if(Dt(s,e)&&(Wt(s),n.push(s)),s.offsetTop>a)break}return n}(t,n)||[])[0])}))}}function K(e){if(e){var t=document.querySelector('[data-id="'.concat(e,'"]'));null===t||void 0===t||t.scrollIntoView()}}function _(){var e=I.current;return Math.round(e.scrollHeight/e.clientHeight)}})),$t=n(252),Gt=n(246),Vt=n(251),Yt=n(245),Zt=n(185),Qt=n(257),en=n(247),tn=n(258),nn=n(250),an=n(255),rn=n.p+"static/media/page1.7720a4ef.jpg",sn=n.p+"static/media/page2.c690ddc0.jpg",cn=n.p+"static/media/page3.ce566b3c.jpg";function on(){var e=Object(f.a)(["\n  height: 56px;\n"]);return on=function(){return e},e}function ln(){var e=Object(f.a)(["\n  margin: 10px;\n  min-width: 200px;\n"]);return ln=function(){return e},e}var un=Object(We.a)(Yt.a)(ln()),xn=We.a.img(on()),fn=Object(p.a)((function(){var e=Object(r.useContext)(Ie),t=e.locale,n=e.imageCover,s=e.wordsHighlight,c=e.isUseImageCover,o=e.pageBackgroundColor,i=e.dynamicTextOrientation,l=Object(r.useContext)(Ie),u=Object(Gt.a)(),x=function(e){var t=e.target.name,n="checkbox"===e.target.type?e.target.checked:e.target.value,a=l[t];"function"===typeof a&&a(n)};return Object(a.jsxs)(a.Fragment,{children:[Object(a.jsx)(_e,{}),Object(a.jsxs)(st.a,{container:!0,children:[Object(a.jsx)(st.a,{item:!0,xs:12,children:Object(a.jsxs)(un,{children:[Object(a.jsx)(en.a,{id:"language-select-label",children:u.formatMessage({id:"settings.language"})}),Object(a.jsxs)(an.a,{labelId:"language-select-label",value:t,name:"setLocale",onChange:x,children:[Object(a.jsx)(nn.a,{value:"ru",children:"\u0420\u0443\u0441\u0441\u043a\u0438\u0439"}),Object(a.jsx)(nn.a,{value:"en",children:"English"})]})]})}),Object(a.jsx)(st.a,{item:!0,xs:12,children:Object(a.jsxs)(un,{children:[Object(a.jsx)(Zt.a,{component:"legend",children:"\u041f\u043e\u0434\u0441\u0432\u0435\u0442\u043a\u0430 \u0441\u043b\u043e\u0432 \u0432 \u0442\u0435\u043a\u0441\u0442\u0435 \u0434\u043b\u044f \u0443\u043f\u0440\u043e\u0449\u0435\u043d\u0438\u044f \u043f\u043e\u0438\u0441\u043a\u0430 \u0441\u0442\u0440\u043e\u043a \u0433\u043b\u0430\u0437\u0430\u043c\u0438"}),Object(a.jsx)(Vt.a,{control:Object(a.jsx)(Qt.a,{checked:s,onChange:x,name:"toggleHightligting"}),label:"\u041f\u043e\u0434\u0441\u0432\u0435\u0442\u043a\u0430 \u0441\u043b\u043e\u0432"})]})}),Object(a.jsx)(st.a,{item:!0,xs:12,children:Object(a.jsxs)(un,{children:[Object(a.jsx)(Zt.a,{component:"legend",children:"\u041f\u043e\u0434\u0441\u0442\u0440\u0430\u0438\u0432\u0430\u0442\u044c \u043f\u043e\u043b\u043e\u0436\u0435\u043d\u0438\u0435 \u0442\u0435\u043a\u0441\u0442\u0430 \u0432 \u0437\u0430\u0432\u0438\u0441\u0438\u043c\u043e\u0441\u0442\u0438 \u043e\u0442 \u043e\u0440\u0438\u0435\u043d\u0442\u0430\u0446\u0438\u0438 \u0443\u0441\u0442\u0440\u043e\u0439\u0441\u0442\u0432\u0430"}),Object(a.jsx)(Vt.a,{control:Object(a.jsx)(Qt.a,{checked:i,onChange:x,name:"toggleDynamicTextOrientation"}),label:"\u0414\u0438\u043d\u0430\u043c\u0438\u0447\u0435\u0441\u043a\u0430\u044f \u043e\u0440\u0438\u0435\u043d\u0442\u0430\u0446\u0438\u044f \u0442\u0435\u043a\u0441\u0442\u0430"})]})}),Object(a.jsxs)(st.a,{item:!0,xs:12,children:[Object(a.jsxs)(un,{children:[Object(a.jsx)(Zt.a,{component:"legend",children:"\u041f\u043e\u0434\u043b\u043e\u0436\u043a\u0430 \u043a\u043d\u0438\u0433\u0438"}),Object(a.jsx)(Vt.a,{control:Object(a.jsx)(Qt.a,{checked:c,onChange:x,name:"toggleUseImageCover"}),label:c?"\u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435":"\u0441\u043f\u043b\u043e\u0448\u043d\u043e\u0439 \u0442\u0435\u043a\u0441\u0442"})]}),c&&Object(a.jsxs)(un,{children:[Object(a.jsx)(en.a,{id:"cover-image-select-label",children:u.formatMessage({id:"settings.coverImage"})}),Object(a.jsxs)(an.a,{labelId:"cover-image-select-label",value:n,name:"setImageCoverAction",onChange:x,children:[Object(a.jsx)(nn.a,{value:"1",children:Object(a.jsx)(xn,{src:rn})}),Object(a.jsx)(nn.a,{value:"2",children:Object(a.jsx)(xn,{src:sn})}),Object(a.jsx)(nn.a,{value:"3",children:Object(a.jsx)(xn,{src:cn})})]})]}),!c&&Object(a.jsx)(un,{children:Object(a.jsx)(tn.a,{id:"cover-bg-color-input-label",label:u.formatMessage({id:"settings.coverBgColor"}),type:"text",value:o,name:"setPageBackgroundColorAction",onChange:x,margin:"normal"})})]})]})]})})),pn=Object(p.a)((function(){var e=Object($t.a)(Ee),t=Object($t.a)(Xe),n=Object($t.a)(Ae),s=t.isLoggedIn,c=n.getLocaleMessages();Object(r.useEffect)((function(){e.fetchBooksListAction()}),[]);var o=function(){var e=Object(u.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!s){e.next=3;break}return e.next=3,t.fetchBooksListAction();case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(r.useEffect)((function(){o()}),[s]),Object(a.jsx)(Ie.Provider,{value:n,children:Object(a.jsx)(Ue.Provider,{value:e,children:Object(a.jsx)($e.Provider,{value:t,children:Object(a.jsx)(q.b,{locale:n.locale,defaultLocale:n.defaultLocale,messages:c,children:Object(a.jsx)(L.a,{basename:"/careful-reader",children:Object(a.jsxs)(T.c,{children:[Object(a.jsx)(T.a,{exact:!0,path:"/",children:Object(a.jsx)(qt,{})}),Object(a.jsx)(T.a,{exact:!0,path:"/read/:bookId",children:Object(a.jsx)(Xt,{})}),Object(a.jsx)(T.a,{exact:!0,path:"/settings",children:Object(a.jsx)(fn,{})})]})})})})})})})),dn=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function bn(e,t){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var n=e.installing;null!=n&&(n.onstatechange=function(){"installed"===n.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://bit.ly/CRA-PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}n(177);var mn=Object(a.jsx)(pn,{});o.a.render(mn,document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL("/careful-reader",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",(function(){var t="".concat("/careful-reader","/service-worker.js");dn?(!function(e,t){fetch(e).then((function(n){var a=n.headers.get("content-type");404===n.status||null!=a&&-1===a.indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):bn(e,t)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(t,e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://bit.ly/CRA-PWA")}))):bn(t,e)}))}}()},94:function(e){e.exports=JSON.parse('{"feed.close":"close...","feed.library":"library","feed.to-read":"to read...","settings.coverBgColor":"cover background color","settings.coverImage":"cover image","settings.language":"language"}')},95:function(e){e.exports=JSON.parse('{"feed.close":"close...","feed.library":"library","feed.to-read":"to read...","settings.coverBgColor":"cover background color","settings.coverImage":"cover image","settings.language":"language"}')}},[[178,1,2]]]);
//# sourceMappingURL=main.4ad6d96a.chunk.js.map