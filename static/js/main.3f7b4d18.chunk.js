(this["webpackJsonpcareful-reader-app"]=this["webpackJsonpcareful-reader-app"]||[]).push([[0],{29:function(e,t,n){e.exports=n(44)},38:function(e,t,n){},39:function(e,t,n){},41:function(e,t,n){},43:function(e,t,n){},44:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),c=n(14),o=n.n(c),u=n(6),i=(n(38),n(39),n(1)),s=n.n(i),l=n(2),f=n(3),d=n(10),p="library";function b(){return(b=Object(l.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Object(d.a)(p,1,{upgrade:function(e){e.createObjectStore("index",{keyPath:"id"}),e.createObjectStore("books",{autoIncrement:!0})}}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(e,t){return v.apply(this,arguments)}function v(){return(v=Object(l.a)(s.a.mark((function e(t,n){var r,a,c,o;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(d.a)(p,1);case 2:return r=e.sent,a=r.transaction(["index","books"],"readwrite"),e.next=6,a.objectStore("books").add(t);case 6:return c=e.sent,o={id:c,name:n.name,page:0},a.objectStore("index").add(o),e.next=11,a.done;case 11:return e.abrupt("return",o);case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function O(){return(O=Object(l.a)(s.a.mark((function e(t,n){var r,a;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(d.a)(p,1);case 2:return r=e.sent,a=r.transaction(["index"],"readwrite").objectStore("index"),e.abrupt("return",a.get(t).then((function(e){var t=Object(f.a)(Object(f.a)({},e),n);return a.put(t).then((function(){return t}))})));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(){return(h=Object(l.a)(s.a.mark((function e(){var t;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(d.a)(p,1);case 2:return t=e.sent,e.abrupt("return",t.getAll("index"));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function j(){return(j=Object(l.a)(s.a.mark((function e(t){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(d.a)(p,1);case 2:return n=e.sent,e.abrupt("return",n.get("books",t));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function k(e){return y.apply(this,arguments)}function y(){return(y=Object(l.a)(s.a.mark((function e(t){var n,r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new DOMParser,r=n.parseFromString(t,"text/xml"),e.abrupt("return",fetch("/reader.xsl").then((function(e){return e.text()})).then((function(e){return(new window.DOMParser).parseFromString(e,"text/xml")})).then((function(e){var t=new XSLTProcessor;return t.importStylesheet(e),t.transformToDocument(r)})));case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var E=n(28),x=Object(E.a)(Array(100).keys()).sort((function(){return Math.random()-.5}));function g(e){return e.querySelectorAll("p").forEach((function(e){e.textContent&&(e.innerHTML=function(e){var t=0;return e.split(" ").map((function(e){return'<span class="w'.concat(x[t=t>=100?0:t+1],'">').concat(e,"</span>")})).join(" ")}(e.textContent))})),e}function w(e){return function(t){(function(e){return j.apply(this,arguments)})(e).then((function(e){return t({type:"BOOK_TEXT",payload:e})}))}}function T(){return function(e){(function(){return h.apply(this,arguments)})().then((function(t){return e({type:"FETCH_BOOKS_LIST",payload:t})}))}}function S(e,t){return function(n){(function(e,t){return O.apply(this,arguments)})(e,{page:t}).then((function(e){return n({type:"UPDATE_BOOK_POSITION",payload:e})}))}}var N=n(7);n(41);var I=Object(u.b)((function(e){return{books:e.shelf.books}}),null)((function(e){var t=e.books,n=void 0===t?[]:t,r=Object(u.c)(),c=Object(N.f)();return a.a.createElement("div",{className:"book-shelf"},a.a.createElement("label",{className:"add-book-lable",htmlFor:"btn-add-book"},a.a.createElement("img",{src:"/add-book.png",alt:""}),a.a.createElement("div",{className:"add-book-text"},"add book"),a.a.createElement("input",{type:"file",name:"",id:"btn-add-book",onChange:function(e){var t;if(null===(t=e.target.files)||void 0===t?void 0:t.length){var n=e.target.files[0];(function(e){var t=new FileReader;return new Promise((function(n,r){t.onload=function(e){var t;return n((null===e||void 0===e?void 0:null===(t=e.target)||void 0===t?void 0:t.result)+"")},t.onerror=function(e){return r("error reading file")},t.readAsText(e)}))})(n).then((function(e){r(function(e,t){return function(){var n=Object(l.a)(s.a.mark((function n(r){var a,c;return s.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,k(e);case 2:return g(a=n.sent),n.next=6,m(a.body.innerHTML,t);case 6:c=n.sent,r({type:"ADD_BOOK",payload:c});case 8:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}()}(e,n))}))}},accept:".fb2"})),a.a.createElement("ul",{className:"collection"},n.map((function(e){return a.a.createElement("li",{className:"list-item",key:e.id,onClick:function(t){return n=e.id,void c.push("/read/".concat(n));var n}},a.a.createElement("div",null,e.name)," ",a.a.createElement("div",null,e.page))}))))})),_=n(21),B=(n(43),n(11)),D=function(e,t){var n=null;return function(){for(var r=arguments.length,a=new Array(r),c=0;c<r;c++)a[c]=arguments[c];null!==n&&(clearTimeout(n),n=null),n=setTimeout((function(){return e.apply(void 0,a)}),t)}}((function(e){return e&&e()}),500);function L(){var e=Object(u.c)(),t=Object(r.useState)(0),n=Object(_.a)(t,2),c=n[0],o=n[1],i=Object(r.useState)(1),s=Object(_.a)(i,2),l=s[0],f=s[1],d=Object(N.g)(),p=parseInt(d.bookId),b=Object(u.d)((function(e){return e.shelf.bookText})),m=Object(u.d)((function(e){return e.shelf.books.find((function(e){return e.id===p}))}));function v(t){var n=j(),r=Math.round((h().scrollLeft+n)/n);r!==l&&(f(r),D(e(S(p,r))))}function O(e){if(l!==e){var t=j();h().scrollLeft=e*t-t}}function h(){return document.getElementById("book-container")||document.body}function j(){var e=document.querySelector(".book"),t=h(),n=0;if(e){var r=window.getComputedStyle(e);n=parseInt(r.columnGap)/2}return t.clientWidth+n}Object(r.useEffect)((function(){e(w(p))}),[p]),Object(r.useEffect)((function(){o(function(){var e=h().scrollWidth,t=j();return Math.ceil(e/t)}()),m&&m.page!==l&&O(m.page)}),[b,m]),Object(r.useEffect)((function(){return h().addEventListener("scroll",v),function(){h().removeEventListener("scroll",v)}}));var k=function(e){return function(t){O("next"===e?l+1:l-1)}};return a.a.createElement("div",{className:"reader"},a.a.createElement("div",{className:"book-info"},a.a.createElement(B.b,{to:"/"},a.a.createElement("div",{className:"home"})),a.a.createElement("div",{className:"book-name"},null===m||void 0===m?void 0:m.name),a.a.createElement("div",{className:"pages"},l," / ",c)),a.a.createElement("div",{id:"book-container",dangerouslySetInnerHTML:{__html:b},onWheel:function(e){var t=e.deltaY>0||e.deltaX>0?1:-1;O(l+t)}}),a.a.createElement("div",{className:"prev-page",onClick:k("prev")}),a.a.createElement("div",{className:"next-page",onClick:k("next")}))}var A=function(){var e=Object(u.c)();return function(){return b.apply(this,arguments)}().then((function(){e(T())})),a.a.createElement("div",{className:"reader-app"},a.a.createElement(B.a,null,a.a.createElement(N.c,null,a.a.createElement(N.a,{path:"/read/:bookId"},a.a.createElement(L,null)),a.a.createElement(N.a,{path:"/"},a.a.createElement(I,null)))))},C=n(26),M=n(8),P=n(27),K={books:[],bookText:""};var F={shelf:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:K,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"ADD_BOOK":return Object(f.a)(Object(f.a)({},e),{},{books:e.books.concat(t.payload)});case"FETCH_BOOKS_LIST":return Object(f.a)(Object(f.a)({},e),{},{books:t.payload});case"BOOK_TEXT":return Object(f.a)(Object(f.a)({},e),{},{bookText:t.payload});case"UPDATE_BOOK_POSITION":var n=t.payload,r=e.books.map((function(e){return e.id===n.id?n:e}));return Object(f.a)(Object(f.a)({},e),{},{books:r});default:return e}},app:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return e}},H=Object(M.combineReducers)(F),W=Object(M.createStore)(H,Object(P.composeWithDevTools)(Object(M.applyMiddleware)(C.a))),X=a.a.createElement(u.a,{store:W},a.a.createElement(A,null));o.a.render(X,document.getElementById("root"))}},[[29,1,2]]]);
//# sourceMappingURL=main.3f7b4d18.chunk.js.map