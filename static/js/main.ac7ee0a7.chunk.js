(this["webpackJsonpcareful-reader-app"]=this["webpackJsonpcareful-reader-app"]||[]).push([[0],{22:function(e,t,n){e.exports=n(37)},27:function(e,t,n){},28:function(e,t,n){},30:function(e,t,n){},36:function(e,t,n){},37:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),o=n(19),c=n.n(o),i=(n(27),n(5)),u=(n(28),n(8)),l=n(1),s=n.n(l),f=n(2);n(30);function d(e){var t=e.books,n=void 0===t?[]:t,o=Object(r.useContext)(L);return a.a.createElement("div",{className:"book-shelf"},a.a.createElement("label",{className:"add-book-lable",htmlFor:"btn-add-book"},a.a.createElement("img",{src:"add-book.png",alt:""}),a.a.createElement("div",{className:"add-book-text"},"add book"),a.a.createElement("input",{type:"file",name:"",id:"btn-add-book",onChange:function(e){var t;if(null===(t=e.target.files)||void 0===t?void 0:t.length){var n=e.target.files[0];(function(e){var t=new FileReader;return new Promise((function(n,r){t.onload=function(e){var t;return n((null===e||void 0===e?void 0:null===(t=e.target)||void 0===t?void 0:t.result)+"")},t.onerror=function(e){return r("error reading file")},t.readAsText(e)}))})(n).then((function(e){o({type:"add_book",payload:{text:e,file:n}})}))}},accept:".fb2"})),a.a.createElement("ul",{className:"collection"},n.map((function(e){return a.a.createElement("li",{className:"list-item",key:e.id},a.a.createElement(u.b,{to:"/read/".concat(e.id)},e.name))}))))}n(36);var p=n(7),v=n(13);function h(e){var t=Object(v.a)(Array(100).keys()).sort((function(){return Math.random()-.5})),n=0,r=e.split(" ").map((function(e){return'<span class="w'.concat(t[n=n>=100?0:n+1],'">').concat(e,"</span>")})).join(" "),a=document.createElement("hlw");return a.innerHTML=r,a}function b(e){(function(e){for(var t,n=[],r=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,null,!1);t=r.nextNode();)n.push(t);return n})(e).forEach((function(t){if(t&&!e.className.includes("hg")){var n=h(t.textContent);t.replaceWith(n),e.className+=" hg"}}))}function m(e,t){var n=t.scrollTop,r=t.clientHeight,a=n+r,o=e.offsetTop,c=e.clientHeight,i=o+c;return o>=n&&o<a||i>n&&i<=a||c>r&&o<=n&&i>=a}function g(e){var t=e.label,n=e.name,r=e.value,o=e.onChange;return a.a.createElement("label",null,a.a.createElement("span",null,t),a.a.createElement("input",{type:"checkbox",name:n,checked:r,value:"1",onChange:o}))}var k=n(6),w=n(9),y="library";function x(){return(x=Object(f.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Object(w.a)(y,1,{upgrade:function(e){e.createObjectStore("index",{keyPath:"id"}),e.createObjectStore("books",{autoIncrement:!0})}}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function E(e,t){return j.apply(this,arguments)}function j(){return(j=Object(f.a)(s.a.mark((function e(t,n){var r,a,o,c;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(w.a)(y,1);case 2:return r=e.sent,a=r.transaction(["index","books"],"readwrite"),e.next=6,a.objectStore("books").add(t);case 6:return o=e.sent,c={id:o,name:n.name,positionElement:null},a.objectStore("index").add(c),e.next=11,a.done;case 11:return e.abrupt("return",c);case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function O(){return(O=Object(f.a)(s.a.mark((function e(t,n){var r,a;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(w.a)(y,1);case 2:return r=e.sent,a=r.transaction(["index"],"readwrite").objectStore("index"),e.abrupt("return",a.get(t).then((function(e){var t=Object(k.a)(Object(k.a)({},e),n);return a.put(t).then((function(){return t}))})));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function T(){return(T=Object(f.a)(s.a.mark((function e(){var t;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(w.a)(y,1);case 2:return t=e.sent,e.abrupt("return",t.getAll("index"));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function _(){return(_=Object(f.a)(s.a.mark((function e(t){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(w.a)(y,1);case 2:return n=e.sent,e.abrupt("return",n.get("books",t));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var N=function(e,t){var n=null;return function(){for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];null!==n&&(clearTimeout(n),n=null),n=setTimeout((function(){return e.apply(void 0,a)}),t)}}((function(e){return e&&e()}),100);function S(){var e=Object(r.useContext)(L),t=Object(r.useContext)(I),n=Object(r.useState)(0),o=Object(i.a)(n,2),c=o[0],l=o[1],s=Object(r.useState)("0.0"),f=Object(i.a)(s,2),d=f[0],v=f[1],h=Object(r.useState)(0),k=Object(i.a)(h,2),w=k[0],y=k[1],x=Object(r.useState)(!0),E=Object(i.a)(x,2),j=E[0],O=E[1],T=Object(r.useRef)(null),S=[],C=Object(p.f)(),H=parseInt(C.bookId);function A(t){var n=T.current;if(n){var r=function(){var e=T.current;return e?100*e.scrollTop/e.scrollHeight:0}();v(r.toFixed(2)),l(function(){var e=T.current;return Math.round(e.scrollTop/e.clientHeight)}()),N((function(){!function(t){if(t){var n=t.getAttribute("data-id");e({type:"update_book_position",payload:{bookId:H,positionElement:n}})}}((function(e,t){var n=[];if(!e)return n;for(var r=e.scrollTop+e.clientHeight,a=0;a<t.length;a++){var o=t[a];if(m(o,e)&&(b(o),n.push(o)),o.offsetTop>r)break}return n}(n,S)||[])[0])}))}}Object(r.useEffect)((function(){var e=T.current;return function(e){return _.apply(this,arguments)}(H).then((function(n){e.innerHTML=n,function(){var e=t.find((function(e){return e.id==H}));if(e){var n=document.querySelector('[data-id="'.concat(e.positionElement,'"]'));null===n||void 0===n||n.scrollIntoView()}}(),e.addEventListener("scroll",A),y(function(){var e=T.current;return Math.round(e.scrollHeight/e.clientHeight)}()),S=function(){var e=[];return document.querySelectorAll("p").forEach((function(t){e.push(t)})),e.sort((function(e,t){return e.offsetTop>t.offsetTop}))}()})),function(){return e.removeEventListener("scroll",A)}}),[]);var W=function(e){return function(){var t=T.current;if(t){var n="next"===e?1:-1;t.scrollTop+=n*t.clientHeight}}};return a.a.createElement("div",{className:"reader list-view ".concat(j?"highlight":"")},a.a.createElement("div",{className:"text-info"},a.a.createElement(u.b,{className:"home",to:"/"}),a.a.createElement("div",null,a.a.createElement(g,{label:"highlight",value:j,onChange:function(){return O(!j)}})),a.a.createElement("div",{className:""},d,"%"),a.a.createElement("div",{className:"pages"},c," / ",w)),a.a.createElement("div",{className:"text-container",ref:T}),a.a.createElement("div",{className:"prev-page",onClick:W("prev")}),a.a.createElement("div",{className:"next-page",onClick:W("next")}))}function C(e){return H.apply(this,arguments)}function H(){return(H=Object(f.a)(s.a.mark((function e(t){var n,r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new DOMParser,r=n.parseFromString(t,"text/xml"),e.abrupt("return",fetch("reader.xsl").then((function(e){return e.text()})).then((function(e){return(new window.DOMParser).parseFromString(e,"text/xml")})).then((function(e){var t=new XSLTProcessor;return t.importStylesheet(e),t.transformToDocument(r)})));case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var A=[];function W(){var e=Object(r.useCallback)((function(e,t){return function(e,t){switch(t.type){case"set_books_list":return t.payload;case"add_book_to_list":return[].concat(Object(v.a)(e),[t.payload]);case"fetch_books_list":return function(){return T.apply(this,arguments)}().then((function(e){return c({type:"set_books_list",payload:e})})),e;case"add_book":var n=t.payload,r=n.text,a=n.file;return function(e,t){return P.apply(this,arguments)}(r,a).then((function(e){return c({type:"add_book_to_list",payload:e})})),e;case"update_book_position":var o=t.payload,i=o.bookId,u=o.positionElement;return function(e,t){O.apply(this,arguments)}(i,{positionElement:u}),e.map((function(e){return e.id===i?Object(k.a)(Object(k.a)({},e),{positionElement:u}):e}))}return e}(e,t)}),[]),t=a.a.useReducer(e,A),n=Object(i.a)(t,2),o=n[0],c=n[1];return[o,c]}function P(){return(P=Object(f.a)(s.a.mark((function e(t,n){var r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,C(t);case 2:return r=e.sent,e.next=5,E(r.body.innerHTML,n);case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var I=a.a.createContext([]),L=a.a.createContext((function(e){}));var M=function(){var e=W(),t=Object(i.a)(e,2),n=t[0],o=t[1];return Object(r.useEffect)((function(){o({type:"fetch_books_list"})}),[]),a.a.createElement(I.Provider,{value:n},a.a.createElement(L.Provider,{value:o},a.a.createElement(u.a,null,a.a.createElement(p.c,null,a.a.createElement(p.a,{path:"/read/:bookId"},a.a.createElement(S,null)),a.a.createElement(p.a,{path:"/"},a.a.createElement(d,{books:n}))))))},F=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function R(e,t){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var n=e.installing;null!=n&&(n.onstatechange=function(){"installed"===n.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://bit.ly/CRA-PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}!function(){x.apply(this,arguments)}();var D=a.a.createElement(M,null);c.a.render(D,document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL("/careful-reader",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",(function(){var t="".concat("/careful-reader","/service-worker.js");F?(!function(e,t){fetch(e).then((function(n){var r=n.headers.get("content-type");404===n.status||null!=r&&-1===r.indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):R(e,t)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(t,e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://bit.ly/CRA-PWA")}))):R(t,e)}))}}()}},[[22,1,2]]]);
//# sourceMappingURL=main.ac7ee0a7.chunk.js.map