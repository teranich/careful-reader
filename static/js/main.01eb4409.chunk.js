(this["webpackJsonpcareful-reader-app"]=this["webpackJsonpcareful-reader-app"]||[]).push([[0],{22:function(e,t,n){e.exports=n(40)},27:function(e,t,n){},28:function(e,t,n){},30:function(e,t,n){},39:function(e,t,n){},40:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),o=n(18),c=n.n(o),i=(n(27),n(5)),u=(n(28),n(21)),s=n(8),l=n(1),f=n.n(l),d=n(2);n(30);function p(e){var t=e.books,n=void 0===t?[]:t,o=Object(r.useContext)(R);return a.a.createElement("div",{className:"book-shelf"},a.a.createElement("div",{className:"collection"},n.map((function(e){return a.a.createElement(v,{book:e,key:e.id})}))),a.a.createElement("label",{className:"add-book-lable",htmlFor:"btn-add-book"},a.a.createElement("img",{src:"add-book.png",alt:""}),a.a.createElement("input",{type:"file",name:"",id:"btn-add-book",onChange:function(e){var t;if(null===(t=e.target.files)||void 0===t?void 0:t.length){var n=e.target.files[0];(function(e){var t=new FileReader;return new Promise((function(n,r){t.onload=function(e){var t;return n((null===e||void 0===e?void 0:null===(t=e.target)||void 0===t?void 0:t.result)+"")},t.onerror=function(e){return r("error reading file")},t.readAsText(e)}))})(n).then((function(e){o({type:"add_book",payload:{text:e,file:n}})}))}},accept:".fb2"})))}var v=function(e){var t=e.book,n=Object(u.a)(e,["book"]);return a.a.createElement(s.b,Object.assign({to:"/read/".concat(t.id),className:"book-item"},n),a.a.createElement("div",{className:"name"},t.name))},b=(n(39),n(7)),h=n(13);function m(e){var t=Object(h.a)(Array(100).keys()).sort((function(){return Math.random()-.5})),n=0,r=e.split(" ").map((function(e){return'<span class="w'.concat(t[n=n>=100?0:n+1],'">').concat(e,"</span>")})).join(" "),a=document.createElement("hlw");return a.innerHTML=r,a}function g(e){(function(e){for(var t,n=[],r=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,null,!1);t=r.nextNode();)n.push(t);return n})(e).forEach((function(t){if(t&&!e.className.includes("hg")){var n=m(t.textContent);t.replaceWith(n),e.className+=" hg"}}))}function k(e,t){var n=t.scrollTop,r=t.clientHeight,a=n+r,o=e.offsetTop,c=e.clientHeight,i=o+c;return o>=n&&o<a||i>n&&i<=a||c>r&&o<=n&&i>=a}function w(e){var t=e.label,n=e.name,r=e.value,o=e.onChange;return a.a.createElement("label",null,a.a.createElement("span",null,t),a.a.createElement("input",{type:"checkbox",name:n,checked:r,value:"1",onChange:o}))}var y=n(6),j=n(9),E="library";function x(){return(x=Object(d.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Object(j.a)(E,1,{upgrade:function(e){e.createObjectStore("index",{keyPath:"id"}),e.createObjectStore("books",{autoIncrement:!0})}}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function O(e,t){return T.apply(this,arguments)}function T(){return(T=Object(d.a)(f.a.mark((function e(t,n){var r,a,o,c;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(j.a)(E,1);case 2:return r=e.sent,a=r.transaction(["index","books"],"readwrite"),e.next=6,a.objectStore("books").add(t);case 6:return o=e.sent,c={id:o,name:n.name,positionElement:null},a.objectStore("index").add(c),e.next=11,a.done;case 11:return e.abrupt("return",c);case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function _(){return(_=Object(d.a)(f.a.mark((function e(t,n){var r,a;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(j.a)(E,1);case 2:return r=e.sent,a=r.transaction(["index"],"readwrite").objectStore("index"),e.abrupt("return",a.get(t).then((function(e){var t=Object(y.a)(Object(y.a)({},e),n);return a.put(t).then((function(){return t}))})));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function N(){return(N=Object(d.a)(f.a.mark((function e(){var t;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(j.a)(E,1);case 2:return t=e.sent,e.abrupt("return",t.getAll("index"));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function S(){return(S=Object(d.a)(f.a.mark((function e(t){var n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(j.a)(E,1);case 2:return n=e.sent,e.abrupt("return",n.get("books",t));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var C=function(e,t){var n=null;return function(){for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];null!==n&&(clearTimeout(n),n=null),n=setTimeout((function(){return e.apply(void 0,a)}),t)}}((function(e){return e&&e()}),100);function H(){var e=Object(r.useContext)(R),t=Object(r.useContext)(M),n=Object(r.useState)(0),o=Object(i.a)(n,2),c=o[0],u=o[1],l=Object(r.useState)("0.0"),f=Object(i.a)(l,2),d=f[0],p=f[1],v=Object(r.useState)(0),h=Object(i.a)(v,2),m=h[0],y=h[1],j=Object(r.useState)(!0),E=Object(i.a)(j,2),x=E[0],O=E[1],T=Object(r.useRef)(null),_=Object(r.useRef)([]),N=Object(b.f)(),H=parseInt(N.bookId);function A(t){var n=T.current,r=_.current;if(n){var a=function(){var e=T.current;return e?100*e.scrollTop/e.scrollHeight:0}();p(a.toFixed(2)),u(function(){var e=T.current;return Math.round(e.scrollTop/e.clientHeight)}()),C((function(){!function(t){if(t){var n=t.getAttribute("data-id");e({type:"update_book_position",payload:{bookId:H,positionElement:n}})}}((function(e,t){var n=[];if(!e)return n;for(var r=e.scrollTop+e.clientHeight,a=0;a<t.length;a++){var o=t[a];if(k(o,e)&&(g(o),n.push(o)),o.offsetTop>r)break}return n}(n,r)||[])[0])}))}}var W=function(e){return function(){var t=T.current;if(t){var n="next"===e?1:-1;t.scrollTop+=n*t.clientHeight}}};return Object(r.useEffect)((function(){var e=T.current;return function(e){return S.apply(this,arguments)}(H).then((function(n){e.innerHTML=n,y(function(){var e=T.current;return Math.round(e.scrollHeight/e.clientHeight)}()),function(){var e=t.find((function(e){return e.id===H}));if(e){var n=document.querySelector('[data-id="'.concat(e.positionElement,'"]'));null===n||void 0===n||n.scrollIntoView()}}(),_.current=function(){var e=[];return document.querySelectorAll("p").forEach((function(t){e.push(t)})),e.sort((function(e,t){return e.offsetTop>t.offsetTop}))}(),e.addEventListener("scroll",A)})),function(){return e.removeEventListener("scroll",A)}}),[]),a.a.createElement("div",{className:"reader list-view ".concat(x?"highlight":"")},a.a.createElement("div",{className:"text-info"},a.a.createElement(s.b,{className:"home",to:"/"}),a.a.createElement("div",null,a.a.createElement(w,{label:"highlight",value:x,onChange:function(){return O(!x)}})),a.a.createElement("div",{className:""},d,"%"),a.a.createElement("div",{className:"pages"},c," / ",m)),a.a.createElement("div",{className:"text-container",ref:T}),a.a.createElement("div",{className:"prev-page",onClick:W("prev")}),a.a.createElement("div",{className:"next-page",onClick:W("next")}))}function A(e){return W.apply(this,arguments)}function W(){return(W=Object(d.a)(f.a.mark((function e(t){var n,r;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new DOMParser,r=n.parseFromString(t,"text/xml"),e.abrupt("return",fetch("reader.xsl").then((function(e){return e.text()})).then((function(e){return(new window.DOMParser).parseFromString(e,"text/xml")})).then((function(e){var t=new XSLTProcessor;return t.importStylesheet(e),t.transformToDocument(r)})));case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var P=[];function I(){var e=Object(r.useCallback)((function(e,t){return function(e,t){switch(t.type){case"set_books_list":return t.payload;case"add_book_to_list":return[].concat(Object(h.a)(e),[t.payload]);case"fetch_books_list":return function(){return N.apply(this,arguments)}().then((function(e){return c({type:"set_books_list",payload:e})})),e;case"add_book":var n=t.payload,r=n.text,a=n.file;return function(e,t){return L.apply(this,arguments)}(r,a).then((function(e){return c({type:"add_book_to_list",payload:e})})),e;case"update_book_position":var o=t.payload,i=o.bookId,u=o.positionElement;return function(e,t){_.apply(this,arguments)}(i,{positionElement:u}),e.map((function(e){return e.id===i?Object(y.a)(Object(y.a)({},e),{positionElement:u}):e}))}return e}(e,t)}),[]),t=a.a.useReducer(e,P),n=Object(i.a)(t,2),o=n[0],c=n[1];return[o,c]}function L(){return(L=Object(d.a)(f.a.mark((function e(t,n){var r;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,A(t);case 2:return r=e.sent,e.next=5,O(r.body.innerHTML,n);case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var M=a.a.createContext([]),R=a.a.createContext((function(e){}));var F=function(){var e=I(),t=Object(i.a)(e,2),n=t[0],o=t[1];return Object(r.useEffect)((function(){o({type:"fetch_books_list"})}),[o]),a.a.createElement(M.Provider,{value:n},a.a.createElement(R.Provider,{value:o},a.a.createElement(s.a,null,a.a.createElement(b.c,null,a.a.createElement(b.a,{path:"/read/:bookId"},a.a.createElement(H,null)),a.a.createElement(b.a,{path:"/"},a.a.createElement(p,{books:n}))))))},D=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function U(e,t){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var n=e.installing;null!=n&&(n.onstatechange=function(){"installed"===n.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://bit.ly/CRA-PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}!function(){x.apply(this,arguments)}();var q=a.a.createElement(F,null);c.a.render(q,document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL("/careful-reader",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",(function(){var t="".concat("/careful-reader","/service-worker.js");D?(!function(e,t){fetch(e).then((function(n){var r=n.headers.get("content-type");404===n.status||null!=r&&-1===r.indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):U(e,t)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(t,e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://bit.ly/CRA-PWA")}))):U(t,e)}))}}()}},[[22,1,2]]]);
//# sourceMappingURL=main.01eb4409.chunk.js.map