{"version":3,"sources":["components/shelves/add-book.png","components/reader/home.svg","components/feed/book-shelf.png","components/common/Checkbox.tsx","uitls/googleAPI.ts","store/RemoteLibraryStore.ts","components/common/Header.tsx","components/common/Loading.tsx","uitls/clientDB.ts","uitls/converter.ts","uitls/xsl.js","store/LibraryStore.ts","components/shelves/RemoteShelve.tsx","uitls/common.ts","components/shelves/common.tsx","components/common/BookItem.tsx","components/shelves/LocalShelve.tsx","components/shelves/index.ts","components/shelves/Shelves.tsx","uitls/styler.ts","components/reader/Reader.tsx","components/reader/index.ts","components/feed/Feed.tsx","components/details/Details.tsx","App.tsx","serviceWorker.ts","index.tsx"],"names":["module","exports","Checkbox","label","name","value","onChange","type","checked","GAPI","googleDriveAPIDocument","scope","isGAPILoaded","this","loadGoogleAPI","Promise","resolve","reject","window","gapi","client","drive","init","apiKey","process","clientId","discoveryDocs","then","catch","auth2","getAuthInstance","signIn","e","processError","signOut","isSignedIn","get","query","ret","callGapi","files","list","spaces","fields","pageSize","pageToken","token","orderBy","q","resp","concat","result","nextPageToken","fileId","content","request","path","method","params","uploadType","body","JSON","stringify","alt","folderId","create","resource","mimeType","parents","delete","status","load","gapiFn","options","console","log","err","error","RemoteLibraryStore","fetchBooksListAction","action","a","store","isBooksLoading","books","signInAction","isLoggedIn","signOutAction","uploadBookAction","book","bookText","length","all","createFile","metaFile","textFile","metaFileId","id","textFileId","upload","newBook","push","syncMetaAction","downloadBookAction","download","meta","text","deleteBookAction","deleteFile","isSuccess","filter","inner","observable","isClientLoaded","React","createContext","observer","children","useContext","RemoteLibraryStoreContext","className","onClick","Loading","dbPromise","openDB","upgrade","db","oldVersion","createObjectStore","keyPath","autoIncrement","txPromise","transaction","libraryDB","getBookMeta","getAllMeta","getAll","getBookText","addBook","timestamp","Date","now","tx","objectStore","add","done","setBookMeta","bookId","oldBook","put","clear","convertFB2ToHtml","el","DOMParser","parseFromString","xsl","xsltProcessor","XSLTProcessor","importStylesheet","html","transformToDocument","cover","querySelector","getAttribute","documentBody","innerHTML","LibraryStore","addBookAction","rawBookText","file","syncBookAction","bookIndex","indexOf","splice","updateBookPositionAction","positionElement","updateBookAction","bookProps","bookInStore","find","Object","assign","openBookAction","currentBook","prom","fetchBookTextAction","remoteBooks","RemoteBooksList","LibraryStoreContext","localBooks","removeBtnHandler","localBook","collectBtnHandler","remoteBook","map","index","key","AddBookButton","rest","htmlFor","src","AddBookIcon","event","target","reader","FileReader","onload","onerror","readAsText","readFileContent","accept","BooksListPlaceholder","BookItem","to","LocalBooksList","Shelves","getStyledElement","indexes","Array","keys","sort","Math","random","split","word","join","wrapper","document","createElement","stylize","element","includes","n","walk","createTreeWalker","NodeFilter","SHOW_TEXT","nextNode","textNodesUnder","forEach","textElement","styledTextElement","textContent","replaceWith","isOnScreen","screenContainerElement","viewportTop","scrollTop","viewportHeight","clientHeight","viewportBottom","top","offsetTop","height","bottom","dfunc","func","waitFor","timeout","args","clearTimeout","setTimeout","debounce","fn","Reader","useState","numberOfcurrentPage","setNumberOfCurrentPage","currenPositionPercent","setCurrenPositionPercent","pagesCount","setPagesCount","wordsHighlight","setWordsHighlight","showControls","setShowControls","textContainerRef","useRef","elementsForHightlightRef","queryParams","useParams","parseInt","useEffect","current","getElementsForHightlight","getPagesCount","restoreScrollPoition","openBook","addEventListener","handleScroll","removeEventListener","HomeIcon","ref","querySelectorAll","b","elementsForHightlight","percent","scrollHeight","getPercentOfScroll","toFixed","round","getNumberOfCurrentPage","posElement","updateBookPosition","screenElement","allElements","onScreen","i","hightLightElementsOnScreen","toElement","scrollIntoView","BookShelfImage","setBook","uploadHandler","deleteBookHandler","syncHandler","App","useLocalStore","remoteStore","fetchBooks","Provider","basename","exact","isLocalhost","Boolean","location","hostname","match","registerValidSW","swUrl","config","navigator","serviceWorker","register","registration","onupdatefound","installingWorker","installing","onstatechange","state","controller","onUpdate","onSuccess","app","ReactDOM","render","getElementById","URL","href","origin","fetch","response","contentType","headers","ready","unregister","reload","checkValidServiceWorker"],"mappings":"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","file":"static/js/main.080dacad.chunk.js","sourcesContent":["module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIACAMAAADDpiTIAAAAA3NCSVQICAjb4U/gAAAACXBIWXMAAN11AADddQGsh8ODAAAAGXRFWHRTb2Z0d2FyZQB3d3cuaW5rc2NhcGUub3Jnm+48GgAAAvpQTFRF////AQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACAQACBJYviwAAAP10Uk5TAAECAwQFBgcICQoL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\"","module.exports = __webpack_public_path__ + \"static/media/home.3e06a93b.svg\";","module.exports = __webpack_public_path__ + \"static/media/book-shelf.60dcdcf8.png\";","import React from 'react'\n\ninterface CheckboxProps {\n  label?: string\n  name?: string\n  value?: boolean\n  onChange?: (event: React.ChangeEvent<HTMLInputElement>) => void\n}\n\nexport default function Checkbox({\n  label,\n  name,\n  value,\n  onChange,\n}: CheckboxProps) {\n  return (\n    <label>\n      <span>{label}</span>\n      <input\n        type=\"checkbox\"\n        name={name}\n        checked={value}\n        value=\"1\"\n        onChange={onChange}\n      />\n    </label>\n  )\n}\n","interface Files {\n  id: string\n}\nexport default class GAPI {\n  private googleDriveAPIDocument =\n    'https://www.googleapis.com/discovery/v1/apis/drive/v3/rest'\n  private scope = 'https://www.googleapis.com/auth/drive.appfolder'\n  private isGAPILoaded = false\n  constructor() {\n    if (\n      !process.env.REACT_APP_GOOGLE_API_KEY ||\n      !process.env.REACT_APP_GOOGLE_CLIENT_ID\n    ) {\n      console.error('Missing google API keys in .env file', process.env)\n    }\n  }\n  public async load() {\n    await this.loadGoogleAPI()\n    this.isGAPILoaded = true\n    return new Promise((resolve, reject) => {\n      if (window.gapi.client.drive) return resolve()\n      return window.gapi.client\n        .init({\n          apiKey: process.env.REACT_APP_GOOGLE_API_KEY,\n          clientId: process.env.REACT_APP_GOOGLE_CLIENT_ID,\n          discoveryDocs: [this.googleDriveAPIDocument],\n          scope: this.scope,\n        })\n        .then(resolve)\n        .catch(reject)\n    })\n  }\n  public signIn() {\n    try {\n      return window.gapi.auth2.getAuthInstance().signIn()\n    } catch (e) {\n      return this.processError(e)\n    }\n  }\n  public signOut() {\n    try {\n      return window.gapi.auth2.getAuthInstance().signOut()\n    } catch (e) {\n      return this.processError(e)\n    }\n  }\n  public isLoggedIn() {\n    return (\n      this.isGAPILoaded &&\n      window.gapi.auth2.getAuthInstance() &&\n      window.gapi.auth2.getAuthInstance().isSignedIn.get()\n    )\n  }\n  public async list(query: string = '') {\n    let ret: any = []\n    try {\n      let token\n      do {\n        const resp: any = await this.callGapi(\n          window.gapi.client.drive.files.list,\n          {\n            spaces: 'appDataFolder',\n            fields: '*',\n            pageSize: 100,\n            pageToken: token,\n            orderBy: 'createdTime',\n            q: query,\n          }\n        )\n        ret = ret.concat(resp.result.files)\n        token = resp.result.nextPageToken\n      } while (token)\n\n      return ret\n    } catch (e) {\n      this.processError(e)\n      return ret\n    }\n  }\n  public async listFolders() {\n    return await this.list(`mimeType = 'application/vnd.google-apps.folder'`)\n  }\n  public async upload(fileId: string, content: string) {\n    try {\n      return this.callGapi(gapi.client.request, {\n        path: `/upload/drive/v3/files/${fileId}`,\n        method: 'PATCH',\n        params: { uploadType: 'media' },\n        body: typeof content === 'string' ? content : JSON.stringify(content),\n      })\n    } catch (e) {\n      this.processError(e)\n    }\n  }\n  public async download(fileId: string) {\n    const resp = await this.callGapi(gapi.client.drive.files.get, {\n      fileId: fileId,\n      alt: 'media',\n    })\n    return resp.result || resp.body\n  }\n  public async createFile(name: string, folderId?: string) {\n    const resp = await this.callGapi(gapi.client.drive.files.create, {\n      resource: {\n        name: name,\n        mimeType: 'text/plain',\n        parents: [folderId || 'appDataFolder'],\n      },\n      fields: 'id',\n    })\n    return resp.result\n  }\n  public async createFolder(name: string) {\n    const resp = await this.callGapi(gapi.client.drive.files.create, {\n      resource: {\n        name: name,\n        mimeType: 'application/vnd.google-apps.folder',\n        parents: ['appDataFolder'],\n      },\n      fields: 'id',\n    })\n    return resp.result\n  }\n  public async deleteFile(fileId: string) {\n    try {\n      await this.callGapi(gapi.client.drive.files.delete, {\n        fileId: fileId,\n      })\n      return true\n    } catch (err) {\n      if (err.status === 404) {\n        return false\n      }\n      throw err\n    }\n  }\n  private loadGoogleAPI() {\n    return new Promise((resolve, reject) => {\n      if (!window.gapi) return reject('google api is not loaded')\n      if (window.gapi.auth2) resolve(window.gapi.auth2)\n      window.gapi.load('auth2', () => resolve(window.gapi.auth2))\n    })\n  }\n\n  private callGapi<CallGAPI>(\n    gapiFn: any,\n    options: any\n  ): Promise<gapi.client.Response<Files>> {\n    return new Promise((resolve, reject) => {\n      return gapiFn(options).then(\n        (resp: any) => {\n          if (resp && (resp.status < 200 || resp.status > 299)) {\n            console.log('GAPI call returned bad status', resp)\n            reject(resp)\n          } else {\n            resolve(resp)\n          }\n        },\n        (err: any) => {\n          // this.processError(err)\n          return reject(err)\n        }\n      )\n    })\n  }\n  private processError(error: Error) {\n    console.error(error)\n  }\n}\n","import React from 'react'\nimport GAPI from '../uitls/googleAPI'\nimport { observable, action } from 'mobx'\nimport { Book, RemoteBook } from '../types'\n\nexport const RemoteLibraryStore = () => {\n  const gapi = new GAPI()\n\n  const fetchBooksListAction = action(async () => {\n    store.isBooksLoading = true\n    store.books = await gapi.list(`fileExtension=\"json\"`)\n    store.isBooksLoading = false\n    console.log('cloud books', store.books)\n  })\n\n  const signInAction = action(async () => {\n    await gapi.signIn()\n    store.isLoggedIn = gapi.isLoggedIn()\n  })\n\n  const signOutAction = action(async () => {\n    await gapi.signOut()\n    store.isLoggedIn = gapi.isLoggedIn()\n    store.books = []\n  })\n\n  const uploadBookAction = action(async (book: Book, bookText: string) => {\n    const list = await gapi.list(`name=\"${book.name}-text.html\"`)\n    if (list.length) return\n\n    const [metaFile, textFile] = await Promise.all([\n      gapi.createFile(`${book.name}-meta.json`),\n      gapi.createFile(`${book.name}-text.html`),\n    ])\n\n    book.metaFileId = metaFile.id\n    book.textFileId = textFile.id\n    await Promise.all([\n      gapi.upload(metaFile.id, JSON.stringify(book)),\n      gapi.upload(textFile.id, bookText),\n    ])\n\n    const newBook: RemoteBook = {\n      id: metaFile.id,\n      metaFileId: metaFile.id,\n      textFileId: textFile.id,\n      name: `${book.name}-meta.json`,\n    }\n    store.books.push(newBook)\n  })\n\n  const syncMetaAction = action(async (book: Book) => {\n    if (book.metaFileId) {\n      await gapi.upload(book.metaFileId, JSON.stringify(book))\n    }\n  })\n\n  const downloadBookAction = action(async (book: RemoteBook) => {\n    const meta: any = await gapi.download(book.id)\n    let text: any = ''\n    if (meta.textFileId) text = await gapi.download(meta.textFileId)\n    return { meta, text }\n  })\n\n  const deleteBookAction = action(async (book: any) => {\n    const isSuccess = await gapi.deleteFile(book.id)\n    if (isSuccess) {\n      store.books = store.books.filter((inner) => inner.id !== book.id)\n    }\n    return isSuccess\n  })\n\n  const store = observable({\n    books: [] as RemoteBook[],\n    isClientLoaded: false,\n    isLoggedIn: false,\n    isBooksLoading: false,\n    signInAction,\n    signOutAction,\n    uploadBookAction,\n    syncMetaAction,\n    downloadBookAction,\n    deleteBookAction,\n    fetchBooksListAction,\n  })\n\n  gapi\n    .load()\n    .then(() => {\n      store.isClientLoaded = true\n      store.isLoggedIn = gapi.isLoggedIn()\n    })\n    .catch((err) => {\n      console.error('error is', err)\n    })\n  return store\n}\nexport default React.createContext<any>({})\n","import React, { useContext } from 'react'\nimport './Header.scss'\nimport RemoteLibraryStoreContext from '../../store/RemoteLibraryStore'\nimport { observer } from 'mobx-react'\n\nexport default observer(function Header({ children }: any) {\n  const {\n    isClientLoaded,\n    isLoggedIn,\n    signInAction,\n    signOutAction,\n  } = useContext(RemoteLibraryStoreContext)\n  return (\n    <header className=\"header\">\n      {children}\n      <div className={isClientLoaded ? '' : 'hidden'}>\n        {isLoggedIn ? (\n          <button onClick={signOutAction}>Log Out</button>\n        ) : (\n            <button onClick={signInAction}>Log In</button>\n          )}\n      </div>\n    </header>\n  )\n})\n","import React from 'react'\n\nexport default function Loading() {\n  return <div>Loading</div>\n}\n","import { openDB, DBSchema } from 'idb'\nimport { Book } from '../types'\n\nconst DB_VERSION = 1\nconst DB_NAME = 'library'\nconst DB_INDEX_NAME = 'index'\nconst DB_STORE_NAME = 'books'\n\ninterface LibraryDB extends DBSchema {\n  [DB_INDEX_NAME]: {\n    key: number\n    value: Book\n  }\n  [DB_STORE_NAME]: {\n    key: number\n    value: string\n  }\n}\n\nconst dbPromise = openDB<LibraryDB>(DB_NAME, DB_VERSION, {\n  upgrade(db, oldVersion) {\n    if (oldVersion < 1) {\n      db.createObjectStore(DB_INDEX_NAME, { keyPath: 'id' })\n      db.createObjectStore(DB_STORE_NAME, { autoIncrement: true })\n    }\n  },\n})\n\nconst txPromise = async () =>\n  (await dbPromise).transaction([DB_INDEX_NAME, DB_STORE_NAME], 'readwrite')\n\nconst libraryDB = {\n  async getBookMeta(id: number) {\n    return (await dbPromise).get(DB_INDEX_NAME, id)\n  },\n  async getAllMeta() {\n    return (await dbPromise).getAll(DB_INDEX_NAME)\n  },\n  async getBookText(id: number) {\n    return (await dbPromise).get(DB_STORE_NAME, id)\n  },\n  async addBook(meta: any, body: string = ''): Promise<Book> {\n    const timestamp = Date.now()\n    const tx = await txPromise()\n    const id = await tx.objectStore(DB_STORE_NAME).add(body)\n    const book: Book = { ...meta, id, timestamp }\n    await tx.objectStore(DB_INDEX_NAME).add(book)\n    await tx.done\n    return book\n  },\n  async setBookMeta(bookId: number, newBook: any) {\n    const tx = await txPromise()\n    const store = tx.objectStore(DB_INDEX_NAME)\n    const oldBook = await store.get(bookId)\n    await store.put({ ...oldBook, ...newBook })\n    await tx.done\n  },\n  async delete(bookId: number) {\n    const tx = await txPromise()\n    await tx.objectStore(DB_INDEX_NAME).delete(bookId)\n    await tx.objectStore(DB_STORE_NAME).delete(bookId)\n    await tx.done\n  },\n  async clear() {\n    const tx = await txPromise()\n    await tx.objectStore(DB_INDEX_NAME).clear()\n    await tx.objectStore(DB_STORE_NAME).clear()\n    await tx.done\n  },\n}\n\nexport default libraryDB\n","import { FB2XSL } from './xsl'\n\nexport function convertFB2ToHtml(bookText: string) {\n  const parser = new DOMParser()\n  const el = parser.parseFromString(bookText, 'text/xml')\n  const xsl = new window.DOMParser().parseFromString(FB2XSL, 'text/xml')\n  const xsltProcessor = new XSLTProcessor()\n  xsltProcessor.importStylesheet(xsl)\n  const html = xsltProcessor.transformToDocument(el)\n  const cover = html.querySelector('.text-cover img')?.getAttribute('src') || ''\n  return {\n    documentBody: html.body.innerHTML,\n    cover,\n  }\n}\n","const FB2XSL = `<?xml version=\"1.0\"?>\n<xsl:stylesheet\n        version=\"1.0\"\n        xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\"\n        xmlns:xlink=\"http://www.w3.org/1999/xlink\"\n        xmlns:fb=\"http://www.gribuser.ru/xml/fictionbook/2.0\"\n        >\n    <xsl:output\n            media-type=\"text/html\"\n            method=\"html\"\n            encoding=\"utf-8\"\n            omit-xml-declaration=\"yes\"\n            doctype-public=\"HTML5\"\n            />\n\n    <xsl:key name=\"note-link\" match=\"fb:section\" use=\"@id\"/>\n    <xsl:template match=\"/*\">\n        <div class=\"text\">\n            <xsl:for-each select=\"fb:description/fb:title-info/fb:coverpage/fb:image\">\n                <xsl:call-template name=\"image\"/>\n            </xsl:for-each>\n\n            <xsl:for-each select=\"fb:description/fb:title-info/fb:annotation\">\n                <section class=\"text-annotation\">\n                    <xsl:call-template name=\"annotation\"/>\n                </section>\n            </xsl:for-each>\n\n            <!--<navMap style=\"display: none;\">-->\n                <!--<xsl:apply-templates select=\"fb:body\" mode=\"toc\"/>-->\n            <!--</navMap>-->\n\n\n            <xsl:for-each select=\"fb:body\">\n                <xsl:if test=\"position() != 1\">\n                    <div class=\"separator\"></div>\n                </xsl:if>\n\n                <!--<xsl:if test=\"not(fb:title) and @name\">-->\n                    <!--<h4 align=\"center\">-->\n                        <!--<xsl:value-of select=\"@name\"/>-->\n                    <!--</h4>-->\n                <!--</xsl:if>-->\n\n                <div class=\"text-wrapper\">\n                    <xsl:apply-templates/>\n                </div>\n\n            </xsl:for-each>\n        </div>\n    </xsl:template>\n    <!-- author template -->\n    <xsl:template name=\"author\">\n        <xsl:value-of select=\"fb:first-name\"/>\n        <xsl:text disable-output-escaping=\"no\">&#032;</xsl:text>\n        <xsl:value-of select=\"fb:middle-name\"/>&#032;\n        <xsl:text disable-output-escaping=\"no\">&#032;</xsl:text>\n        <xsl:value-of select=\"fb:last-name\"/>\n        <br/>\n    </xsl:template>\n    <!-- secuence template -->\n    <xsl:template name=\"sequence\">\n        <xsl:value-of select=\"@name\"/>\n        <xsl:if test=\"@number\">\n            <xsl:text disable-output-escaping=\"no\">,&#032;#</xsl:text>\n            <xsl:value-of select=\"@number\"/>\n        </xsl:if>\n        <xsl:if test=\"fb:sequence\">\n            <ul>\n                <xsl:for-each select=\"fb:sequence\">\n                    <xsl:call-template name=\"sequence\"/>\n                </xsl:for-each>\n            </ul>\n        </xsl:if>\n    </xsl:template>\n    <!-- toc template -->\n    <xsl:template match=\"fb:section|fb:body\" mode=\"toc\">\n        <xsl:choose>\n            <xsl:when test=\"name()='body' and position()=1 and not(fb:title)\">\n                <xsl:apply-templates select=\"fb:section\" mode=\"toc\"/>\n            </xsl:when>\n            <xsl:otherwise>\n                <navPoint>\n                    <navLabel>\n                        <text>\n                            <xsl:value-of select=\"normalize-space(fb:title | @name)\"/>\n                        </text>\n                    </navLabel>\n                    <content src=\"#TOC_{generate-id()}\"></content>\n                    <!--<xsl:value-of select=\"normalize-space(fb:title | //fb:body/@name)\"/>-->\n                    <!--<xsl:value-of select=\"normalize-space(fb:body[@name == 'notes']/@name | fb:body/title)\"/>-->\n\n                    <!-- fb:body[@name = 'notes'] -->\n                    <xsl:if test=\"fb:section\">\n                        <navPoint>\n                            <xsl:apply-templates select=\"fb:section\" mode=\"toc\"/>\n                        </navPoint>\n                    </xsl:if>\n                </navPoint>\n            </xsl:otherwise>\n        </xsl:choose>\n    </xsl:template>\n    <!-- description -->\n    <xsl:template match=\"fb:description\">\n        <xsl:apply-templates/>\n    </xsl:template>\n    <!-- body -->\n    <xsl:template match=\"fb:body\">\n        <div>\n            <xsl:apply-templates/>\n        </div>\n    </xsl:template>\n\n    <xsl:template match=\"fb:section\">\n        <section>\n            <xsl:attribute name=\"class\">\n                <xsl:text>default-section</xsl:text>\n                <xsl:if test=\"starts-with(translate(fb:title, 'ГЛАВА', 'глава'), 'глава')\">\n                    <xsl:text> chapter</xsl:text>\n                </xsl:if>\n            </xsl:attribute>\n            <a name=\"TOC_{generate-id()}\"></a>\n            <xsl:if test=\"@id\">\n                <xsl:element name=\"a\">\n                    <xsl:attribute name=\"name\">\n                        <xsl:value-of select=\"@id\"/>\n                    </xsl:attribute>\n                </xsl:element>\n            </xsl:if>\n            <xsl:apply-templates/>\n        </section>\n    </xsl:template>\n    <xsl:template match=\"fb:body[@name='notes']//fb:section\">\n        <div>\n            <xsl:if test=\"@id\">\n                <xsl:attribute name=\"class\">\n                    <xsl:value-of select=\"'annotation'\"/>\n                </xsl:attribute>\n            </xsl:if>\n            <a name=\"TOC_{generate-id()}\"></a>\n            <xsl:if test=\"@id\">\n                <xsl:element name=\"a\">\n                    <xsl:attribute name=\"name\">\n                        <xsl:value-of select=\"@id\"/>\n                    </xsl:attribute>\n                </xsl:element>\n            </xsl:if>\n            <xsl:apply-templates/>\n        </div>\n    </xsl:template>\n\n\n    <!-- section/title -->\n    <xsl:template match=\"fb:section/fb:title|fb:poem/fb:title\">\n        <xsl:choose>\n            <xsl:when test=\"count(ancestor::node()) &lt; 9\">\n                <xsl:element name=\"{concat('h',count(ancestor::node())-3)}\">\n                    <a name=\"TOC_{generate-id()}\"></a>\n                    <xsl:if test=\"@id\">\n                        <xsl:element name=\"a\">\n                            <xsl:attribute name=\"name\">\n                                <xsl:value-of select=\"@id\"/>\n                            </xsl:attribute>\n                        </xsl:element>\n                    </xsl:if>\n                    <xsl:apply-templates/>\n                </xsl:element>\n            </xsl:when>\n            <xsl:otherwise>\n                <xsl:element name=\"h6\">\n                    <xsl:if test=\"@id\">\n                        <xsl:element name=\"a\">\n                            <xsl:attribute name=\"name\">\n                                <xsl:value-of select=\"@id\"/>\n                            </xsl:attribute>\n                        </xsl:element>\n                    </xsl:if>\n                    <xsl:apply-templates/>\n                </xsl:element>\n            </xsl:otherwise>\n        </xsl:choose>\n    </xsl:template>\n    <!-- section/title -->\n    <xsl:template match=\"fb:body/fb:title\">\n        <!--<h1 style=\"display: none;\">-->\n            <!--<xsl:apply-templates mode=\"title\"/>-->\n        <!--</h1>-->\n    </xsl:template>\n    <xsl:template match=\"fb:body[@name='notes']/fb:title\">\n        <h1>\n            <xsl:apply-templates mode=\"title\"/>\n        </h1>\n    </xsl:template>\n\n    <xsl:template match=\"fb:title/fb:p\">\n        <xsl:apply-templates/>\n        <xsl:text disable-output-escaping=\"no\">&#032;</xsl:text>\n        <br/>\n    </xsl:template>\n    <!-- subtitle -->\n    <xsl:template match=\"fb:subtitle\">\n        <xsl:if test=\"@id\">\n            <xsl:element name=\"a\">\n                <xsl:attribute name=\"name\">\n                    <xsl:value-of select=\"@id\"/>\n                </xsl:attribute>\n            </xsl:element>\n        </xsl:if>\n        <h5>\n            <xsl:apply-templates/>\n        </h5>\n    </xsl:template>\n    <!-- p -->\n    <xsl:template match=\"fb:p\">\n        <!--<xsl:if test\"preceding-sibling::*[1][name()] != 'fb:image'\">-->\n            <p data-id=\"pos_{generate-id()}\">\n                <xsl:if test=\"@id\">\n                    <xsl:element name=\"a\">\n                        <xsl:attribute name=\"name\">\n                            <xsl:value-of select=\"@id\"/>\n                        </xsl:attribute>\n                    </xsl:element>\n                </xsl:if>\n                <xsl:apply-templates/>\n            </p>\n        <!--</xsl:if>-->\n    </xsl:template>\n    <!-- strong -->\n    <xsl:template match=\"fb:strong\">\n        <b>\n            <xsl:apply-templates/>\n        </b>\n    </xsl:template>\n    <!-- emphasis -->\n    <xsl:template match=\"fb:emphasis\">\n        <i>\n            <xsl:apply-templates/>\n        </i>\n    </xsl:template>\n    <!-- style -->\n    <xsl:template match=\"fb:style\">\n        <span class=\"{@name}\">\n            <xsl:apply-templates/>\n        </span>\n    </xsl:template>\n    <!-- empty-line -->\n    <xsl:template match=\"fb:empty-line\">\n        <xsl:if test=\"following-sibling::*[1] != fb:image\">\n            <br/>\n        </xsl:if>\n    </xsl:template>\n    <!-- link -->\n    <xsl:template match=\"fb:a\">\n        <xsl:choose>\n            <xsl:when test=\"starts-with(@xlink:href,'#')\">\n                <xsl:element name=\"a\">\n                    <xsl:attribute name=\"class\">\n                        <xsl:value-of select=\"'footnote'\"/>\n                    </xsl:attribute>\n                    <xsl:attribute name=\"href\">\n                        <xsl:value-of select=\"@xlink:href\"/>\n                    </xsl:attribute>\n                    <xsl:attribute name=\"title\">\n                        <xsl:value-of select=\"key('note-link',substring-after(@xlink:href,'#'))/fb:p\"/>\n                    </xsl:attribute>\n                    <xsl:choose>\n                        <xsl:when test=\"(@type) = 'note'\">\n                            <sup>\n                                <xsl:apply-templates/>\n                            </sup>\n                        </xsl:when>\n                        <xsl:otherwise>\n                            <xsl:apply-templates/>\n                        </xsl:otherwise>\n                    </xsl:choose>\n                </xsl:element>\n            </xsl:when>\n            <xsl:otherwise>\n                <xsl:element name=\"span\">\n                    <xsl:choose>\n                        <xsl:when test=\"(@type) = 'note'\">\n                            <sup>\n                                <xsl:apply-templates/>\n                            </sup>\n                        </xsl:when>\n                        <xsl:otherwise>\n                            <xsl:apply-templates/>\n                        </xsl:otherwise>\n                    </xsl:choose>\n                </xsl:element>\n            </xsl:otherwise>\n        </xsl:choose>\n    </xsl:template>\n    <!-- annotation -->\n    <xsl:template name=\"annotation\">\n        <xsl:if test=\"@id\">\n            <xsl:element name=\"a\">\n                <xsl:attribute name=\"name\">\n                    <xsl:value-of select=\"@id\"/>\n                </xsl:attribute>\n            </xsl:element>\n        </xsl:if>\n        <xsl:apply-templates/>\n    </xsl:template>\n    <!-- epigraph -->\n    <xsl:template match=\"fb:epigraph\">\n        <blockquote class=\"epigraph\">\n            <xsl:if test=\"@id\">\n                <xsl:element name=\"a\">\n                    <xsl:attribute name=\"name\">\n                        <xsl:value-of select=\"@id\"/>\n                    </xsl:attribute>\n                </xsl:element>\n            </xsl:if>\n            <xsl:apply-templates/>\n        </blockquote>\n    </xsl:template>\n    <!-- epigraph/text-author -->\n    <xsl:template match=\"fb:epigraph/fb:text-author\">\n        <blockquote class=\"author\">\n            <i>\n                <xsl:apply-templates/>\n            </i>\n        </blockquote>\n    </xsl:template>\n    <!-- cite -->\n    <xsl:template match=\"fb:cite\">\n        <blockquote>\n            <xsl:if test=\"@id\">\n                <xsl:element name=\"a\">\n                    <xsl:attribute name=\"name\">\n                        <xsl:value-of select=\"@id\"/>\n                    </xsl:attribute>\n                </xsl:element>\n            </xsl:if>\n            <xsl:apply-templates/>\n        </blockquote>\n    </xsl:template>\n    <!-- cite/text-author -->\n    <xsl:template match=\"fb:text-author\">\n        <blockquote>\n            <i>\n                <xsl:apply-templates/>\n            </i>\n        </blockquote>\n    </xsl:template>\n    <!-- date -->\n    <xsl:template match=\"fb:date\">\n        <xsl:choose>\n            <xsl:when test=\"not(@value)\">\n                &#160;&#160;&#160;\n                <xsl:apply-templates/>\n                <br/>\n            </xsl:when>\n            <xsl:otherwise>\n                &#160;&#160;&#160;<xsl:value-of select=\"@value\"/>\n                <br/>\n            </xsl:otherwise>\n        </xsl:choose>\n    </xsl:template>\n    <!-- poem -->\n    <xsl:template match=\"fb:poem\">\n        <blockquote>\n            <xsl:if test=\"@id\">\n                <xsl:element name=\"a\">\n                    <xsl:attribute name=\"name\">\n                        <xsl:value-of select=\"@id\"/>\n                    </xsl:attribute>\n                </xsl:element>\n            </xsl:if>\n            <xsl:apply-templates/>\n        </blockquote>\n    </xsl:template>\n\n    <!-- stanza -->\n    <xsl:template match=\"fb:stanza\">\n        <xsl:apply-templates/>\n        <br/>\n    </xsl:template>\n    <!-- v -->\n    <xsl:template match=\"fb:v\">\n        <xsl:if test=\"@id\">\n            <xsl:element name=\"a\">\n                <xsl:attribute name=\"name\">\n                    <xsl:value-of select=\"@id\"/>\n                </xsl:attribute>\n            </xsl:element>\n        </xsl:if>\n        <xsl:apply-templates/>\n        <br/>\n    </xsl:template>\n    <!-- image -->\n    <xsl:template match=\"fb:image\" name=\"image\">\n        <div>\n            <xsl:choose>\n                <xsl:when test=\"ancestor::fb:coverpage\">\n                    <xsl:attribute name=\"class\">\n                        <xsl:value-of select=\"'text-cover'\"/>\n                    </xsl:attribute>\n                </xsl:when>\n                <xsl:otherwise>\n                    <xsl:attribute name=\"class\">\n                        <xsl:text>default image</xsl:text>\n                    </xsl:attribute>\n                </xsl:otherwise>\n            </xsl:choose>\n            <div class=\"image-wrapper\">\n                <img>\n                    <xsl:choose>\n                        <xsl:when test=\"starts-with(@xlink:href,'#')\">\n                            <xsl:attribute name=\"src\">\n                                <xsl:text>data:</xsl:text>\n                                <xsl:variable name=\"href\" select=\"substring-after(@xlink:href,'#')\"/>\n                                <set variable=\"href\" expression=\"substring-after(@xlink:href,'#')\"/>\n                                <xsl:value-of select=\"//fb:binary[@id=$href]/@content-type\" disable-output-escaping=\"yes\"/><xsl:text>;base64,</xsl:text>\n                                <!--<xsl:value-of select=\"substring-after(@xlink:href,'#')\"/>-->\n                                <xsl:value-of select=\"//fb:binary[@id=$href]\" disable-output-escaping=\"yes\"/>\n                            </xsl:attribute>\n\n                        </xsl:when>\n                        <xsl:otherwise>\n                            <xsl:attribute name=\"src\">\n                                <xsl:value-of select=\"@xlink:href\"/>\n                            </xsl:attribute>\n                        </xsl:otherwise>\n                    </xsl:choose>\n                </img>\n            </div>\n            <xsl:if test=\"following-sibling::node()[1]/fb:emphasis\">\n                <div class=\"image-annotation\">\n                    <xsl:apply-templates select=\"following-sibling::fb:p[1]\"/>\n                </div>\n            </xsl:if>\n        </div>\n    </xsl:template>\n</xsl:stylesheet>`\nexport { FB2XSL }\n","import React from 'react'\nimport { observable, action } from 'mobx'\nimport libraryDB from '../uitls/clientDB' // getBookText, // updateBook, // storeBook, // getBookList,\nimport { BookList, Book } from '../types'\nimport { convertFB2ToHtml } from '../uitls/converter'\n\ntype CurrentBook = {\n  meta: Book | null\n  text: string\n} | null\n\nexport const LibraryStore = () => {\n  const fetchBooksListAction = action(async () => {\n    store.books = await libraryDB.getAllMeta()\n    console.log('books', store.books)\n  })\n\n  const addBookAction = action(async (rawBookText: string, file: File) => {\n    const { documentBody, cover } = convertFB2ToHtml(rawBookText)\n    const newBook = {\n      name: file.name,\n      cover,\n    }\n    const book = await libraryDB.addBook(newBook, documentBody)\n    store.books.push(book)\n  })\n\n  const syncBookAction = action(async (meta: Book, body: string) => {\n    const book = await libraryDB.addBook(meta, body)\n    store.books.push(book)\n  })\n\n  const deleteBookAction = action(async (book: Book) => {\n    await libraryDB.delete(book.id)\n    const bookIndex = store.books.indexOf(book)\n    store.books.splice(bookIndex, 1)\n  })\n\n  const updateBookPositionAction = action(\n    async (bookId: number, positionElement: string) => {\n      await libraryDB.setBookMeta(bookId, { positionElement })\n    }\n  )\n\n  const updateBookAction = action(async (bookId: number, bookProps: any) => {\n    const bookInStore = store.books.find((book) => book.id === bookId)\n    if (bookInStore) {\n      Object.assign(bookInStore, bookProps)\n    }\n    await libraryDB.setBookMeta(bookId, bookProps)\n  })\n\n  const openBookAction = action(async (bookId: number) => {\n    if (store.currentBook!.meta!.id === bookId) {\n      store.currentBook.meta = await libraryDB.getBookMeta(bookId)\n      return Promise.resolve()\n    }\n    return Promise.all([\n      libraryDB.getBookMeta(bookId),\n      libraryDB.getBookText(bookId),\n    ]).then((prom) => {\n      store.currentBook.meta = prom[0]\n      store.currentBook.text = prom[1]\n    })\n  })\n\n  const fetchBookTextAction = action(\n    async (bookId: number) => await libraryDB.getBookText(bookId)\n  )\n\n  const store = observable({\n    books: [] as BookList,\n    remoteBooks: [] as BookList,\n    currentBook: {\n      meta: {} as Book | undefined,\n      text: '' as string | undefined,\n    },\n    fetchBooksListAction,\n    fetchBookTextAction,\n    addBookAction,\n    openBookAction,\n    syncBookAction,\n    deleteBookAction,\n    updateBookAction,\n    updateBookPositionAction,\n  })\n\n  return store\n}\nexport default React.createContext<any>({})\n","import React, { useContext } from 'react'\nimport { observer } from 'mobx-react'\nimport { RemoteBook, Book } from '../../types'\nimport RemoteLibraryStoreContext from '../../store/RemoteLibraryStore'\nimport LibraryStoreContext from '../../store/LibraryStore'\nimport { Loading } from '../common'\n\nconst RemoteBooksList = observer(() => {\n  const {\n    books,\n    isBooksLoading,\n    isLoggedIn,\n    downloadBookAction,\n    deleteBookAction,\n  } = useContext(RemoteLibraryStoreContext)\n  const { books: localBooks, updateBookAction, syncBookAction } = useContext(\n    LibraryStoreContext\n  )\n\n  const removeBtnHandler = async (book: RemoteBook) => {\n    const isSuccess = await deleteBookAction(book)\n    if (isSuccess) {\n      const localBook: Book | null = localBooks.find(\n        (localBook: Book) => localBook.metaFileId === book.metaFileId\n      )\n      if (localBook) {\n        delete localBook.metaFileId\n        await updateBookAction(localBook.id, { metaFileId: null })\n      }\n    }\n  }\n\n  const collectBtnHandler = async (remoteBook: RemoteBook) => {\n    const { meta, text } = await downloadBookAction(remoteBook)\n    await syncBookAction(meta, text)\n  }\n\n  return (\n    <>\n      <div className={`collection ${!isLoggedIn ? 'hidden' : ''}`}>\n        <div>\n          {isBooksLoading && <Loading />}\n\n          {!isBooksLoading &&\n            books.map((book: RemoteBook, index: number) => (\n              <div key={book.id}>\n                <div>{book.id}: {book.name}</div>\n                <button onClick={() => removeBtnHandler(book)}>del</button>\n                <button onClick={() => collectBtnHandler(book)}>collect</button>\n              </div>\n            ))\n          }\n        </div>\n      </div>\n    </>\n  )\n})\nexport default RemoteBooksList\n","import { BookList } from '../types'\n\nexport async function getBooksList(): Promise<BookList> {\n  return fetch('db.json').then((resp) => resp.json())\n}\n\nexport async function getBook(filePath: string): Promise<string> {\n  return fetch(filePath).then((resp) => resp.text())\n}\n\nexport function readFileContent(file: File): Promise<string> {\n  const reader = new FileReader()\n\n  return new Promise((resolve, reject) => {\n    reader.onload = (event) => {\n      return resolve(event?.target?.result + '')\n    }\n    reader.onerror = (error) => reject('error reading file')\n    reader.readAsText(file)\n  })\n}\n\nexport const debounce = <F extends (...args: any[]) => any>(\n  func: F,\n  waitFor: number\n) => {\n  let timeout: ReturnType<typeof setTimeout> | null = null\n\n  const debounced = (...args: Parameters<F>) => {\n    if (timeout !== null) {\n      clearTimeout(timeout)\n      timeout = null\n    }\n    timeout = setTimeout(() => func(...args), waitFor)\n  }\n\n  return debounced as (...args: Parameters<F>) => ReturnType<F>\n}\n","import { observer } from 'mobx-react'\nimport { readFileContent } from '../../uitls/common'\nimport React, { useContext } from 'react'\n\nimport AddBookIcon from './add-book.png'\nimport LibraryStoreContext from '../../store/LibraryStore'\n\nconst AddBookButton = observer(({ ...rest }: any) => {\n  const { addBookAction } = useContext(LibraryStoreContext)\n  function onChangeHandler(event: React.ChangeEvent<HTMLInputElement>) {\n    if (event.target.files?.length) {\n      const file = event.target.files[0]\n      readFileContent(file).then((text: string) => {\n        addBookAction(text, file)\n      })\n    }\n  }\n\n  return (\n    <div {...rest}>\n      <label className=\"add-book-lable\" htmlFor=\"btn-add-book\">\n        <img src={AddBookIcon} alt=\"\" />\n        <input\n          type=\"file\"\n          name=\"\"\n          id=\"btn-add-book\"\n          onChange={onChangeHandler}\n          accept=\".fb2\"\n        />\n      </label>\n    </div>\n  )\n})\n\n\nconst BooksListPlaceholder = observer(() => (\n  <div className=\"book-list-placeholder\">\n    <div className=\"centered\">\n      <div>\n        Welcome! You haven't uploaded any books yet. Careful Reader supports\n        <strong>&nbsp;fb2&nbsp;</strong>\n        ones.\n      </div>\n      <AddBookButton className=\"add-btn-placeholder\" />\n    </div>\n  </div>\n))\n\nexport { AddBookButton, BooksListPlaceholder }\n","import React from 'react'\nimport { observer } from 'mobx-react'\nimport { Book } from '../../types'\nimport { Link } from 'react-router-dom'\nimport './BookItem.scss'\n\ninterface BookItemProps {\n  book: Book\n  to: string\n  children?: any\n}\nconst BookItem = observer(({ book, children, to, ...rest }: BookItemProps) => (\n  <div>\n    {children}\n    <Link to={to} className=\"book-item\" {...rest}>\n      {book.cover ? (\n        <>\n          <img src={book.cover} alt=\"\" />\n        </>\n      ) : (\n          <div className=\"name\">{book.name}</div>\n        )}\n    </Link>\n  </div>\n))\n\nexport default BookItem","import React, { useContext } from 'react'\nimport { observer } from 'mobx-react'\nimport { Book } from '../../types'\nimport { BooksListPlaceholder } from './common'\nimport LibraryStoreContext from '../../store/LibraryStore'\nimport BookItem from '../common/BookItem'\n\nconst LocalBooksList = observer(() => {\n  const {\n    books\n  } = useContext(LibraryStoreContext)\n\n  return (\n    <>\n      {books.length ? (\n        <div className=\"collection\">\n          {books.map((book: Book, index: number) => (\n            <BookItem\n              book={book}\n              key={book.id}\n              to={`/details/${book.id}`}>\n            </BookItem>\n          ))}\n        </div>\n      ) : (\n          <BooksListPlaceholder />\n        )}\n    </>\n  )\n})\n\nexport default LocalBooksList\n","import Shelves from './Shelves'\n\nexport default Shelves\n","import React from 'react'\nimport './Shelves.scss'\n\nimport { Header } from '../common'\nimport { observer } from 'mobx-react'\nimport RemoteBooksList from './RemoteShelve'\nimport { AddBookButton } from './common'\nimport LocalBooksList from './LocalShelve'\n\nexport default observer(function Shelves() {\n  return (\n    <>\n      <Header></Header>\n      <div className=\"book-shelf\">\n        <div className=\"container\">\n          <RemoteBooksList />\n          <div> separator </div>\n          <LocalBooksList />\n        </div>\n        <AddBookButton className=\"add-button-fixed\" />\n      </div>\n    </>\n  )\n})\n","const MAX_WORD_CLASSES = 100\n\nexport function hightLightElementsOnScreen(\n  screenElement: any,\n  allElements: any\n): any[] {\n  const onScreen: any[] = []\n  if (!screenElement) return onScreen\n  const viewportTop = screenElement.scrollTop\n  const viewportHeight = screenElement.clientHeight\n  const viewportBottom = viewportTop + viewportHeight\n  for (let i = 0; i < allElements.length; i++) {\n    const el = allElements[i]\n    if (isOnScreen(el, screenElement)) {\n      stylize(el)\n      onScreen.push(el)\n    }\n    if (el.offsetTop > viewportBottom) {\n      break\n    }\n  }\n  return onScreen\n}\n\nexport function getStyledElement(text: string) {\n  // const separator = /(?:,| |&nbsp;|\\.)+/\n  const indexes = shuffle([...Array(MAX_WORD_CLASSES).keys()])\n  const separator = ' '\n  let index = 0\n  const children = text\n    .split(separator)\n    .map((word: string) => {\n      index = index >= MAX_WORD_CLASSES ? 0 : index + 1\n      return `<span class=\"w${indexes[index]}\">${word}</span>`\n    })\n    .join(separator)\n  const wrapper = document.createElement('hlw')\n  wrapper.innerHTML = children\n  return wrapper\n}\n\nfunction shuffle<T>(array: Array<T>) {\n  return array.sort(() => Math.random() - 0.5)\n}\n\nfunction textNodesUnder(el: HTMLElement) {\n  let n\n  const result = []\n  let walk = document.createTreeWalker(el, NodeFilter.SHOW_TEXT, null, false)\n  while ((n = walk.nextNode())) result.push(n)\n  return result\n}\n\nexport function stylize(element: HTMLElement) {\n  if (element.className.includes('hg')) return\n\n  textNodesUnder(element).forEach((textElement: any) => {\n    if (textElement) {\n      const styledTextElement = getStyledElement(textElement.textContent)\n      textElement.replaceWith(styledTextElement)\n      element.className += ' hg'\n    }\n  })\n}\n\nfunction isOnScreen(el: any, screenContainerElement: any) {\n  const viewportTop = screenContainerElement.scrollTop\n  const viewportHeight = screenContainerElement.clientHeight\n  const viewportBottom = viewportTop + viewportHeight\n  const top = el.offsetTop\n  const height = el.clientHeight\n  const bottom = top + height\n\n  return (\n    (top >= viewportTop && top < viewportBottom) ||\n    (bottom > viewportTop && bottom <= viewportBottom) ||\n    (height > viewportHeight && top <= viewportTop && bottom >= viewportBottom)\n  )\n}\n","import React, { useEffect, useState, useRef, useContext } from 'react'\nimport './Reader.scss'\nimport { useParams, Link } from 'react-router-dom'\nimport { debounce } from '../../uitls/common'\nimport { hightLightElementsOnScreen } from '../../uitls/styler'\nimport { Checkbox } from '../common'\nimport HomeIcon from './home.svg'\nimport LibraryStoreContext from '../../store/LibraryStore'\nimport { observer } from 'mobx-react'\n\ninterface QueryParams {\n  bookId: string\n}\n\nconst dfunc = debounce((fn) => fn && fn(), 100)\n\nexport default observer(function Reader() {\n  // @ts-ignore\n  const { updateBookPositionAction, openBookAction, currentBook } = useContext(\n    LibraryStoreContext\n  )\n  const [numberOfcurrentPage, setNumberOfCurrentPage] = useState(0)\n  const [currenPositionPercent, setCurrenPositionPercent] = useState('0.0')\n  const [pagesCount, setPagesCount] = useState(0)\n  const [wordsHighlight, setWordsHighlight] = useState(true)\n  const [showControls, setShowControls] = useState(false)\n  const textContainerRef = useRef<HTMLDivElement | null>(null)\n  const elementsForHightlightRef = useRef([])\n\n  const queryParams = useParams<QueryParams>()\n  const bookId = parseInt(queryParams.bookId)\n\n  const handlePageChange = (direction: string) => () => {\n    const { current } = textContainerRef\n    if (current) {\n      const sign = direction === 'next' ? 1 : -1\n      current.scrollTop += sign * current.clientHeight\n    }\n  }\n\n  useEffect(() => {\n    const { current } = textContainerRef\n    const openBook = async () => {\n      await openBookAction(bookId)\n      current!.innerHTML = currentBook.text\n      elementsForHightlightRef.current = getElementsForHightlight()\n      setPagesCount(getPagesCount())\n      restoreScrollPoition()\n    }\n    openBook()\n    current!.addEventListener('scroll', handleScroll)\n    return () => {\n      return current!.removeEventListener('scroll', handleScroll)\n    }\n  }, [])\n\n  return (\n    <>\n      <div className={`reader list-view ${wordsHighlight ? 'highlight' : ''}`}>\n        <div className={`text-info${showControls ? '' : ' hidden'}`}>\n          <div>\n            <Checkbox\n              label=\"highlight\"\n              value={wordsHighlight}\n              onChange={toggleHightligting}\n            />\n          </div>\n          <div className=\"\">{currenPositionPercent}%</div>\n          <div className=\"pages\">\n            {numberOfcurrentPage} / {pagesCount}\n          </div>\n          <Link className=\"home\" to=\"/\">\n            <img src={HomeIcon} alt=\"\" />\n          </Link>\n        </div>\n\n        <div\n          className=\"text-container\"\n          onClick={toggleMenuHandler}\n          ref={textContainerRef}\n        ></div>\n        {/* <div className=\"prev-page\" onClick={handlePageChange('prev')}></div> */}\n        {/* <div className=\"next-page\" onClick={handlePageChange('next')}></div> */}\n      </div>\n    </>\n  )\n\n  function getElementsForHightlight() {\n    const result: any = []\n    document.querySelectorAll('p').forEach((el: any) => {\n      result.push(el)\n    })\n    return result.sort((a: any, b: any) => a.offsetTop > b.offsetTop)\n  }\n\n  function handleScroll(e: Event) {\n    const { current } = textContainerRef\n    const { current: elementsForHightlight } = elementsForHightlightRef\n    if (current) {\n      const percent = getPercentOfScroll()\n      setCurrenPositionPercent(percent.toFixed(2))\n      setNumberOfCurrentPage(getNumberOfCurrentPage())\n      dfunc(() => {\n        const onScreen =\n          hightLightElementsOnScreen(current, elementsForHightlight) || []\n        updateBookPosition(onScreen[0])\n      })\n    }\n  }\n\n  function restoreScrollPoition() {\n    if (currentBook.meta) {\n      const toElement = document.querySelector(\n        `[data-id=\"${currentBook.meta.positionElement}\"]`\n      )\n      toElement?.scrollIntoView()\n    }\n  }\n\n  function getPercentOfScroll() {\n    const { current } = textContainerRef\n    return current ? (current.scrollTop * 100) / current.scrollHeight : 0.0\n  }\n\n  function updateBookPosition(posElement: HTMLElement) {\n    if (posElement) {\n      const positionElement = posElement.getAttribute('data-id')\n      updateBookPositionAction(bookId, positionElement)\n    }\n  }\n\n  function getPagesCount() {\n    const { current } = textContainerRef\n    return Math.round(current!.scrollHeight / current!.clientHeight)\n  }\n\n  function getNumberOfCurrentPage() {\n    const { current } = textContainerRef\n    return Math.round(current!.scrollTop / current!.clientHeight)\n  }\n\n  function toggleHightligting() {\n    setWordsHighlight(!wordsHighlight)\n  }\n\n  function toggleMenuHandler() {\n    setShowControls(!showControls)\n  }\n})\n","import Reader from './Reader'\n\nexport default Reader\n","import React, { useContext } from 'react'\nimport { Link } from 'react-router-dom'\nimport LibraryStoreContext from '../../store/LibraryStore'\nimport { observer } from 'mobx-react'\nimport { Book } from '../../types'\nimport BookItem from '../common/BookItem'\nimport BookShelfImage from './book-shelf.png'\nimport './feed.scss'\nimport { Header } from '../common'\n\nexport default observer(function Feed() {\n  const { currentBook } = useContext(\n    LibraryStoreContext\n  )\n  const { meta }: { meta: Book } = currentBook\n\n  return (\n    <div className=\"feed\">\n      <Header></Header>\n      <div className=\"content\">\n        {meta.id &&\n          <section className=\"current-book\">\n            <span className=\"title\">to read...</span>\n            <BookItem book={meta} to={`/read/${meta.id}`} />\n          </section>}\n        <section className=\"link-to-shelves\">\n          <span className=\"title\">Library</span>\n          <Link to=\"/shelves\" >\n            <img src={BookShelfImage} alt=\"shelve\" />\n          </Link>\n        </section>\n      </div>\n    </div>\n  )\n})\n","import React, { useContext, useState, useEffect } from 'react'\nimport { useParams } from 'react-router-dom'\nimport { Header } from '../common'\nimport { observer } from 'mobx-react'\nimport LibraryStoreContext from '../../store/LibraryStore'\nimport { Book } from '../../types'\nimport BookItem from '../common/BookItem'\nimport './Details.scss'\nimport RemoteLibraryStoreContext from '../../store/RemoteLibraryStore'\n\ninterface QueryParams {\n  bookId: string\n}\n\nconst Details = () => {\n  const queryParams = useParams<QueryParams>()\n  const bookId = parseInt(queryParams.bookId)\n  const {\n    books,\n    updateBookAction,\n    deleteBookAction,\n    fetchBookTextAction,\n  } = useContext(LibraryStoreContext)\n  const { uploadBookAction, syncMetaAction } = useContext(\n    RemoteLibraryStoreContext\n  )\n  const [book, setBook] = useState<Book>()\n\n  useEffect(() => {\n    const book: Book = books.find((b: Book) => b.id === bookId)\n    setBook(book)\n  }, [books, bookId])\n\n  const uploadHandler = async (book: Book) => {\n    const text = await fetchBookTextAction(book.id)\n    const file = await uploadBookAction(book, text)\n    console.log('after download', book)\n    await updateBookAction(book.id, { ...book })\n  }\n\n  const deleteBookHandler = async (book: Book) => {\n    await deleteBookAction(book)\n  }\n\n  const syncHandler = async (book: Book) => {\n    if (book.metaFileId) {\n      await syncMetaAction(book)\n    } else {\n      const text = await fetchBookTextAction(book.id)\n      const file = await uploadBookAction(book, text)\n    }\n\n  }\n  return (\n    <div className=\"details\">\n      <Header></Header>\n      {book &&\n        <section className=\"content\">\n          <div>{book.name}</div>\n          <BookItem book={book} to={`/read/${book.id}`} />\n          <div className=\"info\">\n            <div className=\"controls\">\n              <button onClick={() => syncHandler(book)}>sync </button>\n              <button onClick={() => uploadHandler(book)}>upload</button>\n              <button\n                onClick={() => {\n                  deleteBookHandler(book)\n                }}\n              >\n                del\n              </button>\n              <button>info</button>\n              <div />\n              <div>{book.metaFileId}</div>\n            </div>\n          </div>\n        </section>\n      }\n    </div>\n  )\n}\n\nexport default observer(Details)","import React, { useEffect } from 'react'\nimport './App.scss'\nimport Shelves from './components/shelves'\nimport Reader from './components/reader'\nimport { BrowserRouter as Router, Switch, Route } from 'react-router-dom'\nimport { observer, useLocalStore } from 'mobx-react'\nimport LibraryStoreContext, { LibraryStore } from './store/LibraryStore'\nimport RemoteLibraryStoreContext, {\n  RemoteLibraryStore,\n} from './store/RemoteLibraryStore'\nimport { Feed } from './components/feed'\nimport { Details } from './components/details'\n\nconst App = observer(function App() {\n  const store = useLocalStore(LibraryStore)\n  const remoteStore = useLocalStore(RemoteLibraryStore)\n  const basename =\n    process.env.NODE_ENV === 'development' ? '/' : process.env.PUBLIC_URL\n  const { isLoggedIn } = remoteStore\n\n  useEffect(() => {\n    store.fetchBooksListAction()\n  }, [])\n\n  const fetchBooks = async () => {\n    if (isLoggedIn) await remoteStore.fetchBooksListAction()\n  }\n  useEffect(() => {\n    fetchBooks()\n  }, [isLoggedIn])\n\n  return (\n    <LibraryStoreContext.Provider value={store}>\n      <RemoteLibraryStoreContext.Provider value={remoteStore}>\n        <Router basename={basename}>\n          <Switch>\n            <Route exact path=\"/\">\n              <Feed />\n            </Route>\n            <Route exact path=\"/read/:bookId\">\n              <Reader />\n            </Route>\n            <Route exact path=\"/details/:bookId\">\n              <Details />\n            </Route>\n            <Route exact path=\"/shelves\">\n              <Shelves />\n            </Route>\n          </Switch>\n        </Router>\n      </RemoteLibraryStoreContext.Provider>\n    </LibraryStoreContext.Provider>\n  )\n})\n\nexport default App\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      (process as { env: { [key: string]: string } }).env.PUBLIC_URL,\n      window.location.href\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from 'react'\nimport ReactDOM from 'react-dom'\nimport App from './App'\nimport * as serviceWorker from './serviceWorker'\n\nconst app = <App />\n\nReactDOM.render(app, document.getElementById('root'))\nserviceWorker.register()\n"],"sourceRoot":""}